!function(){this.inArray=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},this.glob=function(e){for(var t,o=e.split("."),i=window,a=0,n=o.length;a<n;a++)i[t=o[a]]=i[t]||{},i=i[t];return i},glob("ldbck");var e,t,o,i,b=ldbck;if(window._emv){if(window.ldbck_loaded)return b.log("multiple instance detected"),!1;window.ldbck_loaded=!0}if(b.DEBUG=!1,b.ACCEPT_CHATS=!1,b.version="v1.12.25b240823",b.DOMAIN=b.DEBUG?"leadback.local":"string"==typeof _emv.cdn?_emv.cdn:"leadback.ru",b.CHAT_CDN=b.DEBUG?"//cloudim.local/js/":"//cloudim.ru/js/",b.JQUERY_URL="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js?ldbck_v="+b.version,b.JS_CDN="//"+b.DOMAIN+"/js/",b.PUBLIC_SERVER=(b.DEBUG?"//":"https://")+b.DOMAIN+"/",b.JQUERY_VERSIONS="3.3.1 3.2.1 3.1.1 2.2.4 2.1.1 1.12.4 1.11.3 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0".split(" "),b.LAST_SPEED=b.LEAVE_POINT=b.LAST_X_POSITION=b.LAST_Y_POSITION=0,b.timer=27e3,b.activity=0,b.clock=null,b.stat={x:null,y:null,s:null,t:0,a:0,l:0},b.total_time=0,b.last_visit_timeout=0,b.visit_date=null,b.Chat={},b.storage=null,b.dom_is_ready=null,b.restarted=!1,b.is_multibutton=null,b.$multibutton=null,b.beforeOpenWidget=null,b.successCallCallback=null,b.chat_settings=null,b.form_settings=null,"function"==typeof _emv.successCallCallback&&(b.successCallCallback=_emv.successCallCallback),b.onApiReady=[],"function"==typeof _emv.onApiReady)b.onApiReady.push(_emv.onApiReady);else if("object"==typeof _emv.onApiReady)for(var a=0,n=_emv.onApiReady.length;a<n;a++)"function"==typeof _emv.onApiReady[a]&&b.onApiReady.push(_emv.onApiReady[a]);b.is_vk=_emv.is_vk||!1,b.debug_window=_emv.debug_window||!1;try{b.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),b.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)}catch(e){}h=_emv.campaign,b.cc="__leadback_"+h,b.ct="__leadback_timeout_"+h,b.cg="__leadback_guid_"+h,b.storage_type="cookie",b.countDownInterval=null,b.replacedTags={},-1!=b.DOMAIN.indexOf("leadback.")&&(window.GoogleAnalyticsObject||(e=window,t=document,i="script",o="ga",e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,o=t.createElement(i),i=t.getElementsByTagName(i)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(o,i)),"function"==typeof ga&&(ga("create","UA-53479583-2","auto",{name:"ldbckTracker"}),ga("ldbckTracker.send","pageview"))),b.ga_cid=null,"function"==typeof ga&&ga(function(){b.getGoogleCid()});var l=0,r=setInterval(function(){l++,b.getGoogleCid()?(b.log("Ga cid found",b.getGoogleCid()),r&&(clearInterval(r),r=null)):5<l&&(r&&(clearInterval(r),r=null),b.log("Ga cid not found by interval"))},500);b.getGoogleCid=function(){return null===b.ga_cid&&"function"==typeof ga&&"function"==typeof ga.getAll&&ga.getAll().length&&(b.ga_cid=ga.getAll()[0].get("clientId"),r&&(clearInterval(r),r=null)),b.log("getGoogleCid",b.ga_cid),b.ga_cid},b.ya=[],b.ya_cid=null,b.ya_counter=null;var s=0,c=setInterval(function(){for(var e in s++,window)0==e.indexOf("yaCounter")&&("function"==typeof window[e].getClientID&&null===b.ya_cid&&(b.ya_cid=window[e].getClientID(),b.ya_counter=e.toLowerCase().replace("yacounter",""),b.log("YA CID:"+b.ya_cid),b.log("YA COUNTER:"+b.ya_counter)),"function"==typeof window[e].reachGoal&&(b.ya[b.ya.length]=e,b.log("Ya: "+b.ya.length)));0<b.ya.length?clearInterval(c):5<s&&(clearInterval(c),b.log("Ya not found"))},500);function m(){for(var e=0,t={};e<arguments.length;e++){var o,i=arguments[e];for(o in i)t[o]=i[o]}return t}if(b.init=function(){b.log("init");try{var e=document.location.href,t=-1!==e.indexOf("&_cobrowsing=true")||-1!==e.indexOf("?_cobrowsing=true");if(window!=window.top&&!b.is_vk||t)return b.log("in frame, sending handshake..."),window.top.postMessage("ldbck_forms:"+JSON.stringify({event:"ldbck_wizard_handshake",data:{widget_key:_emv.campaign}}),b.DEBUG?"http://"+b.DOMAIN:"https://"+b.DOMAIN),void window.addEventListener("message",function(e){if("string"!=typeof e.data||-1===e.data.indexOf("ldbck_forms:"))return!1;e=e.data.replace("ldbck_forms:","");"ldbck_wizard_handshake"===JSON.parse(e).event&&(b.log("Wizard form handshake received, loading JS from CDN",b.JS_CDN+"magic_forms_wizard/magic_forms_wizard.js?v="+b.version),b.loadScript(b.JS_CDN+"magic_forms_wizard/magic_forms_wizard.js?v="+b.version,!0,function(){b.log("WIZARD Forms Loaded"),new LeadbackMagicFormsWizard(b.$,b.DEBUG)}))})}catch(e){}b.activity=b.DEBUG?1:b.randomVal(10,20),b.$.ajaxSetup({async:!0}),b.storage_type="local";try{void 0!==b.Cookies.get("__leadback_ver")&&(b.Cookies.remove(b.cc,{path:"/"}),b.Cookies.remove(b.ct,{path:"/"}),b.Cookies.remove("__leadback_ver",{path:"/"}))}catch(e){}return b.log("Storage type is: "+b.storage_type),b.storage=b.initStorage(_emv.campaign),b.initWidget()},b.getStorageType=function(e){var t=b.storage_type;return t=e==b.cg&&!b.is_vk?"cookie":t},b.getCookie=function(e){var t=b.getStorageType(e);if("cookie"==t)return b.Cookies.getJSON(e);if("local"==t){t=b.storage.localStorage.get(e);return void 0===t?t:void 0!==t.expires&&"string"==typeof t.expires&&new Date(t.expires)<new Date?void b.removeCookie(e):t.value}},b.setCookie=function(e,t,o){var i=b.getStorageType(e);return"cookie"==i?b.Cookies.set(e,t,o):"local"==i?(void 0===o.expires&&(o.expires=0),b.storage.localStorage.set(e,{value:t,expires:o.expires})):void 0},b.removeCookie=function(e,t){var o=b.getStorageType(e);return"cookie"==o?b.Cookies.remove(e,t):"local"==o?b.storage.localStorage.remove(e):void 0},b.restart=function(e){return b.restarted=!0,b.unloadWidget(),b.timer=27e3,b.clock=null,b.stat={x:null,y:null,s:null,t:0,a:0,l:0},b.total_time=0,b.last_visit_timeout=0,b.Chat={},b.storage=null,b.dom_is_ready=null,e&&b.restartStorage(e),b.$("#lb_widget-root").remove(),b.initWidget()},b.restartStorage=function(e){_emv.campaign=e,b.cc="__leadback_"+e,b.ct="__leadback_timeout_"+e,b.cg="__leadback_guid_"+e,b.storage=b.initStorage(e)},b.initWidget=function(){b.log("initWidget"),"#demomode"!=window.location.hash&&"#debug"!=window.location.hash||(b.log("Demo mode ON"),b.removeCookie(b.cc,{path:"/"}),b.removeCookie(b.ct,{path:"/"}),void 0!==b.getCookie(b.cg)&&b.setCookie(b.cg,{guid:b.getCookie(b.cg).guid,converted:!1,t:b.getCookie(b.cg).t},{path:"/",expires:99999})),b.visit_date=new Date;function e(){b.$.ajax({type:"GET",url:b.PUBLIC_SERVER+"backend/widget_data.php",dataType:"json",data:{widget_key:_emv.campaign,h:window.location.host,cache:Math.random(),tz_offset:b.getTz()},success:function(e){b.log("Campaign Loaded from Server",e),void 0===e.widget_key&&b.log("Invalid widget_key");var t=new Date((new Date).getTime()+18e4),o=!(b.W={widget_key:e.widget_key,user_id:e.user_id,active:e.active,active_changed:e.active_changed||!1,night_mode:e.night_mode,catch_on_exit:e.catch_on_exit,catch_by_timer:e.catch_by_timer,catch_by_timer_time:e.catch_by_timer_time,allow_multiple_conversions:e.multiple_conversions,timeout:e.timeout,callback_time:e.callback_time,float_button:e.float_button,mobile_button:e.mobile_button,country:e.country||"ru",lang:e.lang||"ru",position:e.position,chat:e.chat||0,chat_uid:e.chat_uid||0,chat_id:e.chat_id||0,tooltip_scroll:e.tooltip_scroll,tooltip_hover:e.tooltip_hover,suitable_time:e.suitable_time,magic_forms:e.magic_forms,magic_forms_callback:e.magic_forms_callback,magic_forms_night_mode:e.magic_forms_night_mode,facebook_pixel_id:e.facebook_pixel_id||"",facebook_pixel_event:e.facebook_pixel_event||"",status:e.status,block_desc:e.block_desc,hide_call_timer:e.hide_call_timer,faq_settings:e.faq_settings,personal_agreement:e.personal_agreement});return b.W.widget_key!=_emv.campaign&&(b.log("is_geo_office = true"),b.storage=null,b.restartStorage(b.W.widget_key),o=!0),e.chat&&e.chat_uid&&e.chat_data&&(e.chat_data.operators&&b.storage.localStorage.set("chat_operators",e.chat_data.operators),e.chat_data.settings&&(b.storage.localStorage.set("chat_settings",e.chat_data.settings),b.chat_settings=e.chat_data.settings,b.W.chat_init="hide")),e.form_settings&&(b.form_settings=e.form_settings,b.storage.localStorage.set("form_settings",e.form_settings)),void 0!==e.url_config&&void 0!==e.url_config.urls&&0<e.url_config.urls.length?b.storage.localStorage.set("url_config",e.url_config):b.storage.localStorage.remove("url_config"),void 0!==e.scheduler&&void 0!==e.scheduler.days&&void 0!==e.scheduler.times?b.storage.localStorage.set("scheduler",e.scheduler):b.storage.localStorage.remove("scheduler"),void 0!==e.departments&&1<e.departments.length?b.storage.localStorage.set("departments",e.departments):b.storage.localStorage.remove("departments"),b.setCookie(b.cc,b.W,{path:"/",expires:t}),o?b.initWidget():b.campaignLoaded(e)},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpCallback"})}if(b.restarted||(b.$(window).on("beforeunload",function(){b.unloadWidget()}),setInterval(function(){b.stat.t++,b.total_time++,b.stat.a=b.total_time},1e3)),void 0===b.getCookie(b.cg))return t=ldbck.generateUUID(),b.setCookie(b.cg,{guid:t,converted:!1,t:0},{path:"/",expires:99999}),ldbck.log("New GUID Cookie Created"),b.removeCookie(b.cc,{path:"/"},e());if(ldbck.log("Loaded GUID Cookie"),b.total_time=b.getCookie(b.cg).t,void 0!==b.getCookie(b.cg).l&&(b.last_visit_timeout=Math.round(((new Date).getTime()-b.getCookie(b.cg).l)/1e3)),b.log("self.last_visit_timeout="+b.last_visit_timeout),void 0===b.getCookie(b.cc))return e();ldbck.log("Campaign Loaded from Cookie");var t=b.getCookie(b.cc);if(t.chat&&t.chat_uid&&!0===b.storage.localStorage.isEmpty("chat_operators"))return b.log("force LOAD Campaign (empty storage)"),e();b.W=t;try{clearInterval(b.countDownInterval)}catch(e){}return b.campaignLoaded(t)},b.unloadWidget=function(){if(void 0!==b.getCookie(b.cg)&&(b.setCookie(b.cg,{guid:b.getCookie(b.cg).guid,converted:b.getCookie(b.cg).converted,t:b.total_time,l:(new Date).getTime()},{path:"/",expires:99999}),window._emv))try{delete window.ldbck_loaded}catch(e){}},b.campaignLoaded=function(e){if(b.log("compaignLoaded",b.W),"block"==b.W.widget_key)return b.W.block_desc&&console.log("Widget is blocked. Reason: "+b.W.block_desc),!1;if("0"==b.W.status)return b.log("Widget is turn off!");if(!b.W.active&&!b.W.night_mode&&!b.is_vk)return b.log("Not active!");if(!b.storage.localStorage.isEmpty("url_config")){var t=b.storage.localStorage.get("url_config"),o=document.location.href;try{o=decodeURIComponent(document.location.href)}catch(e){b.log(e)}for(var i,a="allow"!=t.rule,n=0,l=t.urls.length;n<l;n++){-1===(i=t.urls[n]).replace("http://","").replace("https://","").indexOf("/")&&(b.log("adding trailing slash to pattern: "+i+" => "+i+"/"),i+="/"),i=i.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&").replace(/([*])/g,".+"),0!==t.urls[n].indexOf("http:")&&0!==t.urls[n].indexOf("https:")||-1!==t.urls[n].indexOf("*")||(b.log("full url pattern: "+i),i="^"+i+"$");var r=new RegExp(i);if(b.log("CHECK pattern["+t.rule+"]:"+i),r.test(void 0)||r.test(o)){if("allow"==t.rule){b.log("ALLOWED: "+i),a=!0;break}if("deny"==t.rule){b.log("DENIED: "+i),a=!1;break}}}if(!1===a)return b.log("Not allowed by url config")}var s,c;b.W.callback_time&&(b.timer=1e3*b.W.callback_time),s=b.getCookie(b.cg).converted,c=b.W.allow_multiple_conversions,b.is_vk?b.insertWidget(b.W,!0):("1"==b.W.chat&&b.W.chat_id&&b.W.chat_uid&&"undefined"==typeof Cloudim&&(b.log("Chat IS ON",b.W.chat_id),b.loadScript(b.CHAT_CDN+"chat.js?v2.2",!0,function(){b.log("Chat IS loaded"),Cloudim.Options.Chat.silent=!0,b.DEBUG&&(Cloudim.Options.debug=!0);var e,t="rand";b.storage.localStorage.isEmpty("chat_settings")||void 0!==(e=b.storage.localStorage.get("chat_settings")).operators_queue&&(t=e.operators_queue),"all"!=t&&4543!=b.W.user_id||(b.ACCEPT_CHATS=!0,Cloudim.Options.accept_chats=!0),Cloudim.Api.bind("onInit",function(e){b.log("Chat EVENT onInit");var i=!1;"#demomode"==window.location.hash&&(b.log("Demo CHAT mode ON"),window.location.hash="#demomode-chat",Cloudim.Api.clearCache(),i=!0),b.Chat.widget_key||b.loadScript(b.JS_CDN+"leadback-chat-api.js?v="+b.version,!0,function(){b.log("LOADED leadback-chat-api.js",b.version);var o=setInterval(function(){var e,t;!0===b.dom_is_ready?(clearInterval(o),b.Chat=_LBCHATAPI.init(b,b.W),b.Events._callEvent("onChatReady",b.Chat.Api),i?(b.log("CHAT IS Clear"),b.Chat.removeAllChatState(),window.location.reload()):(e=[],b.storage.localStorage.isEmpty("user_info")||(t=b.storage.localStorage.get("user_info"),e.push({name:"fullName",value:t.name}),e.push({name:"Email",value:t.email}),e.push({name:"Phone",value:t.phone})),0<e.length&&Cloudim.Api.sendUserData(e))):b.log("wait_insert_widget...")},100)})}),Cloudim.Api.bind("onReady",function(){b.log("Chat EVENT onReady"),Cloudim.Api.bind("onOperatorChange",function(e){b.DEBUG&&alert("operatorChanged"),e.operator&&b.Chat.acceptChat(e.operator)}),Cloudim.Api.bind("onExternalEvent",function(e){b.log("Chat EVENT onExternalEvent"),"xmpp.operator.cobrowse.internal.page"==e.event&&b.coBrowseV2()}),b.$("#cloudim_chat").hide();var e=setInterval(function(){b.Chat.widget_key&&(clearInterval(e),b.$(window).bind("hashchange",function(){"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done",null!==b.Chat.is_online&&(b.Chat.openChat(),b.Chat.scrollChatsToBottom(!0)))}),Cloudim.Api.getCurrentOperator(function(e){if(b.log("check Offline mode",e),b.ACCEPT_CHATS&&1<e.length&&b.Chat.setAcceptChatMode(e),!1===e)if(b.log("Chat EVENT Offline"),b.Chat.getChatSettings("offline_invite"))if(!1!==b.Chat.is_online){b.Chat.setOfflineMode();var t,o=b.storage.localStorage.get("chat_operators"),i=Math.round(Math.random()*(o.length-1));b.storage.localStorage.isEmpty("chat_operator")?b.storage.localStorage.set("chat_operator",i):0<=(t=b.storage.localStorage.get("chat_operator"))&&t<o.length&&(i=t);e=o[i];b.Chat.setOperator(e.operator_name,e.avatar_url),b.Chat.clearChatHistroy();var o=b.Chat.getChatInviteState(),i=b.Chat.getChatSettings("offline_invite_goal"),a=[];a[0]=b.Chat.getChatSettings("offline_invite_greeting"),void 0===i||"bot"==i||"bot_contacts"==i?(a[1]=b.Chat.getChatSettings("offline_invite_offer"),a[2]=b.Chat.getChatSettings("offline_invite_action"),b.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").show()):(a[1]=b.Chat.getChatSettings("offline_invite_offer_2"),a[2]=b.Chat.getChatSettings("offline_invite_action_2"),b.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").hide());e=[];if(e[0]=b.Chat.getChatSettings("offline_invite_call_offer"),e[1]=b.Chat.getChatSettings("offline_invite_call_action"),b.log("invite_goal",i),b.log("invite state",o),o.called||o.converted)if(b.log("converted & called"),void 0===i||"bot"==i||"bot_contacts"==i){b.log("Invite goal "+i+" toggle button"),b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(a,!0,!0);var n=b.Chat.readLocalMessages();if(n&&n.length)for(var l=0,r=n.length;l<r;l++)b.Chat.addMessageInChat(n[l],"visitor",new Date,!0);b.Chat.inviteVisitorInCall(e,!0)}else"call"===i&&(b.log("Invite goal call toggle button"),b.Chat.toggleOperatorButton());else o.readed||o.invited?(b.log("invited & readed"),b.Chat.removeLocalMessages(),b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(a,!0,o.readed)):(b.log("NOT invited"),b.Chat.removeLocalMessages(),o=b.Chat.getChatSettings("offline_invite_delay"),b.log("getChatSettings -> offline_invite_delay",o),setTimeout(function(){b.log("RUN OFFLINE INVITE"),b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(a),b.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*o))}else b.log("Chat now in offline -> exit");else b.log("Chat offline_invite IS OFF");else b.Chat.showChatButton()}))},100)}),Cloudim.Api.bind("onShowTab",function(e){b.log("Chat EVENT onShowTab")}),Cloudim.Api.bind("onClose",function(){b.log("Chat EVENT onClose")}),Cloudim.Api.bind("onOpen",function(){b.log("Chat EVENT onOpen")}),Cloudim.Api.bind("onMessage",function(e){b.log("Chat EVENT onMessage"),clearTimeout(b.Chat.operator_answer_timeout),clearTimeout(b.Chat.operator_wait_timeout),b.Chat.stopAnswerSimulation(),b.Chat.addMessageInChat(e.message,"operator",null,null,e.silent),void 0!==e.data&&"string"==typeof e.data.cobrowsing&&b.Chat.startCoBrowsing(e.data.cobrowsing,"Оператор",e.message),b.Chat.clearFaqMessages(),b.Chat.saveIsLiveChat(),b.Chat.chatIsOpen()||(b.Chat.addOperatorMessageInBaloon(e.message,!b.Chat.isLayoutBalloonVisible()),b.Chat.isLayoutBalloonVisible()||b.Chat.showLayoutBalloon(!1),b.Chat.increaseBadge(),e=b.Chat.getChatState(),b.Chat.saveChatState(e.open,+e.unread+1))}),Cloudim.Api.bind("onClientMessage",function(e){b.log("Chat EVENT onClientMessage"),b.Chat.addMessageInChat(e.message,"visitor",null,null,!0)}),Cloudim.Api.bind("onTyping",function(e){b.log("Chat EVENT onTyping"),clearTimeout(b.Chat.operator_answer_timeout),clearTimeout(b.Chat.operator_wait_timeout),!0===e.typing?b.Chat.operatorWriting():!1===e.typing&&b.Chat.operatorNotWriting()}),Cloudim.Api.bind("onOnline",function(){b.log("Chat EVENT onOnline");var e=setInterval(function(){b.Chat.widget_key&&(clearInterval(e),null===b.Chat.initial_status?(b.Chat.showChatButton(),Cloudim.Api.getVisitor(function(e){e.chatted&&b.Chat.toggleOperatorButton();var t=b.Chat.getChatState();if(0<t.unread)for(var o=0;o<t.unread;o++)b.Chat.increaseBadge();b.Chat.clearChatHistroy(),b.Chat.loadHistory(e.history),e.jid&&b.Chat.setVisitorJid(e.jid),(t.open&&!b.isMobile()||"#chatopen"==window.location.hash)&&(b.Chat.openChat(),b.Chat.scrollChatsToBottom(!0),"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done"))}),Cloudim.Api.getCurrentOperator(function(e){var t,o,i,a,n;b.log("getCurrentOperator",e),b.ACCEPT_CHATS&&1<e.length&&b.Chat.setAcceptChatMode(e),e?(b.Chat.setOnlineMode(),a=b.Chat.getChatInviteState(),b.log("invite_state",a),t=b.Chat.getChatSettings("chat_invite"),b.log("getChatSettings -> chat_invite",t),o=b.Chat.isChattedVisit(),b.log("isChattedVisit -> is_chatted_visit",o),b.Chat.initFaq(),t&&!o&&((i=[])[0]=b.Chat.getChatSettings("chat_invite_greeting"),i[1]=b.Chat.getChatSettings("chat_invite_offer"),i[2]=b.Chat.getChatSettings("chat_invite_action"),b.log("getChatSettings -> invite messages",i),a.invited?a.invited&&!a.readed?(b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(i,!0)):a.invited&&a.readed&&!a.converted&&(b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(i,!0,!0)):(n=b.Chat.getChatSettings("invite_delay"),b.log("getChatSettings -> invite_delay",n),clearTimeout(b.Chat.invite_timeout),b.Chat.invite_timeout=setTimeout(function(){b.log("RUN INVITE"),b.Chat.toggleOperatorButton(),b.Chat.inviteVisitorInChat(i),b.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*n))),a=b.storage.localStorage.get("chat_operators"),(n=b.Chat.getCurrentOperator(e,a))?b.Chat.setOperator(n.operator_name,n.avatar_url):0<a.length&&0<e.length&&(a=b.Chat.getOnlineWidgetOperators(a,e)).length?b.Chat.setOperator(a[0].operator_name,a[0].avatar_url):b.Chat.setOperator("Оператор","/images/portraits/2.jpg")):b.log("Chat EVENT Offline")}),b.Chat.Events._callEvent("onOnline")):b.log("IGNORE Chat EVENT onOnline"))},100)}),b.DEBUG?(b.log("Chat DEBUG is ON"),Cloudim.Chat.init({uid:20621})):Cloudim.Chat.init({uid:b.W.chat_uid,group:b.W.chat_id})})),b.loadScript(b.JS_CDN+"_assets.min.js?v="+b.version,!0,function(){if(b.W.float_button&&b.log("float_button IS ON"),b.isMobile())b.W.mobile_button?b.insertWidget(b.W):b.log("mobile_button IS OFF");else if(b.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(b.insertWidget(b.W,!0),window.location.hash="#callback-showed")}),"#leadback"==window.location.hash)setTimeout(function(){b.insertWidget(b.W,!0)},3e3);else{if(!s||c||b.W.float_button)return b.insertWidget(e);b.log("Already Converted!")}})),b.sendEvent("pageview")},b.insertWidget=function(e,f){if(!0===b.dom_is_ready)return b.log("Widget has be inserted"),void(f&&b.showWidget(b.$("#lb_widget-root")));b.log("insertWidget");var t=window.location.host,t=encodeURI(b.PUBLIC_SERVER+"backend/widget_widget.php?h="+t+"&widget_key="+b.W.widget_key+"&v="+b.version);b.is_vk?b.DEBUG||(t+="&vk_api="+encodeURIComponent(document.location.href)):(b.isMobile()?(t+="&mobile",t+="&chat="+b.W.chat):(t+="&chat="+b.W.chat,b.log("self.W.chat_init",b.W.chat_init)),"1"==b.W.chat&&b.W.chat_init&&(t+="&chat_init="+b.W.chat_init)),b.log("url",t),b.$.ajax({type:"GET",async:!0,cache:!0,url:t,error:function(e,t,o){return b.log(o),b.log("Main HTML Failed to Load")},success:function(e){var t="";t=""==b.W.position?"bottom: 50px; right: 50px":b.W.position;var a=b.$("<div id='lb_widget-root'><div id='lb_widget-wrapper' style='display:none;'></div><div id='lb_eula_widget-wrapper' style='display:none;'></div><div id='lb_button-wrapper' style='position: fixed; "+t+" ; z-index: 10000000000;'></div></div>");if(a.find("#lb_widget-wrapper").html(e.html).hide(),a.find("#lb_eula_widget-wrapper").html(e.eula).hide(),a.find("#lb_widget-wrapper .lb_callback_time").text(b.W.callback_time||27),!b.storage.localStorage.isEmpty("scheduler")&&(!b.W.active&&b.W.night_mode&&(void 0===b.W.suitable_time||"nigth"==b.W.suitable_time)||void 0!==b.W.suitable_time&&"always"==b.W.suitable_time)){var n=b.storage.localStorage.get("scheduler");if("object"==typeof n&&0<n.days.length){a.on("click","#lb_widget-scheduler--link",function(e){e.preventDefault(),a.find("#lb_widget-scheduler").show(),a.find("#lb_widget-invite").hide(),a.find("#lb_timer").hide(),a.find("#lb_widget-scheduler--controls").hide(),a.find("#lb_widget-scheduler").data("opened",!0)}),a.on("change","#lb_widget-scheduler--days",function(e){var t=b.$("option:selected",this).data();if(null!==t){a.find("#lb_widget-scheduler--times").empty();for(var o=0,i=n.times[t.index].length;o<i;o++)a.find("#lb_widget-scheduler--times").append('<option value="'+b.escapeHtml(n.times[t.index][o].value)+'">'+b.escapeHtml(n.times[t.index][o].label)+"</option>")}});for(var o=0,i=n.days.length;o<i;o++)a.find("#lb_widget-scheduler--days").append('<option value="'+b.escapeHtml(n.days[o].value)+'" data-index="'+o+'">'+b.escapeHtml(n.days[o].label)+"</option>");a.find("#lb_widget-scheduler--days").trigger("change"),a.find("#lb_widget-scheduler--controls").show(),b.W.active||"use_holidays"!==b.W.active_changed||a.find("#lb_widget-scheduler--link").click()}}if(!b.storage.localStorage.isEmpty("departments"))for(var l=b.storage.localStorage.get("departments"),o=0,i=l.length;o<i;o++)a.find("#lb_widget-department--items").append('<label class="lb_widget-radio"><input type="radio" name="lb_widget-department--value" data-index="'+o+'" value="'+b.escapeHtml(l[o])+'" '+(0==o?'checked="checked"':"")+"/>&nbsp;"+b.escapeHtml(l[o])+"</label>");if(b.parseWidgetText(a),b.isMobile()){b.storage.localStorage.remove("history_states"),window.addEventListener("popstate",function(e){b.log("Event state",event);var t=b.storage.localStorage.get("history_states");if(t&&t.length){t=t[t.length-1]+"";return b.log("Last state is ",t),"widget"==t?(b.log("Poping state widget"),b.hideWidget(a),e.preventDefault(),!1):"dialog"==t?(b.log("Poping state dialog"),b.$multibutton.toggleClass("lb-widget--open-dialog"),b.deleteHistoryState("dialog"),e.preventDefault(),!1):"chat"==t&&Object.keys(b.Chat).length?(b.log("Poping state chat"),b.Chat.closeChat(),e.preventDefault(),!1):void 0}},!1),b.$multibutton=a.find("ldiv.lb-widget"),b.is_multibutton=!!b.$multibutton.length,a.find("#lb_exit").on("click",function(){b.hideWidget(a)});var r,s=a.find("#lb_mobile-call"),c=a.find(".lb_mobile-wrapper");if(b.$("body").on("click",'a[href="#callback"]',function(e){b.showWidget(a),e.preventDefault()}),b.$("body").on("click","#lb_widget-root a.js-trigger-callback",function(e){b.showWidget(a),e.preventDefault()}),b.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(b.showWidget(a),window.location.hash="#callback-showed")}),"1"==b.W.chat){try{b.$(window).on("ready",function(){var e=b.screen_width/window.innerWidth;a.find(".lb-widget-button").css("zoom",1/e),a.find(".lb-widget-welcome-panel").css("zoom",1/e)})}catch(e){}s.on("click",function(){b.showWidget(a)})}else b.$(window).on("orientationchange load",function(){90==window.orientation||-90==window.orientation?(b.screen_width=Math.max(window.screen.availWidth,window.screen.availHeight),b.screen_height=Math.min(window.screen.availWidth,window.screen.availHeight)):(b.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),b.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)),b.mobileButton(s,c)}),b.$(window).on("touchmove",function(){b.mobileButton(s,c)}),b.$(window).on("touchstart",function(){s.css("opacity",0)}),b.$(window).on("touchend",function(){s.css("opacity",1),b.mobileButton(s,c)}),b.$(window).on("scroll",function(){s.css("opacity",0),clearTimeout(r),r=setTimeout(function(){s.css("opacity",1),b.mobileButton(s,c)},300)}),b.mobileButton(s,c),b.is_multibutton?(a.on("click","#lb_widget-wrapper .lb-widget-button",function(e){b.$multibutton.toggleClass("lb-widget--open-dialog"),b.writeHistoryState("dialog")}),a.on("click","#lb_widget-wrapper .lb-action-link--discard",function(e){e.preventDefault(),b.$multibutton.toggleClass("lb-widget--open-dialog"),b.deleteHistoryState("dialog")}),a.on("click","#lb_widget-wrapper .lb-widget > .lb-overlay",function(e){e.preventDefault(),b.$multibutton.hasClass("lb-widget--open-dialog")&&b.deleteHistoryState("dialog"),b.$multibutton.toggleClass("lb-widget--open-dialog")}),b.startMultiButtonSlides()):s.find(".lb-click_area").on("click",function(){b.showWidget(a)});c.find("input.lb_input").on("focus",function(){c.find(".lb_title-desc").hide(),c.find(".lb_form-label").show()}),!b.is_multibutton||(t=a.find("#lb-multibutton-style-os")).length&&(b.isIOS()?t.attr("href",b.PUBLIC_SERVER+"/css/multibutton/style-ios.min.css?"+b.version):t.attr("href",b.PUBLIC_SERVER+"/css/multibutton/style-android.min.css?"+b.version),t.on("load",function(){setTimeout(function(){b.$multibutton.show(),b.$multibutton.find(".lb-overlay").attr("style",""),b.$multibutton.find(".lb-dialog").attr("style","")},50)}))}else{if(b.$('a[href="#callback"]').on("click",function(e){b.showWidget(a),e.preventDefault()}),b.W.float_button&&e.button){a.find("#lb_button-wrapper").html(e.button),"1"==b.W.chat&&a.find(".phone-call_wave").removeClass("phone-call_wave__stroke");var d=a.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(),d=b.parseMacros(d);if(d=b.parseInlineTemplates(d),d=b.parseCountDownMacros(d),a.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(d),a.find("#lb_button-call").hasClass("lb_fixed-button"))a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){b.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),b.storage.localStorage.set("tooltip_closed",!0))});else if("0"!=b.W.chat||b.isTouch())a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){b.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),b.storage.localStorage.set("tooltip_closed",!0))});else{a.find("#lb_button-wrapper").attr("title","Нажмите, чтобы заказать обратный звонок или перетащите, если кнопка мешает навигации.");try{b.$(a.find("#lb_button-call")[0]).draggableTouch().on("dragstart",function(e,t){this.ignoreClick=!1,t&&(this.startPosition=t)}).on("dragend",function(e,t){t&&(this.startPosition.top-t.top==0||this.startPosition.left-t.left==0||(this.ignoreClick=!0))}),a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){a.find("#lb_button-call")[0].ignoreClick||(b.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),b.storage.localStorage.set("tooltip_closed",!0)))})}catch(e){a.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){b.showWidget(a),a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),b.storage.localStorage.set("tooltip_closed",!0))})}}var u,g=null,h=(b.$(document).innerHeight()-b.$(window).height())/b.$(window).height();"0"==b.W.chat&&.5<h?(a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),b.$(document).on("scroll",function(){if(b.widgetIsShow(a))return!0;var e=b.$(document).scrollTop()/(b.$(document).innerHeight()-b.$(window).height());a.find("#lb_button-wrapper .lb_call-btn").css("opacity",1),clearInterval(g),g=setInterval(function(){e<=.3&&a.find("#lb_button-wrapper .lb_call-btn").css("opacity",.7),clearInterval(g)},500),(150<b.$(document).scrollTop()||.3<e)&&(clearInterval(null),a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),300<b.$(document).scrollTop()&&.4<e&&a.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"))})):(a.find("#lb_button-wrapper").show(),a.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),"0"==b.W.chat?a.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"):a.find("#lb_button-wrapper .lb_call-btn").css("opacity",1)),b.W.tooltip_scroll&&(u=null,b.$(document).on("scroll",function(){clearInterval(u),.5<=b.$(document).scrollTop()/(b.$(document).innerHeight()-b.$(window).height())&&(u=setTimeout(function(){b.storage.localStorage.isEmpty("tooltip_closed")||!1===b.storage.localStorage.get("tooltip_closed")?void 0===a.find("#lb_button-call:hover")[0]&&a.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--hide")&&(a.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--hide").addClass("lb_button_tooltip--show"),setTimeout(function(){a.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--alert")},3e3)):b.log("tooltip_closed"),clearTimeout(u)},500))})),b.W.tooltip_hover&&a.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--hover"),a.find("#lb_button-wrapper .lb_button_tooltip .lb_button_tooltip--close").on("click",function(e){a.find("#lb_button-wrapper .lb_button_tooltip--container").remove(),b.storage.localStorage.set("tooltip_closed",!0)})}a.find("#lb_exit").on("click",function(){b.hideWidget(a)}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(b.log("Escape key detected"),b.hideWidget(a))})}a.on("click",".lb_eula--link",function(e){e.preventDefault(),e.stopPropagation(),b.showEula(b.$(this).attr("href"))}),a.on("click","#lb_eula_widget-wrapper",function(){b.hideEula()});var _=b.getPhonePrefix();a.on("focus","#lb_phone",function(){var e=b.$(this);""==e.val()&&e.val(_),e.val()==_&&setTimeout(function(){e.get(0).selectionStart=e.get(0).selectionEnd=100},10)}).on("change","#lb_phone",function(){var e=b.$(this).val().replace(/[^\d\+]+/g,"");b.$(this).val(e),!1!==(e=b.checkPhone(e))&&b.$(this).val(e)}).on("keypress","#lb_phone",function(e){var t=b.$(this).val().replace(/[^\d\+]+/g,"");"+789"===t.substr(0,4)&&b.$(this).val("+7"+t.substr(3)),13==e.which&&(a.find("#lb_send").trigger("click"),e.preventDefault())}).on("paste","#lb_phone",function(e){return e.preventDefault(),!1}).on("drop","#lb_phone",function(e){return e.preventDefault(),!1}).attr("placeholder",_),a.on("click","#lb_send",function(){var e;!b.storage.localStorage.isEmpty("departments")?(e=a.find("#lb_phone").val(),!1!==(e=b.checkPhone(e))?(a.find("#lb_phone").removeClass("lb_error"),a.find("#lb_widget-invite").hide(),a.find("#lb_widget-scheduler").hide(),a.find("#lb_widget-form").hide(),a.find("#lb_widget-scheduler--controls").hide(),a.find("#lb_widget-department").show(),a.find("#lb_send--department").on("click",function(){b.callTo(a)})):a.find("#lb_phone").addClass("lb_error")):b.callTo(a)}),!b.W.active&&b.W.night_mode&&(a.find("#lb_timer").hide(),a.find(".lb_h6").css("visibility","hidden")),b.$("body").append(a),b.isMobile()&&a.find("#lb_widget-wrapper").show(),b.dom_is_ready=!0;var m,d=b.getCookie("__leadback_need_call");d?(b.log("Run magic_form"),b.removeCookie("__leadback_need_call",{path:"/"}),b.$("#lb_phone").val(d.phone),d.form_type&&-1!==["magic_form","manual_form"].indexOf(d.form_type)||(d.form_type="magic_form"),h={},"magic_form"===d.form_type?h.initiator="magic_forms":"manual_form"===d.form_type&&(h.initiator="manual_forms"),void 0!==b.W.magic_forms_callback&&"show"===b.W.magic_forms_callback&&b.showWidget(a),void 0!==d.label&&(h.label=d.label),b.callTo(a,h)):(f?b.showWidget(a):void 0!==b.W.catch_on_exit&&!b.W.catch_on_exit||b.startCursometer(a),void 0!==b.W.catch_by_timer&&b.W.catch_by_timer&&(m=1e3*b.W.catch_by_timer_time,void 0===b.getCookie(b.ct)?setTimeout(function(){b.log("Time show after: "+m),b.showWidget(a),b.setCookie(b.ct,{campaign:b.W.widget_key,user_id:b.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*b.W.timeout)})},m):b.log("Time show timeout"))),"function"==typeof window.muse_init&&b.$("body").addClass("initialized")},dataType:"jsonp",jsonpCallback:"jsonpWidgetCallback"}),void 0!==b.W.magic_forms&&(t=!1,!b.W.active&&b.W.night_mode&&"off"===b.W.magic_forms_night_mode&&(t=!0),"none"!==b.W.magic_forms&&!1===t&&(b.setupForms(),"undefined"!=typeof MutationObserver&&(b.leadbackObserver=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){var t;e.tagName&&"FORM"===e.tagName?(b.log("Mutation observer added form",e),b.setupForms()):e.tagName&&e.children&&(t=e.querySelectorAll("form"),b.log("Searching forms in added node",e,"inner forms length",t?t.length:0),t&&t.length&&b.setupForms())})})}),b.leadbackObserver.observe(document.documentElement||document.body,{subtree:!0,childList:!0}))))},b.setupForms=function(){if("manual"===b.W.magic_forms){if(b.form_settings=b.storage.localStorage.get("form_settings"),!1!==b.form_settings&&b.form_settings.forms&&b.form_settings.forms.length){b.log("###########"),b.log("FORM SETTINGS RECEIVED AND ACTIVE",b.form_settings);for(var e=[],t=b.form_settings.use_custom_selector&&Number(b.form_settings.use_custom_selector),o=0;o<b.form_settings.forms.length;o++)e.push({selector:b.form_settings.forms[o].selector,data:b.form_settings.forms[o]});for(t&&e.push({selector:"form.lb-magic-form",data:null}),b.log(">>> Form selectors getted",e),b.log(">>> Magic forms are: "+t),b.log("###########"),o=0;o<e.length;o++){var i=b.$(e[o].selector+":not([data-ldbck-form-init])");if(i&&i.length)for(var a=0;a<i.length;a++){var n,l=b.$(i[a]);b.log(">>> Form with selector",e[o].selector,"FOUND. Full class list: ",l.attr("class")),l.attr("data-ldbck-form-init",1),l.data("form-data",e[o].data),"#debug"===document.location.hash&&l.attr("style","border: 1px solid red !important"),e[o].data?(b.log(">>> Form with selector",e[o].selector,"has selector custom data",e[o].data),"onSubmit"===l.data("form-data").event?(b.log(">>> Binding form onSubmit"),l.on("submit",function(){b.log(">>> Manual form onSubmit");var e=b.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(b.log(">>> Manual form has redirect, setting cookie"),b.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(b.log(">>> Manual form has no redirect, calling from widget"),b.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==b.W.magic_forms_callback&&"show"===b.W.magic_forms_callback&&b.showWidget(b.$("#lb_widget-root")),e.label=this.data("form-data").name,b.callTo(b.$("#lb_widget-root"),e)))}.bind(l))):(b.log(">>> Binding form manual onClick"),l.data("form-data").button_selector&&(b.log(">>> manual form onClick selector: ",l.data("form-data").button_selector),(n=b.getFormChildBySelector(l,l.data("form-data").button_selector))&&n.length?(b.log(">>> Manual form onClick has button",n),n.on("click",function(){var e=b.getManualFormPhone(this);e&&(Number(this.data("form-data").has_redirect)?(b.log(">>> Manual form onClick has redirect setting cookie"),b.setNeedCallCookie(e,this.data("form-data").name,"manual_form")):(b.log(">>> Manual form has no redirect, calling from widget"),b.$("#lb_phone").val(e),e={initiator:"manual_forms"},void 0!==b.W.magic_forms_callback&&"show"===b.W.magic_forms_callback&&b.showWidget(b.$("#lb_widget-root")),e.label=this.data("form-data").name,b.callTo(b.$("#lb_widget-root"),e)))}.bind(l))):b.log(">>> Button by selector "+l.data("form-data").button_selector+" NOT FOUND !!!")))):(b.log(">>> MAGIC FORM DETECTED!!! Making submit event"),l.attr("data-ldbck-form-init",1),l.on("submit",function(){var e=b.getPhoneByInputSelector("input",this);e&&b.setNeedCallCookie(e,b.$(this).data("magic-form-label"),"magic_form")})),b.log("###########")}}}}else{t="";"custom"===b.W.magic_forms&&(t=".lb-magic-form"),b.log(">>> Automatic magic forms section: "+t);for(var r=b.$("form"+t+":not([data-ldbck-form-init])"),s=0;s<r.length;s++){var c=b.$(r[s]);c.attr("data-ldbck-form-init",1),c.on("submit",function(){var e=b.getPhoneByInputSelector("input",this);e&&b.setNeedCallCookie(e,b.$(this).data("magic-form-label"),"magic_form")})}}},b.getFormChildBySelector=function(e,t){var o=e.find(t);if(b.log(">>> Searching child inside form",t),o&&o.length)return b.log(">>> Found child inside form",t),o;if(b.log(">>> Form child with selector (",t,") not found, searching global"),(o=b.$.find(t))&&o.length){b.log(">>> Children ("+o.length+") with selector (",t,") found global! Trying to search in child form...",o);for(var i=0;i<o.length;i++){var a=e.find(o[i]);if(a&&a.length)return b.log(">>> Child with selector (",t,") found in form!"),a}}return b.log(">>> Child with selector (",t,") not found in form!"),null},b.getManualFormPhone=function(e){var t,o,i=null;return e.data("form-data").fields&&e.data("form-data").fields.length&&((t=e.data("form-data").fields.filter(function(e){return"phone"===e.type&&""!==e.selector.trim()}))&&t.length&&(t=t[0],(o=b.getFormChildBySelector(e,t.selector))&&o.length&&(i=b.checkPhone(o.val()),b.log(">>> Result phone FOUND by settings field selector",t.selector,"with value",i)))),i||(i=b.getPhoneByInputSelector("input",e),b.log(">>> Getting result phone by all inputs",i)),i},b.setNeedCallCookie=function(e,t,o){b.setCookie("__leadback_need_call",{phone:e,label:t,form_type:o},{path:"/",expires:new Date((new Date).getTime()+6e4)})},b.getPhoneByInputSelector=function(e,t){var a=[];b.$(e,t).each(function(e,t){var o,i=0;if(void 0!==b.$(t).attr("type")){if(o=b.$(t).attr("type"),-1===["tel","text"].indexOf(o))return;"tel"===o&&(i+=50)}void 0!==b.$(t).attr("name")&&(o=b.$(t).attr("name"),-1!==["phone","number","callback","tel","telephone"].indexOf(o)&&(i+=50));t=b.checkPhone(t.value);!1!==t&&(a[a.length]={value:t,priority:i})});var o=null;if(0<a.length)for(var i=0,n=a.length;i<n;i++)(null===o||a[i].priority>o.priority)&&(o=a[i]);return o?o.value:null},b.checkPhone=function(e){return("7"!=(e="789"==(e="8"==(e=("495"==(e="9"==(e=e.replace(/[^\d]+/g,"")).substr(0,1)&&10==e.length?"7"+e:e).substr(0,3)||"499"==e.substr(0,3)||"812"==e.substr(0,3)||"4832"==e.substr(0,4))&&10==e.length?"7"+e:e).substr(0,1)&&11==e.length?"7"+e.substr(1):e).substr(0,3)&&12==e.length?"7"+e.substr(2):e).substr(0,1)||11==e.length)&&((11==e.length||12==e.length)&&(e="+"+e))},b.startCursometer=function(t){b.restarted||b.isMobile()?b.log("IGNORE startCursometer"):(b.log("startCursometer"),b.$(window).cursometer({onUpdateSpeed:function(e,t){if(null!==e)return b.LAST_SPEED=t},updateSpeedRate:15}),b.$("html").mouseout(function(e){e=e||window.event,b.LAST_X_POSITION=e.clientX,b.LAST_Y_POSITION=e.clientY,0<b.LAST_Y_POSITION||b.LAST_X_POSITION<200||(b.total_time>=b.activity?(e=void 0===b.getCookie(b.cg)||!b.getCookie(b.cg).converted||b.W.allow_multiple_conversions,.225<b.LAST_SPEED&&e&&void 0===b.getCookie(b.ct)&&b.last_visit_timeout<300?(b.stat.x=b.LAST_X_POSITION,b.stat.y=b.LAST_Y_POSITION,b.stat.s=b.LAST_SPEED,b.showWidget(t),b.setCookie(b.ct,{campaign:b.W.widget_key,user_id:b.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*b.W.timeout)}),b.log("Set timeout "+b.W.timeout)):b.log("Impression timeout",b.last_visit_timeout,void 0===b.getCookie(b.ct))):b.log("activity",b.activity,b.total_time,b.last_visit_timeout))}))},b.writeHistoryState=function(e){if(void 0!==window.history)try{var t=b.storage.localStorage.get("history_states");t?t.push(e):t=[e],b.storage.localStorage.set("history_states",t);var o={};o["ldbck_"+e+"_showed"]=1,b.log("Writing history state",e),window.history.pushState(o,"")}catch(e){console.warn("exc",e)}},b.deleteHistoryState=function(e){b.log("Deleting history state",e);var t=b.storage.localStorage.get("history_states");t&&-1<t.indexOf(e)&&(t.splice(t.indexOf(e,1)),b.log("updating history",t),b.storage.localStorage.set("history_states",t))},b.showWidget=function(e){b.log("showWidget"),b.widgetIsShow(e)?b.log("IS now shoed"):("function"==typeof b.beforeOpenWidget&&b.beforeOpenWidget(),b.runCountDownTimers(),b.sendEvent("impression"),b.sendGoal("LEADBACK_OPEN"),e.show(),b.isMobile()?(b.writeHistoryState("widget"),e.find(".lb_mobile-wrapper").show(),b.mobileAdoptation()):(e.find("#lb_widget-wrapper").show(),e.find("#lb_phone").focus()),b.W.float_button&&e.find("#lb_button-wrapper").hide()),void 0!==b.W.hide_call_timer&&b.W.hide_call_timer&&e.find("#lb_timer").hide()},b.hideWidget=function(e){e.find("#lb_widget-scheduler").is(":visible")&&(e.find("#lb_widget-scheduler").hide(),e.find("#lb_widget-scheduler").data("opened",!1),e.find("#lb_widget-invite").show(),b.W.active&&e.find("#lb_timer").show(),e.find("#lb_widget-scheduler--controls").show()),b.isMobile()?(b.deleteHistoryState("widget"),b.sendGoal("LEADBACK_CLOSE"),e.find(".lb_mobile-wrapper").hide(),b.mobileAdoptation()):(b.sendGoal("LEADBACK_CLOSE"),e.find("#lb_widget-wrapper").hide(),b.W.float_button&&e.find("#lb_button-wrapper").show())},b.startMultiButtonSlides=function(){return!!b.is_multibutton&&setInterval(function(){var o,i,e;b.dom_is_ready&&(o=null,b.$("#lb_widget-root .lb-button__slides .lb-button-slides__item").not(".lb-widget-panel__item--hide").each(function(e,t){b.$(t).hasClass("lb-button-slides__item--active")?(o=e,b.$(t).removeClass("lb-button-slides__item--active"),(i=b.$(t).data("slide-action"))&&b.$(t).closest(".lb-button-flipper__front").removeClass("lb-button-flipper__front--"+i)):null!==o&&(b.$(t).addClass("lb-button-slides__item--active"),o=null,(i=b.$(t).data("slide-action"))&&b.$(t).closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i))}),null!==o&&((e=b.$("#lb_widget-root .lb-button__slides .lb-button-slides__item:first-child").not(".lb-widget-panel__item--hide")).addClass("lb-button-slides__item--active"),(i=e.data("slide-action"))&&e.closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i)))},1e4)},b.getUrlParameter=function(e){var t=location.search;e=e.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t),t="";return e&&0<e.length&&(t=e[1].replace(/\+/g," "),t=decodeURIComponent(t),t=(t=b.escapeHtml(t)).replace(/\_/g," ")),null===e?"":t},b.checkCanReplaceMacro=function(e){if("string"!=typeof e)return!1;for(var t=["/images/uploads/chat","https://leadback.ru/ya-money?payment=","https://leadback.ru/chat-payments?payment=","s3upload://","https://leadback.s3.eu-central-1.amazonaws.com/chat_uploads/","https://leadback.s3.eu-central-1.amazonaws.com/uploads/","https://leadback.s3.yandexcloud.net/chat_uploads/"],o=0;o<t.length;o++)if(0===e.indexOf(t[o]))return!1;return!0},b.parseQueryMacros=function(e){if(!b.checkCanReplaceMacro(e))return e;var t,o=e.match(/\[get\:([^\]\|]+)\|?([^\]\|]+)?\]/gm);if(null!==o&&o.length)for(var i=0,a=o.length;i<a;i++){var n,l=o[i].replace(/^\[/,"").replace(/\]$/,"");e=-1<(n=(l=l.substr(l.indexOf(":")+1)).lastIndexOf("|"))?""!==(t=b.getUrlParameter(l.substr(0,n)))?e.replace(o[i],t):e.replace(o[i],l.substr(n+1)):(t=b.getUrlParameter(l),e.replace(o[i],t))}return e},b.parseTimeMacros=function(e){if(!b.checkCanReplaceMacro(e))return e;for(var t,o=[],i=e.match(/\[(time)(\+|\-)?(\d+)?\]/gim),a=0,n=(o=null!==i?i:o).length;a<n;a++){var l=new Date,r=o[a].replace(/[\[\]]/g,"");e=(-1<r.indexOf("-")?(t=Number(r.split("-")[1]),l.setMinutes(l.getMinutes()-t)):-1<r.indexOf("+")&&(t=Number(r.split("+")[1]),l.setMinutes(l.getMinutes()+t)),e.replace(o[a],l.toLocaleTimeString().substr(0,l.toLocaleTimeString().lastIndexOf(":"))))}return e},b.parseMacros=function(e){return b.checkCanReplaceMacro(e)?(e=b.parseNextDayMacro(e),e=b.parseTimeMacros(e),e=b.parseQueryMacros(e)):e},b.parseNextDayMacro=function(e){var t,o;return e=-1<e.indexOf("%nextDay%")||-1<e.indexOf("%nextDay2%")?"object"==typeof(t=b.storage.localStorage.get("scheduler"))&&0<t.days.length&&(o=Date.parse(t.days[0].value))?(o=new Date(o).getDay(),(e=e.replace(/%nextDay%/gi,b.getNextMacroDay(o,!1))).replace(/%nextDay2%/gi,b.getNextMacroDay(o,!0))):(e=e.replace(/%nextDay%/gi,"")).replace(/%nextDay2%/gi,""):e},b.getNextMacroDay=function(e,t){return(t?["в воскресенье","в понедельник","во вторник","в среду","в четверг","в пятница","в субботу"]:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"])[e]},b.getCountDownType=function(e){return!e||e.match(/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9])\s?(?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/)?"date":e.match(/time\+(\d+d;?)?(\d+h;?)?(\d+m;?)?/)?"time":e.match(/(\d+h;?)?(\d+m;?)?(\d+s;?)?/)?"none":"date"},b.addDays=function(e,t){return e.setTime(e.getTime()+24*t*60*60*1e3),e},b.addHours=function(e,t){return e.setTime(e.getTime()+60*t*60*1e3),e},b.addMinutes=function(e,t){return e.setTime(e.getTime()+60*t*1e3),e},b.addSeconds=function(e,t){return e.setTime(e.getTime()+1e3*t),e},b.parseCountDownMacros=function(e){if(!b.checkCanReplaceMacro(e))return e;for(var t,o=/\[countdown\|([^\]\|]+)\|?([^\]\|]+)?\|?([^\]\|]+)?\|?([^\]\|]+)?]/gi,i=null;null!==(t=o.exec(e));){var a,n,l,r,s,c,i=!0,d="",u="";switch(b.getCountDownType(t[1])){case"date":d=t[1];break;case"time":for(s=t[1].replace("time+","").split(";"),c=0;c<s.length;c++)-1<s[c].indexOf("d")&&(a=s[c].replace("d","")),-1<s[c].indexOf("h")&&(n=s[c].replace("h","")),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""));p=b.visit_date,a&&""!==a&&(p=b.addDays(p,a)),n&&""!==n&&(p=b.addHours(p,n)),l&&""!==l&&(p=b.addMinutes(p,l)),r&&""!==r&&(p=b.addSeconds(p,r));var g=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(p),h=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(p),_=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(p),m=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(p)),f=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(p)),p=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(p)),d=g+"-"+h+"-"+_+" "+(m=m<10?"0"+m.toString():m)+":"+(f=f<10?"0"+f.toString():f)+":"+(p=p<10?"0"+p.toString():p);break;case"none":for(s=t[1].replace("time+","").split(";"),d="",c=u=0;c<s.length;c++)-1<s[c].indexOf("h")&&(n=s[c].replace("h",""),u+=3600*Number(n)),-1<s[c].indexOf("m")&&(l=s[c].replace("m",""),u+=60*Number(l)),-1<s[c].indexOf("s")&&(r=s[c].replace("s",""),u+=Number(r))}e=e.replace(t[0],'<span class="lbwidget-countdown" data-ttl="'+u+'" data-date="'+d+'" data-tpl="'+(t[2]||"")+'" data-expire="'+(t[3]||"")+'" data-format="'+(t[4]||"")+'"></span>')}return e},b.runCountDownTimers=function(){try{clearInterval(b.countDownInterval)}catch(e){}b.replaceTTLDate(),b.setCountDownText(),b.countDownInterval=setInterval(function(){b.setCountDownText()},1e3)},b.replaceTTLDate=function(){for(var e=b.$("span.lbwidget-countdown"),t=0;t<e.length;t++){var o,i,a,n,l,r,s=b.$(e[t]);s.data("ttl")&&""!==s.data("ttl")&&((r=new Date).setTime(r.getTime()+1e3*Number(s.data("ttl"))+1e3),o=new Intl.DateTimeFormat("ru",{year:"numeric"}).format(r),i=new Intl.DateTimeFormat("ru",{month:"2-digit"}).format(r),a=new Intl.DateTimeFormat("ru",{day:"2-digit"}).format(r),n=Number(new Intl.DateTimeFormat("ru",{hour:"2-digit"}).format(r)),l=Number(new Intl.DateTimeFormat("ru",{minute:"2-digit"}).format(r)),r=Number(new Intl.DateTimeFormat("ru",{second:"numeric"}).format(r)),n<10&&(n="0"+n.toString()),l<10&&(l="0"+l.toString()),r<10&&(r="0"+r.toString()),s.data("date",o+"-"+i+"-"+a+" "+n+":"+l+":"+r),s.attr("data-date",o+"-"+i+"-"+a+" "+n+":"+l+":"+r),s.data("ttl",""),s.removeAttr("ttl"))}},b.countdownTimeDeclensions={hour:["час","часа","часов"],minute:["минута","минуты","минут"],second:["секунда","секунды","секунд"]},b.declension=function(e,t,o,i,a){t=null==t?"":t,o=null==o?"я":o,i=null==i?"и":i,a=null==a?"й":a;var n=(e=null==e?0:e)%100,l="";if(10<=e&&e<=20||10<=n&&n<=20)l=a;else switch(e%10){case 1:l=o;break;case 2:case 3:case 4:l=i;break;default:l=a}return t+l},b.prepareCountDownText=function(e,t,o,i){if(e.data("date")&&""!==e.data("date")&&(a=Date.parse(e.data("date"))),isNaN(a)||!a)return"";4!==(i=(i=i||"дн. ,:,:,").split(",")).length&&(i="дн. ,:,:,".split(","));var a,n,l,r,s=a-(new Date).getTime(),c="";return 0<=s?(n=Math.floor(s/864e5),r=Math.floor(s%864e5/36e5),l=Math.floor(s%36e5/6e4),e=Math.floor(s%6e4/1e3),a=0<n?n+i[0]:"",n=(s=i[1]).replace(/[^а-яё]/gi,""),n=b.$.trim(n.toLowerCase()),-1<(n=b.countdownTimeDeclensions.hour.indexOf(n))&&(s=s.replace(b.countdownTimeDeclensions.hour[n],b.declension(r,"час","","а","ов"))),n=r<10?"0"+r.toString()+s:r.toString()+s,s=(r=i[2]).replace(/[^а-яё]/gi,""),s=b.$.trim(s.toLowerCase()),-1<(s=b.countdownTimeDeclensions.minute.indexOf(s))&&(r=r.replace(b.countdownTimeDeclensions.minute[s],b.declension(l,"минут","а","ы",""))),l=l<10?"0"+l.toString()+r:l.toString()+r,i=(r=i[3]).replace(/[^а-яё]/gi,""),i=b.$.trim(i.toLowerCase()),-1<(i=b.countdownTimeDeclensions.second.indexOf(i))&&(r=r.replace(b.countdownTimeDeclensions.second[i],b.declension(e,"секунд","а","ы",""))),c=a+n+l+(e<10?"0"+e.toString()+r:e.toString()+r),t&&(-1===t.indexOf("%s")&&(t+=" %s"),c=t.replace("%s",c))):o&&(c=o),c},b.setCountDownText=function(){var e=b.$("span.lbwidget-countdown");if(0===e.length)return clearInterval(b.countDownInterval),!1;for(var t=0;t<e.length;t++){var o=b.$(e[t]),i=""!==o.data("tpl")?o.data("tpl"):null,a=""!==o.data("expire")?o.data("expire"):null,n=""!==o.data("format")?o.data("format"):null,n=b.prepareCountDownText(o,i,a,n);o.html(n)}},b.parseWidgetText=function(e){for(var t=e.find(".lb-parse-text"),o=0;o<t.length;o++){var i=b.$(t[o]),a=i.html();"string"==typeof a&&(i.hasClass("lb-parse-inline")&&(a=b.parseInlineTemplates(a)),a=b.parseMacros(a),a=b.parseCountDownMacros(a),i.html(a))}},b.getReplacedTags=function(){return b.replacedTags},b.parseInlineTemplates=function(e){if(!b.checkCanReplaceMacro(e))return e;var t=[],o=e.match(/\[\#([^\#\|\]]+)\]/gm);null!==o&&(t=o);for(var i=0,a=(t=null!==(o=e.match(/\[\#([^\#\|\]]+)\|([^\]]+)\]/gm))?t.concat(o):t).length;i<a;i++){var n=[],n=0<t[i].indexOf("|")?t[i].replace(/[\[\]]/g,"").split("|"):[t[i].replace(/[\[\]]/g,""),""],l=b.$(n[0]);0<l.length&&""!=b.$.trim(l.text())?(e=e.replace(t[i],l.text()),b.replacedTags[n[0].replace("#","")]=l.text()):(e=e.replace(t[i],n[1]),b.replacedTags[n[0].replace("#","")]=n[1])}return e},b.widgetIsShow=function(e){return(b.isMobile()?e.find(".lb_mobile-wrapper"):e.find("#lb_widget-wrapper")).is(":visible")},b.showEula=function(e){b.$("#lb_eula_widget-wrapper").show(),b.$("#lb_eula--frame").attr("src",e)},b.hideEula=function(){b.$("#lb_eula_widget-wrapper").hide(),b.isMobile()||b.$("#lb_phone").focus()},b.callTo=function(t,o){b.log("callTo"),b.sendEvent("before_call");var e=t.find("#lb_phone").val();if(!1!==(e=b.checkPhone(e))){if(t.find("#lb_phone").removeClass("lb_error"),b.log("self.W.personal_agreement",b.W.personal_agreement),b.W.personal_agreement){var i=t.find("#lb_eula_checked");if(b.log("eula_checked",i,i.is(":checked")),!i.is(":checked"))return t.find("#lb_eula_warning").show(),void i.closest(".lb_eula-container").addClass("lb_error");t.find("#lb_eula_warning").hide(),i.closest(".lb_eula-container").removeClass("lb_error")}b.sendGoal("LEADBACK_CALL",o),void 0!==b.W.hide_call_timer&&b.W.hide_call_timer?t.find(".lb_show_when_calling").hide():(b.startTimer(t),t.find(".lb_show_when_calling").show()),t.find(".lb_hide_when_calling").hide(),t.find("#lb_send").off("click"),t.find("#lb_button_call_success").off("click").on("click",function(){b.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_button_call_success--department").off("click").on("click",function(){b.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_widget-scheduler--controls").hide();var a="";!0===(!b.W.active&&"use_holidays"===b.W.active_changed||t.find("#lb_widget-scheduler").data("opened"))&&(a=t.find("#lb_widget-scheduler--days").val()+" "+t.find("#lb_widget-scheduler--times").val());var n,l="",r="",s=!b.storage.localStorage.isEmpty("departments"),c="";return"object"==typeof o&&(void 0!==o.delayed&&(a=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(o.delayed)?o.delayed:(n=["00","0",""],(i=new Date).setSeconds(i.getSeconds()+parseInt(o.delayed,10)),i.getFullYear()+"-"+(n[new String(i.getMonth()+1).length]+new String(i.getMonth()+1))+"-"+(n[new String(i.getDate()).length]+new String(i.getDate()))+" "+(n[new String(i.getHours()).length]+new String(i.getHours()))+":"+(n[new String(i.getMinutes()).length]+new String(i.getMinutes()))+":"+(n[new String(i.getSeconds()).length]+new String(i.getSeconds()))),b.log("SET delayed_time",a)),void 0!==o.label&&(l=o.label),void 0!==o.initiator&&(r=o.initiator),s&&void 0!==o.department&&(c=o.department)),b.log("Department assigned",c),""===c&&s&&(c=t.find('#lb_widget-department--items input[name="lb_widget-department--value"]:checked').val()),b.$.ajax({type:"GET",async:!0,url:b.PUBLIC_SERVER+"backend/widget_call.php",data:{site:window.location.host,phone:e,widget_key:b.W.widget_key,user_id:b.W.user_id,delayed:a,tz:b.getTz(),guid:b.getCookie(b.cg).guid,calltouch:window.calltouch_phone||window.calltouch_phone_1||window.calltouch_phone_2||"",department:c,label:l,initiator:r,cache:Math.random()},success:function(e){return b.setCookie(b.cg,{guid:b.getCookie(b.cg).guid,converted:!0},{path:"/",expires:99999}),"delayed"==e.result?(b.stopTimer(t),t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_delay-date").text(e.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),t.find(".lb_delay-time").text(e.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1")),t.find("#lb_close").on("click",function(){t.hide(),b.isMobile()&&b.mobileAdoptation()})):b.isMobile()&&"success"==e.result?(t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_message_title--delayed").hide(),t.find(".lb_message_title--success").show(),t.find("#lb_close").on("click",function(){t.hide(),b.isMobile()&&b.mobileAdoptation()})):"notice"!==e.result&&"empty_list"!==e.result||b.showNotice(t,e),void 0===b.W.hide_call_timer||!b.W.hide_call_timer||"success"!==e.result&&"delayed"!==e.result||b.showNotice(t,e),"success"!=e.result&&"delayed"!=e.result&&"notice"!=e.result&&"empty_list"!==e.result||"delayed"===e.result&&e.exists||b.sendEvent("call"),"function"==typeof b.successCallCallback&&(e.params=o,b.successCallCallback(e)),void 0!==b.Chat.widget_key&&void 0!==e.data&&void 0!==e.data.callback_phone&&""!=e.data.callback_phone&&b.Chat.sendEvent("set_profile",{profile:{phone:e.data.callback_phone}}),b.log("Call Success")},error:function(){return b.log("Call Error!")},dataType:"jsonp",jsonpCallback:"jsonpCallCallback"})}t.find("#lb_phone").addClass("lb_error")},b.showNotice=function(e,t){e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),t.time&&""!==t.time?(e.find(".lb_delay-date").text(t.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(t.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1"))):(e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show()),e.find("#lb_close").on("click",function(){e.hide(),b.isMobile()&&b.mobileAdoptation()})},b.startTimer=function(t){b.log("startTimer"),b.interval=setInterval(function(){var e=b.timer-46;e<=0&&(e=0,clearInterval(b.interval)),b.timer=e,b.timerHtml(t)},46)},b.stopTimer=function(e){b.log("stopTimer"),clearInterval(b.interval)},b.timerHtml=function(e){var t=0,o=Math.floor(b.timer/1e3).toString(),t=Math.round((b.timer-1e3*o)/10).toString();o=o.length<2?"0"+o:o,t=t.length<2?"0"+t:2<t.length?"00":t,e.find("#lb_timer_result").text("0:"+o+","+t)},b.sendEvent=function(e,t){return b.log("sendEvent",e,t),b.$.ajax({type:"GET",async:!0,url:b.PUBLIC_SERVER+"backend/widget_event.php",data:{type:e,widget_key:b.W.widget_key,user_id:b.W.user_id,guid:b.getCookie(b.cg).guid,ga_cid:b.getGoogleCid(),ya_cid:b.ya_cid,ya_counter:b.ya_counter,roistat:b.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:b.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(){return b.log("Event Stat ["+e+"] Success")},error:function(){return b.log("Event Stat ["+e+"] Error!")},dataType:"jsonp",jsonpCallback:"jsonpEventCallback_"+e})},b.getComagicSessionId=function(){return window.Comagic&&"function"==typeof window.Comagic.getSessionId?(b.log("!!! Getting comagic",window.Comagic,window.Comagic.getSessionId()),window.Comagic.getSessionId()):""},b.analytics=function(e){return b.log("sendAnalytics",e),b.$.ajax({type:"GET",async:!0,url:b.PUBLIC_SERVER+"backend/widget_analytics.php",data:{data:e,cache:Math.random()},success:function(){},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpAnalyticsCallback"})},b.sendGoal=function(e,t){if(b.log("Call sendGoal"),!1!==b.Events._callEvent("onGoalEvent",{goal:e,params:t})){if(b.log("Send GOAL GA:"+e),"function"==typeof ga&&(ga("send","event",e,"clicked"),ga("ldbckTracker.send","event",e,"clicked")),"function"==typeof gtag&&gtag("event",e,{event_category:e,event_action:"clicked"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e}),0<b.ya.length)for(var o=b.ya.length-1;0<=o;o--)b.log("Send GOAL YA("+b.ya[o]+"):"+e),window[b.ya[o]].reachGoal(e);"LEADBACK_CALL"==e&&""!=b.W.facebook_pixel_event&&(b.log("track fb event "+b.W.facebook_pixel_event),""!=b.W.facebook_pixel_id?(t='<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id='+encodeURIComponent(b.W.facebook_pixel_id)+"&ev="+encodeURIComponent(b.W.facebook_pixel_event)+'&noscript=1"/>',b.log("nonscript pixel"),b.$("body").append(t)):"function"==typeof fbq?fbq("track",b.W.facebook_pixel_event):b.log("need pixel ID"))}},b.getPhonePrefix=function(){var e,t={ru:"+7",ua:"+380",by:"+375",kz:"+77",ge:"+995"},o="";for(e in void 0!==b.W&&(o=b.W.country),t)if(e==o)return t[o];return""},b.getTz=function(){return-(new Date).getTimezoneOffset()/60},b.load_jQuery=function(){var e;b.log("load_jQuery");var t={jquery:"none",widget:_emv.campaign};return void 0!==window.jQuery&&(b.log("Site use jquery "+window.jQuery.fn.jquery),t.jquery=window.jQuery.fn.jquery),void 0!==window.jQuery&&(e=window.jQuery.fn.jquery,0<=inArray.call(b.JQUERY_VERSIONS,e))?(b.log("jQuery "+jQuery.fn.jquery+" is present and meets our requirements."),b.$=window.jQuery,b.init(),b.analytics(t)):(b.log("jQuery is not present."),b.getScript(b.JQUERY_URL,function(){if("undefined"!=typeof jQuery)return b.$=jQuery.noConflict(!0),b.log("jQuery version "+b.$.fn.jquery+" successfully loaded."),b.init(),b.analytics(t)}))},b.getScript=function(e,t){var o,i,a;return b.log("getScript",e),(a=document.createElement("script")).src=e,i=document.getElementsByTagName("head")[0],o=!1,a.onload=a.onreadystatechange=function(){if(!(o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))return o=!0,t(),a.onload=a.onreadystatechange=null,i.removeChild(a)},i.appendChild(a)},b.loadScript=function(e,t,o){var i,a,n,l;return b.log("loadScript",e),a=!1,n=null,(i=b.$).isFunction(t)?(n=t,a=o||a):(a=t||a,n=o||n),l=!0,i('script[type="text/javascript"]').each(function(){return l=e!==i(this).attr("src")}),l?i.ajax({type:"GET",url:e,success:n,dataType:"script",cache:a}):i.isFunction(n)?n.call(this):void 0},b.generateUUID=function(){var o,e;return b.log("generateUUID"),o=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:7&t|8).toString(16)}),b.sendUUID(e),e},b.sendUUID=function(e){b.log("sendUUID",e,_emv.campaign),b.$.ajax({type:"GET",url:b.PUBLIC_SERVER+"backend/widget_uuid.php",dataType:"json",data:{widget_key:_emv.campaign,uuid:e,ga_cid:b.getGoogleCid(),ya_cid:b.ya_cid,ya_counter:b.ya_counter,roistat:b.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),comagic_session_id:b.getComagicSessionId(),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(e){b.log("UUID",e)},error:function(){b.log("UUID error")},dataType:"jsonp",jsonpCallback:"jsonpUuidCallback"})},b.isMobile=function(){return!b.is_vk&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))},b.isIpad=function(){return/ipad/i.test(navigator.userAgent||navigator.vendor||window.opera)},b.isIOS=function(){return/ip(hone|od|ad)/i.test(navigator.userAgent||navigator.vendor||window.opera)},b.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints||window.DocumentTouch&&document instanceof DocumentTouch},b.mobileButton=function(e,t){b.log("call mobileButton");var o=80/b.screen_width,i=window.innerWidth*o,a=window.innerWidth/2-.5*i+window.pageXOffset,o=window.innerHeight-1.25*i+window.pageYOffset;null!==e&&(e.css("width",i),e.css("height",i),e.css("left",a),e.css("top",o),e.find("object").css("width",i),e.find("img").css("width",i)),t.css("width",b.screen_width+"px"),t.css("height",b.screen_height+"px");i=b.screen_width/window.innerWidth;t.css("zoom",1/i),t.css("top",window.pageYOffset*i),t.css("left",window.pageXOffset*i)},b.default_viewport=null,b.default_viewport_is_mobile=!1,b.mobileAdoptation=function(){if(b.$("html").hasClass("lb-site-hide"))b.$("html").removeClass("lb-site-hide"),!1===b.default_viewport?b.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.33"):b.default_viewport&&b.$("meta[name=viewport]").attr("content",b.default_viewport),(e=b.$("html").data("ldbck_save_scroll"))&&b.$(document).scrollTop(e);else{var e=b.$(document).scrollTop();if(b.$("html").data("ldbck_save_scroll",e),b.$("html").addClass("lb-site-hide"),0==b.$("meta[name=viewport]").length)b.default_viewport=!1,b.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">');else if(null===b.default_viewport){b.default_viewport=b.$("meta[name=viewport]").attr("content");for(var t,o=b.default_viewport.split(","),i=!1,a=0;a<o.length;a++){o[a]=o[a].replace(/^\s+/,"");var n=o[a].split("=");"initial-scale"==n[0]&&(t=n[1]),"maximum-scale"==n[0]&&(i=n[1])}if(1==t&&1==i)return void(b.default_viewport_is_mobile=!0);b.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}else b.default_viewport_is_mobile||b.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}var l;"1"!=b.W.chat&&(l=b.$("#lb_mobile-call"),e=b.$(".lb_mobile-wrapper"),l&&e&&b.mobileButton(l,e))},b.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},b.randomVal=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},b.log=function(e){var t;b.debug_window&&((t=document.getElementById("ldbck_debug_window"))||((t=document.createElement("div")).id="ldbck_debug_window",t.style="position: absolute; top: 0; left: 0; width: 100%; background-color: rgba(0,0,0,.2); color: white; z-index:9999;",document.body.appendChild(t)),document.getElementById("ldbck_debug_window").innerHTML+="<div>"+e+": "+JSON.stringify(arguments)+"</div>"),!ldbck.DEBUG&&"#debug"!=window.location.hash||((t=Array.prototype.slice.call(arguments)).unshift((new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" "),console.log.apply(console,t))},b.initStorage=function(e){return function(d){var e="ls_",t="ss_";function c(e){var t=arguments.length,o=window[e],i=arguments,a=i[1],n,l,r;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(a)){l={};for(var s in a){n=a[s];try{l[n]=JSON.parse(o.getItem(n))}catch(e){l[n]=o.getItem(n)}}return l}else if(t==2)try{return JSON.parse(o.getItem(a))}catch(e){return o.getItem(a)}else{try{l=JSON.parse(o.getItem(a))}catch(e){throw new ReferenceError(a+" is not defined in this storage")}for(var s=2;s<t-1;s++){l=l[i[s]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,s+1).join(".")+" is not defined in this storage")}if(d.isArray(i[s])){r=l;l={};for(var c in i[s])l[i[s][c]]=r[i[s][c]];return l}else return l[i[s]]}}function n(e){var t=arguments.length,o=window[e],i=arguments,a=i[1],n=i[2],l,r={},s;if(t<2||!d.isPlainObject(a)&&t<3)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");else if(d.isPlainObject(a)){for(var c in a){l=a[c];if(!d.isPlainObject(l))o.setItem(c,l);else o.setItem(c,JSON.stringify(l))}return a}else if(t==3){if(typeof n==="object")o.setItem(a,JSON.stringify(n));else o.setItem(a,n);return n}else{try{s=o.getItem(a);if(s!=null)r=JSON.parse(s)}catch(e){}s=r;for(var c=2;c<t-2;c++){l=i[c];if(!s[l]||!d.isPlainObject(s[l]))s[l]={};s=s[l]}s[i[c]]=i[c+1];o.setItem(a,JSON.stringify(r));return r}}function a(e){var t=arguments.length,o=window[e],i=arguments,a=i[1],n,l;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(a)){for(var r in a)o.removeItem(a[r]);return true}else if(t==2){o.removeItem(a);return true}else{try{n=l=JSON.parse(o.getItem(a))}catch(e){throw new ReferenceError(a+" is not defined in this storage")}for(var r=2;r<t-1;r++){l=l[i[r]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,r).join(".")+" is not defined in this storage")}if(d.isArray(i[r]))for(var s in i[r])delete l[i[r][s]];else delete l[i[r]];o.setItem(a,JSON.stringify(n));return true}}function o(e,t){var o=u(e);for(var i in o)a(e,o[i]);if(t)for(var i in d.namespaceStorages)l(i)}function r(e){var t=arguments.length,o=arguments,i=window[e],a=o[1];if(t==1)return u(e).length==0;else if(d.isArray(a)){for(var n=0;n<a.length;n++)if(!r(e,a[n]))return false;return true}else try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var n in l)if(!(d.isPlainObject(l[n])&&d.isEmptyObject(l[n])||d.isArray(l[n])&&!l[n].length||!l[n]))return false;return true}catch(e){return true}}function s(e){var t=arguments.length,o=arguments,i=window[e],a=o[1];if(t<2)throw new Error("Minimum 2 arguments must be given");if(d.isArray(a)){for(var n=0;n<a.length;n++)if(!s(e,a[n]))return false;return true}else try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var n in l)if(!(l[n]!==undefined&&l[n]!==null))return false;return true}catch(e){return false}}function u(e){var t=arguments.length,o=window[e],i=arguments,a=i[1],n=[],l={};if(t>1)l=c.apply(this,i);else l=o;if(l&&l._cookie){for(var r in d.cookie())if(r!="")n.push(r.replace(l._prefix,""))}else for(var s in l)n.push(s);return n}function l(e){if(!e||typeof e!="string")throw new Error("First parameter must be a string");if(g){if(!window.localStorage.getItem(e))window.localStorage.setItem(e,"{}");if(!window.sessionStorage.getItem(e))window.sessionStorage.setItem(e,"{}")}else{if(!window.localCookieStorage.getItem(e))window.localCookieStorage.setItem(e,"{}");if(!window.sessionCookieStorage.getItem(e))window.sessionCookieStorage.setItem(e,"{}")}var t={localStorage:d.extend({},d.localStorage,{_ns:e}),sessionStorage:d.extend({},d.sessionStorage,{_ns:e})};d.namespaceStorages[e]=t;return t}function i(e){var t="jsapi";try{if(!window[e])return false;window[e].setItem(t,t);window[e].removeItem(t);return true}catch(e){return false}}var g=i("localStorage"),h={_type:"",_ns:"",_callMethod:function(e,t){var o=[this._type],t=Array.prototype.slice.call(t),i=t[0];if(this._ns)o.push(this._ns);if(typeof i==="string"&&i.indexOf(".")!==-1){t.shift();[].unshift.apply(t,i.split("."))}[].push.apply(o,t);return e.apply(this,o)},get:function(){return this._callMethod(c,arguments)},set:function(){var e=arguments.length,t=arguments,o=t[0];if(e<1||!d.isPlainObject(o)&&e<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(d.isPlainObject(o)&&this._ns){for(var i in o)n(this._type,this._ns,i,o[i]);return o}else{var a=this._callMethod(n,t);if(this._ns)return a[o.split(".")[0]];else return a}},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(a,arguments)},removeAll:function(e){if(this._ns){n(this._type,this._ns,{});return true}else return o(this._type,e)},isEmpty:function(){return this._callMethod(r,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},keys:function(){return this._callMethod(u,arguments)}};if(d.initNamespaceStorage=function(e){return l(e)},g){d.localStorage=d.extend({},h,{_type:"localStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionStorage"})}else{d.localStorage=d.extend({},h,{_type:"localCookieStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionCookieStorage"})}d.namespaceStorages={},d.removeAllStorages=function(e){d.localStorage.removeAll(e);d.sessionStorage.removeAll(e);if(d.cookieStorage)d.cookieStorage.removeAll(e);if(!e)d.namespaceStorages={}}}(b.$),b.$.initNamespaceStorage("__"+e)},b.coBrowseV2=function(i){b.log("coBrowseV2"),Cloudim.Api.getCurrentOperator(function(o){!1!==o&&void 0===o.length&&Cloudim.Api.getVisitor(function(e){var t=b.$("html").clone();t.find("script").attr("src","").html(""),t.find(".app-cobrowsing").remove(),t.find("#lb_widget-root").html(""),t.find("audio").html(""),t.find("iframe#cloudim_chat").html("");t={widget_key:b.W.widget_key,user_id:b.W.user_id,guid:b.getCookie(b.cg).guid,loc:document.location.href,operator:o.jid,visitor:e.jid,html:t.html()};b.$.post(b.PUBLIC_SERVER+"backend/widget_cobrowse.php",t,function(e){"function"==typeof i&&i(e)},"json")})})},b.Cookies=function e(h){function _(e,t,o){var i,a;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(o=m({path:"/"},_.defaults,o)).expires&&((a=new Date).setMilliseconds(a.getMilliseconds()+864e5*o.expires),o.expires=a),o.expires=o.expires?o.expires.toUTCString():"";try{i=JSON.stringify(t),/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=h.write?h.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var n,l="";for(n in o)o[n]&&(l+="; "+n,!0!==o[n]&&(l+="="+o[n]));return document.cookie=e+"="+t+l}e||(i={});for(var r=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,c=0;c<r.length;c++){var d=r[c].split("="),u=d.slice(1).join("=");this.json||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var g=d[0].replace(s,decodeURIComponent),u=h.read?h.read(u,g):h(u,g)||u.replace(s,decodeURIComponent);if(this.json)try{u=JSON.parse(u)}catch(e){}if(e===g){i=u;break}e||(i[g]=u)}catch(e){}}return i}}return(_.set=_).get=function(e){return _.call(_,e)},_.getJSON=function(){return _.apply({json:!0},[].slice.call(arguments))},_.defaults={},_.remove=function(e,t){_(e,"",m(t,{expires:-1}))},_.withConverter=e,_}(function(){}),b.Events={onChatReady:[],onGoalEvent:[],_callEvent:function(e,t){var o=!0;if(void 0!==b.Events[e]&&0<b.Events[e].length)for(var i in b.Events[e])!1===b.Events[e][i](t)&&(o=!1);return o}},b.Api={callTo:function(e,t){t=t&&"object"!=typeof t?{delayed:t}:t;b.$("#lb_phone").val(e),b.callTo(b.$("#lb_widget-root"),t)},callFromForm:function(e,t){b.$("#lb_phone").val(e);e={initiator:"magic_forms"};t&&"string"==typeof t&&""!==b.$.trim(t)&&(e.label=t),b.callTo(b.$("#lb_widget-root"),e)},bind:function(e,t){b.Events[e]&&(b.Events[e][b.Events[e].length]=t)}},0<b.onApiReady.length)for(a=0,n=b.onApiReady.length;a<n;a++)"function"==typeof b.onApiReady[a]&&b.onApiReady[a](b.Api);"object"==typeof window.Muse&&"function"==typeof window.muse_init?(b.log("Is Muse site"),b.muse_detect_interval=null,b.muse_interval=150,b.muse_stop_check=5e3,b.muse_step=0,b.muse_detect_interval=setInterval(function(){b.muse_step++,(!0===document.body.classList.contains("initialized")||b.muse_step>=b.muse_stop_check/b.muse_interval)&&(b.log("Muse Is initialized"),clearInterval(b.muse_detect_interval),b.muse_detect_interval=null,b.load_jQuery())},b.muse_interval)):b.load_jQuery()}.call(this);