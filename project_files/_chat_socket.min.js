function flash_ready(){$.jStore.delegate.trigger("flash-ready")}!function(a,b){function cy(a){return f.isWindow(a)?a:9===a.nodeType&&(a.defaultView||a.parentWindow)}function cv(a){if(!cj[a]){var b=f("<"+a+">").appendTo("body"),d=b.css("display");b.remove(),"none"!==d&&""!==d||(ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),c.body.appendChild(ck),cl&&ck.createElement||(cl=(ck.contentWindow||ck.contentDocument).document,cl.write("<!doctype><html><body></body></html>")),b=cl.createElement(a),cl.body.appendChild(b),d=f.css(b,"display"),c.body.removeChild(ck)),cj[a]=d}return cj[a]}function cu(a,b){var c={};return f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a}),c}function ct(){cq=b}function cs(){return setTimeout(ct,0),cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var g,h,j,l,m,n,o,p,d=a.dataTypes,e={},i=d.length,k=d[0];for(g=1;g<i;g++){if(1===g)for(h in a.converters)"string"==typeof h&&(e[h.toLowerCase()]=a.converters[h]);if(l=k,"*"===(k=d[g]))k=l;else if("*"!==l&&l!==k){if(m=l+" "+k,!(n=e[m]||e["* "+k])){p=b;for(o in e)if(j=o.split(" "),(j[0]===l||"*"===j[0])&&(p=e[j[1]+" "+k])){o=e[o],!0===o?n=p:!0===p&&(n=o);break}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),!0!==n&&(c=n?n(c):p(o(c)))}}return c}function ca(a,c,d){var h,i,j,k,e=a.contents,f=a.dataTypes,g=a.responseFields;for(i in g)i in d&&(c[g[i]]=d[i]);for(;"*"===f[0];)f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j)return j!==f[0]&&f.unshift(j),d[j]}function b_(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bF.test(a)?d(a,e):b_(a+"["+("object"==typeof e||f.isArray(e)?b:"")+"]",e,c,d)});else if(c||null==b||"object"!=typeof b)d(a,b);else for(var e in b)b_(a+"["+e+"]",b[e],c,d)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;for(var l,h=a[f],i=0,j=h?h.length:0,k=a===bU;i<j&&(k||!l);i++)"string"==typeof(l=h[i](c,d,e))&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));return(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g)),l}function bZ(a){return function(b,c){if("string"!=typeof b&&(c=b,b="*"),f.isFunction(c))for(var h,i,j,d=b.toLowerCase().split(bQ),e=0,g=d.length;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}function bD(a,b,c){var d="width"===b?bx:by,e="width"===b?a.offsetWidth:a.offsetHeight;return"border"===c?e:(f.each(d,function(){c||(e-=parseFloat(f.css(a,"padding"+this))||0),"margin"===c?e+=parseFloat(f.css(a,"margin"+this))||0:e-=parseFloat(f.css(a,"border"+this+"Width"))||0}),e)}function bn(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bm(a){f.nodeName(a,"input")?bl(a):a.getElementsByTagName&&f.grep(a.getElementsByTagName("input"),bl)}function bl(a){"checkbox"!==a.type&&"radio"!==a.type||(a.defaultChecked=a.checked)}function bk(a){return"getElementsByTagName"in a?a.getElementsByTagName("*"):"querySelectorAll"in a?a.querySelectorAll("*"):[]}function bj(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?b.outerHTML=a.outerHTML:"input"!==c||"checkbox"!==a.type&&"radio"!==a.type?"option"===c?b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando))}function bi(a,b){if(1===b.nodeType&&f.hasData(a)){var c=f.expando,d=f.data(a),e=f.data(b,d);if(d=d[c]){var g=d.events;if(e=e[c]=f.extend({},d),g){delete e.handle,e.events={};for(var h in g)for(var i=0,j=g[h].length;i<j;i++)f.event.add(b,h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}function bh(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function X(a,b,c){if(b=b||0,f.isFunction(b))return f.grep(a,function(a,d){return!!b.call(a,d,a)===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if("string"==typeof b){var d=f.grep(a,function(a){return 1===a.nodeType});if(S.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function W(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function O(a,b){return(a&&"*"!==a?a+".":"")+b.replace(A,"`").replace(B,"&")}function N(a){var b,c,d,e,g,h,i,j,k,m,n,o,p=[],q=[],r=f._data(this,"events");if(a.liveFired!==this&&r&&r.live&&!a.target.disabled&&(!a.button||"click"!==a.type)){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var s=r.live.slice(0);for(i=0;i<s.length;i++)g=s[i],g.origType.replace(y,"")===a.type?q.push(g.selector):s.splice(i--,1);for(e=f(a.target).closest(q,a.currentTarget),j=0,k=e.length;j<k;j++)for(m=e[j],i=0;i<s.length;i++)g=s[i],m.selector!==g.selector||n&&!n.test(g.namespace)||m.elem.disabled||(h=m.elem,d=null,"mouseenter"!==g.preType&&"mouseleave"!==g.preType||(a.type=g.preType,(d=f(a.relatedTarget).closest(g.selector)[0])&&f.contains(h,d)&&(d=h)),(!d||d!==h)&&p.push({elem:h,handleObj:g,level:m.level}));for(j=0,k=p.length;j<k&&(e=p[j],!(c&&e.level>c))&&(a.currentTarget=e.elem,a.data=e.handleObj.data,a.handleObj=e.handleObj,o=e.handleObj.origHandler.apply(e.elem,arguments),!1!==o&&!a.isPropagationStopped()||(c=e.level,!1===o&&(b=!1),!a.isImmediatePropagationStopped()));j++);return b}}function L(a,c,d){var e=f.extend({},d[0]);e.type=a,e.originalEvent={},e.liveFired=b,f.event.handle.call(c,e),e.isDefaultPrevented()&&d[0].preventDefault()}function F(){return!0}function E(){return!1}function m(a,c,d){var e=c+"defer",g=c+"queue",h=c+"mark",i=f.data(a,e,b,!0);i&&("queue"===d||!f.data(a,g,b,!0))&&("mark"===d||!f.data(a,h,b,!0))&&setTimeout(function(){!f.data(a,g,b,!0)&&!f.data(a,h,b,!0)&&(f.removeData(a,e,!0),i.resolve())},0)}function l(a){for(var b in a)if("toJSON"!==b)return!1;return!0}function k(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(j,"$1-$2").toLowerCase();if("string"==typeof(d=a.getAttribute(e))){try{d="true"===d||"false"!==d&&("null"===d?null:f.isNaN(d)?i.test(d)?f.parseJSON(d):d:parseFloat(d))}catch(g){}f.data(a,c,d)}else d=b}return d}var c=a.document,d=a.navigator,e=a.location,f=function(){function H(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){return void setTimeout(H,1)}e.ready()}}var h,x,y,z,e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,i=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/\d/,n=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,o=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/(webkit)[ \/]([\w.]+)/,t=/(opera)(?:.*version)?[ \/]([\w.]+)/,u=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,w=d.userAgent,A=Object.prototype.toString,B=Object.prototype.hasOwnProperty,C=Array.prototype.push,D=Array.prototype.slice,E=String.prototype.trim,F=Array.prototype.indexOf,G={};return e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if("body"===a&&!d&&c.body)return this.context=c,this[0]=c.body,this.selector=a,this.length=1,this;if("string"==typeof a){if((g="<"!==a.charAt(0)||">"!==a.charAt(a.length-1)||a.length<3?i.exec(a):[null,a,null])&&(g[1]||!d)){if(g[1])return d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=n.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes),e.merge(this,a);if((h=c.getElementById(g[2]))&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}return this.context=c,this.selector=a,this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}return e.isFunction(a)?f.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),e.makeArray(a,this))},selector:"",jquery:"1.6.1",length:0,size:function(){return this.length},toArray:function(){return D.call(this,0)},get:function(a){return null==a?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();return e.isArray(a)?C.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,"find"===b?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return e.each(this,a,b)},ready:function(a){return e.bindReady(),y.done(a),this},eq:function(a){return-1===a?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(D.apply(this,arguments),"slice",D.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:C,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);j<k;j++)if(null!=(a=arguments[j]))for(c in a)d=i[c],f=a[c],i!==f&&(l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f));return i},e.extend({noConflict:function(b){return a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f),e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(!0===a&&!--e.readyWait||!0!==a&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);if(e.isReady=!0,!0!==a&&--e.readyWait>0)return;y.resolveWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!y){if(y=e._Deferred(),"complete"===c.readyState)return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",z,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",z),a.attachEvent("onload",e.ready);var b=!1;try{b=null==a.frameElement}catch(d){}c.documentElement.doScroll&&b&&H()}}},isFunction:function(a){return"function"===e.type(a)},isArray:Array.isArray||function(a){return"array"===e.type(a)},isWindow:function(a){return a&&"object"==typeof a&&"setInterval"in a},isNaN:function(a){return null==a||!m.test(a)||isNaN(a)},type:function(a){return null==a?String(a):G[A.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==e.type(a)||a.nodeType||e.isWindow(a))return!1;if(a.constructor&&!B.call(a,"constructor")&&!B.call(a.constructor.prototype,"isPrototypeOf"))return!1;var c;for(c in a);return c===b||B.call(a,c)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a},parseJSON:function(b){return"string"==typeof b&&b?(b=e.trim(b),a.JSON&&a.JSON.parse?a.JSON.parse(b):o.test(b.replace(p,"@").replace(q,"]").replace(r,""))?new Function("return "+b)():void e.error("Invalid JSON: "+b)):null},parseXML:function(b,c,d){return a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b)),(!(d=c.documentElement)||!d.nodeName||"parsererror"===d.nodeName)&&e.error("Invalid XML: "+b),c},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d)if(i){for(f in a)if(!1===c.apply(a[f],d))break}else for(;g<h&&!1!==c.apply(a[g++],d););else if(i){for(f in a)if(!1===c.call(a[f],f,a[f]))break}else for(;g<h&&!1!==c.call(a[g],g,a[g++]););return a},trim:E?function(a){return null==a?"":E.call(a)}:function(a){return null==a?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(null!=a){var d=e.type(a);null==a.length||"string"===d||"function"===d||"regexp"===d||e.isWindow(a)?C.call(c,a):e.merge(c,a)}return c},inArray:function(a,b){if(F)return F.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1},merge:function(a,c){var d=a.length,e=0;if("number"==typeof c.length)for(var f=c.length;e<f;e++)a[d++]=c[e];else for(;c[e]!==b;)a[d++]=c[e++];return a.length=d,a},grep:function(a,b,c){var e,d=[];c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length;if(a instanceof e||j!==b&&"number"==typeof j&&(j>0&&a[0]&&a[j-1]||0===j||e.isArray(a)))for(;i<j;i++)null!=(f=c(a[i],i,d))&&(h[h.length]=f);else for(g in a)null!=(f=c(a[g],g,d))&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if("string"==typeof c){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=D.call(arguments,2),g=function(){return a.apply(c,f.concat(D.call(arguments)))};return g.guid=a.guid=a.guid||g.guid||e.guid++,g},access:function(a,c,d,f,g,h){var i=a.length;if("object"==typeof c){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=s.exec(a)||t.exec(a)||u.exec(a)||a.indexOf("compatible")<0&&v.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){return f&&f instanceof e&&!(f instanceof a)&&(f=a(f)),e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){G["[object "+b+"]"]=b.toLowerCase()}),x=e.uaMatch(w),x.browser&&(e.browser[x.browser]=!0,e.browser.version=x.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?z=function(){c.removeEventListener("DOMContentLoaded",z,!1),e.ready()}:c.attachEvent&&(z=function(){"complete"===c.readyState&&(c.detachEvent("onreadystatechange",z),e.ready())}),e}(),g="done fail isResolved isRejected promise then always pipe".split(" "),h=[].slice;f.extend({_Deferred:function(){var b,c,d,a=[],e={done:function(){if(!d){var g,h,i,j,k,c=arguments;for(b&&(k=b,b=0),g=0,h=c.length;g<h;g++)i=c[g],j=f.type(i),"array"===j?e.done.apply(e,i):"function"===j&&a.push(i);k&&e.resolveWith(k[0],k[1])}return this},resolveWith:function(e,f){if(!d&&!b&&!c){f=f||[],c=1;try{for(;a[0];)a.shift().apply(e,f)}finally{b=[e,f],c=0}}return this},resolve:function(){return e.resolveWith(this,arguments),this},isResolved:function(){return!!c||!!b},cancel:function(){return d=1,a=[],this}};return e},Deferred:function(a){var d,b=f._Deferred(),c=f._Deferred();return f.extend(b,{then:function(a,c){return b.done(a).fail(c),this},always:function(){return b.done.apply(b,arguments).fail.apply(this,arguments)},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,isRejected:c.isResolved,pipe:function(a,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[c,"reject"]},function(a,c){var h,e=c[0],g=c[1];f.isFunction(e)?b[a](function(){h=e.apply(this,arguments),h&&f.isFunction(h.promise)?h.promise().then(d.resolve,d.reject):d[g](h)}):b[a](d[g])})}).promise()},promise:function(a){if(null==a){if(d)return d;d=a={}}for(var c=g.length;c--;)a[g[c]]=b[g[c]];return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b),b},when:function(a){function i(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--e||g.resolveWith(g,h.call(b,0))}}var b=arguments,c=0,d=b.length,e=d,g=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred();if(d>1){for(;c<d;c++)b[c]&&f.isFunction(b[c].promise)?b[c].promise().then(i(c),g.reject):--e;e||g.resolveWith(g,b)}else g!==a&&g.resolveWith(g,d?[a]:[]);return g.promise()}}),f.support=function(){var d,e,f,g,h,i,j,k,l,m,n,p,q,r,a=c.createElement("div"),b=c.documentElement;if(a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=a.getElementsByTagName("*"),e=a.getElementsByTagName("a")[0],!d||!d.length||!e)return{};f=c.createElement("select"),g=f.appendChild(c.createElement("option")),h=a.getElementsByTagName("input")[0],j={leadingWhitespace:3===a.firstChild.nodeType,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:"/a"===e.getAttribute("href"),opacity:/^0.55$/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:"on"===h.value,optSelected:g.selected,getSetAttribute:"t"!==a.className,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},h.checked=!0,j.noCloneChecked=h.cloneNode(!0).checked,f.disabled=!0,j.optDisabled=!g.disabled;try{delete a.test}catch(s){j.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function b(){j.noCloneEvent=!1,a.detachEvent("onclick",b)}),a.cloneNode(!0).fireEvent("onclick")),h=c.createElement("input"),h.value="t",h.setAttribute("type","radio"),j.radioValue="t"===h.value,h.setAttribute("checked","checked"),a.appendChild(h),k=c.createDocumentFragment(),k.appendChild(a.firstChild),j.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",l=c.createElement("body"),m={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};for(q in m)l.style[q]=m[q];if(l.appendChild(a),b.insertBefore(l,b.firstChild),j.appendChecked=h.checked,j.boxModel=2===a.offsetWidth,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,j.inlineBlockNeedsLayout=2===a.offsetWidth,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",j.shrinkWrapBlocks=2!==a.offsetWidth),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",n=a.getElementsByTagName("td"),r=0===n[0].offsetHeight,n[0].style.display="",n[1].style.display="none",j.reliableHiddenOffsets=r&&0===n[0].offsetHeight,a.innerHTML="",c.defaultView&&c.defaultView.getComputedStyle&&(i=c.createElement("div"),i.style.width="0",i.style.marginRight="0",a.appendChild(i),j.reliableMarginRight=0===(parseInt((c.defaultView.getComputedStyle(i,null)||{marginRight:0}).marginRight,10)||0)),l.innerHTML="",b.removeChild(l),a.attachEvent)for(q in{submit:1,change:1,focusin:1})p="on"+q,r=p in a,r||(a.setAttribute(p,"return;"),r="function"==typeof a[p]),j[q+"Bubbles"]=r;return j}(),f.boxModel=f.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([a-z])([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return!!(a=a.nodeType?f.cache[a[f.expando]]:a[f.expando])&&!l(a)},data:function(a,c,d,e){if(f.acceptData(a)){var i,g=f.expando,h="string"==typeof c,j=a.nodeType,k=j?f.cache:a,l=j?a[f.expando]:a[f.expando]&&f.expando;if((!l||e&&l&&!k[l][g])&&h&&d===b)return;return l||(j?a[f.expando]=l=++f.uuid:l=f.expando),k[l]||(k[l]={},j||(k[l].toJSON=f.noop)),"object"!=typeof c&&"function"!=typeof c||(e?k[l][g]=f.extend(k[l][g],c):k[l]=f.extend(k[l],c)),i=k[l],e&&(i[g]||(i[g]={}),i=i[g]),d!==b&&(i[f.camelCase(c)]=d),"events"!==c||i[c]?h?i[f.camelCase(c)]:i:i[g]&&i[g].events}},removeData:function(b,c,d){if(f.acceptData(b)){var e=f.expando,g=b.nodeType,h=g?f.cache:b,i=g?b[f.expando]:f.expando;if(!h[i])return;if(c){var j=d?h[i][e]:h[i];if(j&&(delete j[c],!l(j)))return}if(d&&(delete h[i][e],!l(h[i])))return;var k=h[i][e];f.support.deleteExpando||h!=a?delete h[i]:h[i]=null,k?(h[i]={},g||(h[i].toJSON=f.noop),h[i][e]=k):g&&(f.support.deleteExpando?delete b[f.expando]:b.removeAttribute?b.removeAttribute(f.expando):b[f.expando]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return!0!==b&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d=null;if(void 0===a){if(this.length&&(d=f.data(this[0]),1===this[0].nodeType))for(var g,e=this[0].attributes,h=0,i=e.length;h<i;h++)g=e[h].name,0===g.indexOf("data-")&&(g=f.camelCase(g.substring(5)),k(this[0],g,d[g]));return d}if("object"==typeof a)return this.each(function(){f.data(this,a)});var j=a.split(".");return j[1]=j[1]?"."+j[1]:"",c===b?((d=this.triggerHandler("getData"+j[1]+"!",[j[0]]))===b&&this.length&&(d=f.data(this[0],a),d=k(this[0],a,d)),d===b&&j[1]?this.data(j[0]):d):this.each(function(){var b=f(this),d=[j[0],c];b.triggerHandler("setData"+j[1]+"!",d),f.data(this,a,c),b.triggerHandler("changeData"+j[1]+"!",d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,c){a&&(c=(c||"fx")+"mark",f.data(a,c,(f.data(a,c,b,!0)||0)+1,!0))},_unmark:function(a,c,d){if(!0!==a&&(d=c,c=a,a=!1),c){d=d||"fx";var e=d+"mark",g=a?0:(f.data(c,e,b,!0)||1)-1;g?f.data(c,e,g,!0):(f.removeData(c,e,!0),m(c,d,"mark"))}},queue:function(a,c,d){if(a){c=(c||"fx")+"queue";var e=f.data(a,c,b,!0);return d&&(!e||f.isArray(d)?e=f.data(a,c,f.makeArray(d),!0):e.push(d)),e||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift();"inprogress"===d&&(d=c.shift()),d&&("fx"===b&&c.unshift("inprogress"),d.call(a,function(){f.dequeue(a,b)})),c.length||(f.removeData(a,b+"queue",!0),m(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){return"string"!=typeof a&&(c=a,a="fx"),c===b?f.queue(this[0],a):this.each(function(){var b=f.queue(this,a,c);"fx"===a&&"inprogress"!==b[0]&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){return a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(){var c=this;setTimeout(function(){f.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}"string"!=typeof a&&(a,a=b),a=a||"fx";for(var l,d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark";g--;)(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f._Deferred(),!0))&&(h++,l.done(m));return m(),d.promise()}});var v,w,n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u=/\:/;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){return a=f.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.addClass(a.call(this,b,c.attr("class")||""))});if(a&&"string"==typeof a)for(var b=(a||"").split(o),c=0,d=this.length;c<d;c++){var e=this[c];if(1===e.nodeType)if(e.className){for(var g=" "+e.className+" ",h=e.className,i=0,j=b.length;i<j;i++)g.indexOf(" "+b[i]+" ")<0&&(h+=" "+b[i]);e.className=f.trim(h)}else e.className=a}return this},removeClass:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.removeClass(a.call(this,b,c.attr("class")))});if(a&&"string"==typeof a||a===b)for(var c=(a||"").split(o),d=0,e=this.length;d<e;d++){var g=this[d];if(1===g.nodeType&&g.className)if(a){for(var h=(" "+g.className+" ").replace(n," "),i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return f.isFunction(a)?this.each(function(c){var d=f(this);d.toggleClass(a.call(this,c,d.attr("class"),b),b)}):this.each(function(){if("string"===c)for(var e,g=0,h=f(this),i=b,j=a.split(o);e=j[g++];)i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e);else"undefined"!==c&&"boolean"!==c||(this.className&&f._data(this,"__className__",this.className),this.className=this.className||!1===a?"":f._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;c<d;c++)if((" "+this[c].className+" ").replace(n," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e=this[0];if(!arguments.length)return e?(c=f.valHooks[e.nodeName.toLowerCase()]||f.valHooks[e.type],c&&"get"in c&&(d=c.get(e,"value"))!==b?d:(e.value||"").replace(p,"")):b;var g=f.isFunction(a);return this.each(function(d){var h,e=f(this);1===this.nodeType&&(h=g?a.call(this,d,e.val()):a,null==h?h="":"number"==typeof h?h+="":f.isArray(h)&&(h=f.map(h,function(a){return null==a?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type],c&&"set"in c&&c.set(this,h,"value")!==b||(this.value=h))})}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c=a.selectedIndex,d=[],e=a.options,g="select-one"===a.type;if(c<0)return null;for(var h=g?c:0,i=g?c+1:e.length;h<i;h++){var j=e[h];if(j.selected&&(f.support.optDisabled?!j.disabled:null===j.getAttribute("disabled"))&&(!j.parentNode.disabled||!f.nodeName(j.parentNode,"optgroup"))){if(b=f(j).val(),g)return b;d.push(b)}}return g&&!d.length&&e.length?f(e[c]).val():d},set:function(a,b){var c=f.makeArray(b);return f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(a,c,d,e){var g=a.nodeType;if(!a||3===g||8===g||2===g)return b;if(e&&c in f.attrFn)return f(a)[c](d);if(!("getAttribute"in a))return f.prop(a,c,d);var h,i,j=1!==g||!f.isXMLDoc(a);return c=j&&f.attrFix[c]||c,(i=f.attrHooks[c])||(!t.test(c)||"boolean"!=typeof d&&d!==b&&d.toLowerCase()!==c.toLowerCase()?v&&(f.nodeName(a,"form")||u.test(c))&&(i=v):i=w),d!==b?null===d?(f.removeAttr(a,c),b):i&&"set"in i&&j&&(h=i.set(a,d,c))!==b?h:(a.setAttribute(c,""+d),d):i&&"get"in i&&j?i.get(a,c):(h=a.getAttribute(c),null===h?b:h)},removeAttr:function(a,b){var c;1===a.nodeType&&(b=f.attrFix[b]||b,f.support.getSetAttribute?a.removeAttribute(b):(f.attr(a,b,""),a.removeAttributeNode(a.getAttributeNode(b))),t.test(b)&&(c=f.propFix[b]||b)in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&"radio"===b&&f.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},tabIndex:{get:function(a){var c=a.getAttributeNode("tabIndex");return c&&c.specified?parseInt(c.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e=a.nodeType;if(!a||3===e||8===e||2===e)return b;var g,h;return c=(1!==e||!f.isXMLDoc(a))&&f.propFix[c]||c,h=f.propHooks[c],d!==b?h&&"set"in h&&(g=h.set(a,d,c))!==b?g:a[c]=d:h&&"get"in h&&(g=h.get(a,c))!==b?g:a[c]},propHooks:{}}),w={get:function(a,c){return a[f.propFix[c]||c]?c.toLowerCase():b},set:function(a,b,c){var d;return!1===b?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=b),a.setAttribute(c,c.toLowerCase())),c}},f.attrHooks.value={get:function(a,b){return v&&f.nodeName(a,"button")?v.get(a,b):a.value},set:function(a,b,c){if(v&&f.nodeName(a,"button"))return v.set(a,b,c);a.value=b}},f.support.getSetAttribute||(f.attrFix=f.propFix,v=f.attrHooks.name=f.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&""!==d.nodeValue?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);if(d)return d.nodeValue=b,b}},f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})})),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return null===d?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}})),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var y=(Object.prototype.hasOwnProperty,/\.(.*)$/),z=/^(?:textarea|input|select)$/i,A=/\./g,B=/ /g,C=/[^\w\s.|`]/g,D=function(a){return a.replace(C,"\\$&")};f.event={add:function(a,c,d,e){if(3!==a.nodeType&&8!==a.nodeType){if(!1===d)d=E;else if(!d)return;var g,h;d.handler&&(g=d,d=g.handler),d.guid||(d.guid=f.guid++);var i=f._data(a);if(!i)return;var j=i.events,k=i.handle;j||(i.events=j={}),k||(i.handle=k=function(a){return void 0===f||a&&f.event.triggered===a.type?b:f.event.handle.apply(k.elem,arguments)}),k.elem=a,c=c.split(" ");for(var l,n,m=0;l=c[m++];){h=g?f.extend({},g):{handler:d,data:e},l.indexOf(".")>-1?(n=l.split("."),l=n.shift(),h.namespace=n.slice(0).sort().join(".")):(n=[],h.namespace=""),h.type=l,h.guid||(h.guid=d.guid);var o=j[l],p=f.event.special[l]||{};o||(o=j[l]=[],p.setup&&!1!==p.setup.call(a,e,n,k)||(a.addEventListener?a.addEventListener(l,k,!1):a.attachEvent&&a.attachEvent("on"+l,k))),p.add&&(p.add.call(a,h),h.handler.guid||(h.handler.guid=d.guid)),o.push(h),f.event.global[l]=!0}a=null}},global:{},remove:function(a,c,d,e){if(3!==a.nodeType&&8!==a.nodeType){!1===d&&(d=E);var h,j,l,m,n,o,p,q,r,k=0,s=f.hasData(a)&&f._data(a),t=s&&s.events;if(!s||!t)return;if(c&&c.type&&(d=c.handler,c=c.type),!c||"string"==typeof c&&"."===c.charAt(0)){c=c||"";for(h in t)f.event.remove(a,h+c);return}for(c=c.split(" ");h=c[k++];)if(r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+f.map(m.slice(0).sort(),D).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h],p)if(d){for(o=f.event.special[h]||{},j=e||0;j<p.length&&(q=p[j],d.guid!==q.guid||((l||n.test(q.namespace))&&(null==e&&p.splice(j--,1),o.remove&&o.remove.call(a,q)),null==e));j++);(0===p.length||null!=e&&1===p.length)&&((!o.teardown||!1===o.teardown.call(a,m))&&f.removeEvent(a,h,s.handle),null,delete t[h])}else for(j=0;j<p.length;j++)q=p[j],(l||n.test(q.namespace))&&(f.event.remove(a,r,q.handler,j),p.splice(j--,1));if(f.isEmptyObject(t)){var u=s.handle;u&&(u.elem=null),delete s.events,delete s.handle,f.isEmptyObject(s)&&f.removeData(a,b,!0)}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){var j,h=c.type||c,i=[];if(h.indexOf("!")>=0&&(h=h.slice(0,-1),j=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort()),e&&!f.event.customEvent[h]||f.event.global[h]){if(c="object"==typeof c?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.exclusive=j,c.namespace=i.join("."),c.namespace_re=new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"),!g&&e||(c.preventDefault(),c.stopPropagation()),!e)return void f.each(f.cache,function(){var a=f.expando,b=this[a];b&&b.events&&b.events[h]&&f.event.trigger(c,d,b.handle.elem)});if(3===e.nodeType||8===e.nodeType)return;c.result=b,c.target=e,d=d?f.makeArray(d):[],d.unshift(c);var k=e,l=h.indexOf(":")<0?"on"+h:"";do{var m=f._data(k,"handle");c.currentTarget=k,m&&m.apply(k,d),l&&f.acceptData(k)&&k[l]&&!1===k[l].apply(k,d)&&(c.result=!1,c.preventDefault()),k=k.parentNode||k.ownerDocument||k===c.target.ownerDocument&&a}while(k&&!c.isPropagationStopped());if(!c.isDefaultPrevented()){var n,o=f.event.special[h]||{};if((!o._default||!1===o._default.call(e.ownerDocument,c))&&("click"!==h||!f.nodeName(e,"a"))&&f.acceptData(e)){try{l&&e[h]&&(n=e[l],n&&(e[l]=null),f.event.triggered=h,e[h]())}catch(p){}n&&(e[l]=n),f.event.triggered=b}}return c.result}},handle:function(c){c=f.event.fix(c||a.event);var d=((f._data(this,"events")||{})[c.type]||[]).slice(0),e=!c.exclusive&&!c.namespace,g=Array.prototype.slice.call(arguments,0);g[0]=c,c.currentTarget=this;for(var h=0,i=d.length;h<i;h++){var j=d[h];if(e||c.namespace_re.test(j.namespace)){c.handler=j.handler,c.data=j.data,c.handleObj=j;var k=j.handler.apply(this,g);if(k!==b&&(c.result=k,!1===k&&(c.preventDefault(),c.stopPropagation())),c.isImmediatePropagationStopped())break}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[f.expando])return a;var d=a;a=f.Event(d);for(var g,e=this.props.length;e;)g=this.props[--e],a[g]=d[g];if(a.target||(a.target=a.srcElement||c),3===a.target.nodeType&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement),null==a.pageX&&null!=a.clientX){var h=a.target.ownerDocument||c,i=h.documentElement,j=h.body;a.pageX=a.clientX+(i&&i.scrollLeft||j&&j.scrollLeft||0)-(i&&i.clientLeft||j&&j.clientLeft||0),a.pageY=a.clientY+(i&&i.scrollTop||j&&j.scrollTop||0)-(i&&i.clientTop||j&&j.clientTop||0)}return null==a.which&&(null!=a.charCode||null!=a.keyCode)&&(a.which=null!=a.charCode?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=1&a.button?1:2&a.button?3:4&a.button?2:0),a},guid:1e8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,O(a.origType,a.selector),f.extend({},a,{handler:N,guid:a.handler.guid}))},remove:function(a){f.event.remove(this,O(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!this.preventDefault)return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?F:E):this.type=a,b&&f.extend(this,b),this.timeStamp=f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=F;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=F;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=F,this.stopPropagation()},isDefaultPrevented:E,isPropagationStopped:E,isImmediatePropagationStopped:E};var G=function(a){var b=a.relatedTarget;a.type=a.data;try{if(b&&b!==c&&!b.parentNode)return;for(;b&&b!==this;)b=b.parentNode;b!==this&&f.event.handle.apply(this,arguments)}catch(d){}},H=function(a){a.type=a.data,f.event.handle.apply(this,arguments)};if(f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={setup:function(c){f.event.add(this,b,c&&c.selector?H:G,a)},teardown:function(a){f.event.remove(this,b,a&&a.selector?H:G)}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(a,b){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=b.type;("submit"===c||"image"===c)&&f(b).closest("form").length&&L("submit",this,arguments)}),f.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=b.type;("text"===c||"password"===c)&&f(b).closest("form").length&&13===a.keyCode&&L("submit",this,arguments)})},teardown:function(a){f.event.remove(this,".specialSubmit")}}),!f.support.changeBubbles){var I,J=function(a){var b=a.type,c=a.value;return"radio"===b||"checkbox"===b?c=a.checked:"select-multiple"===b?c=a.selectedIndex>-1?f.map(a.options,function(a){return a.selected}).join("-"):"":f.nodeName(a,"select")&&(c=a.selectedIndex),c},K=function(c){var e,g,d=c.target;if(z.test(d.nodeName)&&!d.readOnly){if(e=f._data(d,"_change_data"),g=J(d),("focusout"!==c.type||"radio"!==d.type)&&f._data(d,"_change_data",g),e===b||g===e)return;(null!=e||g)&&(c.type="change",c.liveFired=b,f.event.trigger(c,arguments[1],d))}};f.event.special.change={filters:{focusout:K,beforedeactivate:K,click:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";("radio"===c||"checkbox"===c||f.nodeName(b,"select"))&&K.call(this,a)},keydown:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(13===a.keyCode&&!f.nodeName(b,"textarea")||32===a.keyCode&&("checkbox"===c||"radio"===c)||"select-multiple"===c)&&K.call(this,a)},beforeactivate:function(a){var b=a.target;f._data(b,"_change_data",J(b))}},setup:function(a,b){if("file"===this.type)return!1;for(var c in I)f.event.add(this,c+".specialChange",I[c]);return z.test(this.nodeName)},teardown:function(a){return f.event.remove(this,".specialChange"),z.test(this.nodeName)}},I=f.event.special.change.filters,I.focus=I.beforeactivate}f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){function e(a){var c=f.event.fix(a);c.type=b,c.originalEvent={},f.event.trigger(c,null,c.target),c.isDefaultPrevented()&&a.preventDefault()}var d=0;f.event.special[b]={setup:function(){0==d++&&c.addEventListener(a,e,!0)},teardown:function(){0==--d&&c.removeEventListener(a,e,!0)}}}),f.each(["bind","one"],function(a,c){f.fn[c]=function(a,d,e){var g;if("object"==typeof a){for(var h in a)this[c](h,d,a[h],e);return this}if(2!==arguments.length&&!1!==d||(e=d,d=b),"one"===c?(g=function(a){return f(this).unbind(a,g),e.apply(this,arguments)},g.guid=e.guid||f.guid++):g=e,"unload"===a&&"one"!==c)this.one(a,d,e);else for(var i=0,j=this.length;i<j;i++)f.event.add(this[i],a,g,d);return this}}),f.fn.extend({unbind:function(a,b){if("object"!=typeof a||a.preventDefault)for(var d=0,e=this.length;d<e;d++)f.event.remove(this[d],a,b);else for(var c in a)this.unbind(c,a[c]);return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return 0===arguments.length?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f.data(this,"lastToggle"+a.guid)||0)%d;return f.data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var M={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,c){f.fn[c]=function(a,d,e,g){var h,j,k,l,i=0,m=g||this.selector,n=g?this:f(this.context);if("object"==typeof a&&!a.preventDefault){for(var o in a)n[c](o,d,a[o],m);return this}if("die"===c&&!a&&g&&"."===g.charAt(0))return n.unbind(g),this;for((!1===d||f.isFunction(d))&&(e=d||E,d=b),a=(a||"").split(" ");null!=(h=a[i++]);)if(j=y.exec(h),k="",j&&(k=j[0],h=h.replace(y,"")),"hover"!==h)if(l=h,M[h]?(a.push(M[h]+k),h+=k):h=(M[h]||h)+k,"live"===c)for(var p=0,q=n.length;p<q;p++)f.event.add(n[p],"live."+O(h,m),{data:d,selector:m,handler:e,origType:h,origHandler:e,preType:l});else n.unbind("live."+O(h,m),e);else a.push("mouseenter"+k,"mouseleave"+k);return this}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){f.fn[b]=function(a,c){return null==c&&(c=a,a=null),arguments.length>0?this.bind(b,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;for(i=i[a];i;){if(i.sizcache===c){j=d[i.sizset];break}if(1===i.nodeType)if(f||(i.sizcache=c,i.sizset=g),"string"!=typeof b){if(i===b){j=!0;break}}else if(k.filter(b,[i]).length>0){j=i;break}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;for(i=i[a];i;){if(i.sizcache===c){j=d[i.sizset];break}if(1===i.nodeType&&!f&&(i.sizcache=c,i.sizset=g),i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){return h=!1,0});var k=function(b,d,f,g){f=f||[],d=d||c;var h=d;if(1!==d.nodeType&&9!==d.nodeType)return[];if(!b||"string"!=typeof b)return f;var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{if(a.exec(""),(i=a.exec(y))&&(y=i[3],x.push(i[1]),i[2])){o=i[3];break}}while(i);if(x.length>1&&m.exec(b))if(2===x.length&&l.relative[x[0]])j=v(x[0]+x[1],d);else for(j=l.relative[x[0]]?[d]:k(x.shift(),d);x.length;)b=x.shift(),l.relative[b]&&(b+=x.shift()),j=v(b,j);else if(!g&&x.length>1&&9===d.nodeType&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]),d)for(q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),1!==x.length||"~"!==x[0]&&"+"!==x[0]||!d.parentNode?d:d.parentNode,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;x.length;)r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",null==s&&(s=d),l.relative[r](n,s,w);else n=x=[];if(n||(n=j),n||k.error(r||b),"[object Array]"===e.call(n))if(u)if(d&&1===d.nodeType)for(t=0;null!=n[t];t++)n[t]&&(!0===n[t]||1===n[t].nodeType&&k.contains(d,n[t]))&&f.push(j[t]);else for(t=0;null!=n[t];t++)n[t]&&1===n[t].nodeType&&f.push(j[t]);else f.push.apply(f,n);else p(n,f);return o&&(k(o,h,f,g),k.uniqueSort(f)),f};k.uniqueSort=function(a){if(r&&(g=h,a.sort(r),g))for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1);return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];if(g.splice(1,1),"\\"!==j.substr(j.length-1)&&(g[1]=(g[1]||"").replace(i,""),null!=(d=l.find[h](g,b,c)))){a=a.replace(l.match[h],"");break}}}return d||(d=void 0!==b.getElementsByTagName?b.getElementsByTagName("*"):[]),{set:d,expr:a}},k.filter=function(a,c,d,e){for(var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);a&&c.length;){for(var n in l.filter)if(null!=(f=l.leftMatch[n].exec(a))&&f[2]){var o,p,q=l.filter[n],r=f[1];if(g=!1,f.splice(1,1),"\\"===r.substr(r.length-1))continue;if(j===i&&(i=[]),l.preFilter[n])if(f=l.preFilter[n](f,j,d,i,e,m)){if(!0===f)continue}else g=o=!0;if(f)for(var s=0;null!=(p=j[s]);s++)if(p){o=q(p,f,s,j);var t=e^!!o;d&&null!=o?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}if(o!==b){if(d||(j=i),a=a.replace(l.match[n],""),!g)return[];break}}if(a===h){if(null!=g)break;k.error(a)}h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+a};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c="string"==typeof b,d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var h,f=0,g=a.length;f<g;f++)if(h=a[f]){for(;(h=h.previousSibling)&&1!==h.nodeType;);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&k.filter(b,a,!0)},">":function(a,b){var c,d="string"==typeof b,e=0,f=a.length;if(d&&!j.test(b)){for(b=b.toLowerCase();e<f;e++)if(c=a[e]){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b&&g}}else{for(;e<f;e++)(c=a[e])&&(a[e]=d?c.parentNode:c.parentNode===b);d&&k.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=u;"string"==typeof b&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=u;"string"==typeof b&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(void 0!==b.getElementById&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(void 0!==b.getElementsByName){for(var c=[],d=b.getElementsByName(a[1]),e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return 0===c.length?null:c}},TAG:function(a,b){if(void 0!==b.getElementsByTagName)return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){if(a=" "+a[1].replace(i,"")+" ",f)return a;for(var h,g=0;null!=(h=b[g]);g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if("nth"===a[1]){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===a[2]&&"2n"||"odd"===a[2]&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&k.error(a[0]);return a[0]=d++,a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");return!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),"~="===a[2]&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(b,c,d,e,f){if("not"===b[1]){if(!((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))){var g=k.filter(b[3],c,d,!0^f);return d||e.push.apply(e,g),!1}b[3]=k(b[3],null,null,c)}else if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0]))return!0;return b},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return!1===a.disabled&&"hidden"!==a.type},disabled:function(a){return!0===a.disabled},checked:function(a){return!0===a.checked},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return"input"===a.nodeName.toLowerCase()&&"text"===c&&(b===c||null===b)},radio:function(a){return"input"===a.nodeName.toLowerCase()&&"radio"===a.type},checkbox:function(a){return"input"===a.nodeName.toLowerCase()&&"checkbox"===a.type},file:function(a){return"input"===a.nodeName.toLowerCase()&&"file"===a.type},password:function(a){return"input"===a.nodeName.toLowerCase()&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"submit"===a.type},image:function(a){return"input"===a.nodeName.toLowerCase()&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return 0===b},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2==0},odd:function(a,b){return b%2==1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f)return f(a,c,b,d);if("contains"===e)return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0;if("not"===e){for(var g=b[3],h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"===c)return!0;d=a;case"last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0;case"nth":var e=b[2],f=b[3];if(1===e&&0===f)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)1===d.nodeType&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return 0===e?0===j:j%e==0&&j/e>=0}},ID:function(a,b){return 1===a.nodeType&&a.getAttribute("id")===b},TAG:function(a,b){return"*"===b&&1===a.nodeType||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):null!=a[c]?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return null==d?"!="===f:"="===f?e===g:"*="===f?e.indexOf(g)>=0:"~="===f?(" "+e+" ").indexOf(g)>=0:g?"!="===f?e!==g:"^="===f?0===e.indexOf(g):"$="===f?e.substr(e.length-g.length)===g:"|="===f&&(e===g||e.substr(0,g.length+1)===g+"-"):e&&!1!==d},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f)return f(a,c,b,d)}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match)l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n));var p=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if("[object Array]"===e.call(a))Array.prototype.push.apply(d,a);else if("number"==typeof a.length)for(var f=a.length;c<f;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){return a===b?(g=!0,0):a.compareDocumentPosition&&b.compareDocumentPosition?4&a.compareDocumentPosition(b)?-1:1:a.compareDocumentPosition?-1:1}:(r=function(a,b){if(a===b)return g=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return s(a,b);if(!h)return-1;if(!i)return 1;for(;j;)e.unshift(j),j=j.parentNode;for(j=i;j;)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return s(e[k],f[k]);return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b)return c;for(var d=a.nextSibling;d;){if(d===b)return-1;d=d.nextSibling}return 1}),k.getText=function(a){for(var c,b="",d=0;a[d];d++)c=a[d],3===c.nodeType||4===c.nodeType?b+=c.nodeValue:8!==c.nodeType&&(b+=k.getText(c.childNodes));return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(void 0!==c.getElementById&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||void 0!==e.getAttributeNode&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},l.filter.ID=function(a,b){var c=void 0!==a.getAttributeNode&&a.getAttributeNode("id");return 1===a.nodeType&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if("*"===a[1]){for(var d=[],e=0;c[e];e++)1===c[e].nodeType&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&void 0!==a.firstChild.getAttribute&&"#"!==a.firstChild.getAttribute("href")&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div");if(b.innerHTML="<p class='TEST'></p>",!b.querySelectorAll||0!==b.querySelectorAll(".TEST").length){k=function(b,e,f,g){if(e=e||c,!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(1===e.nodeType||9===e.nodeType)){if(h[1])return p(e.getElementsByTagName(b),f);if(h[2]&&l.find.CLASS&&e.getElementsByClassName)return p(e.getElementsByClassName(h[2]),f)}if(9===e.nodeType){if("body"===b&&e.body)return p([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return p([],f);if(i.id===h[3])return p([i],f)}try{return p(e.querySelectorAll(b),f)}catch(j){}}else if(1===e.nodeType&&"object"!==e.nodeName.toLowerCase()){var m=e,n=e.getAttribute("id"),o=n||"__sizzle__",q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||q)return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}catch(s){}finally{n||m.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)k[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}k.matchesSelector=function(a,c){if(c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!k.isXML(a))try{if(e||!l.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&11!==a.document.nodeType)return f}}catch(g){}return k(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");if(a.innerHTML="<div class='test e'></div><div class='test'></div>",a.getElementsByClassName&&0!==a.getElementsByClassName("e").length){if(a.lastChild.className="e",1===a.getElementsByClassName("e").length)return;l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(void 0!==b.getElementsByClassName&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?k.contains=function(a,b){return a!==b&&(!a.contains||a.contains(b))}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return!!(16&a.compareDocumentPosition(b))}:k.contains=function(){return!1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return!!b&&"HTML"!==b.nodeName};var v=function(a,b){for(var c,d=[],e="",f=b.nodeType?[b]:b;c=l.match.PSEUDO.exec(a);)e+=c[0],a=a.replace(l.match.PSEUDO,"");a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)k(a,f[g],d);return k.filter(e,d)};f.find=k,f.expr=k.selectors,f.expr[":"]=f.expr.filters,f.unique=k.uniqueSort,f.text=k.getText,f.isXMLDoc=k.isXML,f.contains=k.contains}();var P=/Until$/,Q=/^(?:parents|prevUntil|prevAll)/,R=/,/,S=/^.[^:#\[\.,]*$/,T=Array.prototype.slice,U=f.expr.match.POS,V={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var c,d,b=this;if("string"!=typeof a)return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var g,h,i,e=this.pushStack("","find",a);for(c=0,d=this.length;c<d;c++)if(g=e.length,f.find(a,this[c],e),c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(X(this,a,!1),"not",a)},filter:function(a){return this.pushStack(X(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var d,e,c=[],g=this[0];if(f.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(d=0,e=a.length;d<e;d++)i=a[d],j[i]||(j[i]=U.test(i)?f(i,b||this.context):i);for(;g&&g.ownerDocument&&g!==b;){for(i in j)h=j[i],(h.jquery?h.index(g)>-1:f(g).is(h))&&c.push({selector:i,elem:g,level:k});g=g.parentNode,k++}}return c}var l=U.test(a)||"string"!=typeof a?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++)for(g=this[d];g;){if(l?l.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}if(!(g=g.parentNode)||!g.ownerDocument||g===b||11===g.nodeType)break}return c=c.length>1?f.unique(c):c,this.pushStack(c,"closest",a)},index:function(a){return a&&"string"!=typeof a?f.inArray(a.jquery?a[0]:a,this):f.inArray(this[0],a?f(a):this.parent().children())},add:function(a,b){var c="string"==typeof a?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(W(c[0])||W(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c),g=T.call(arguments);return P.test(a)||(d=c),d&&"string"==typeof d&&(e=f.filter(d,e)),e=this.length>1&&!V[a]?f.unique(e):e,(this.length>1||R.test(d))&&Q.test(a)&&(e=e.reverse()),this.pushStack(e,a,g.join(","))}}),f.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){for(var e=[],g=a[c];g&&9!==g.nodeType&&(d===b||1!==g.nodeType||!f(g).is(d));)1===g.nodeType&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;for(var e=0;a&&(1!==a.nodeType||++e!==b);a=a[c]);return a},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Y=/ jQuery\d+="(?:\d+|null)"/g,Z=/^\s+/,$=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_=/<([\w:]+)/,ba=/<tbody/i,bb=/<|&#?\w+;/,bc=/<(?:script|object|embed|option|style)/i,bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.isFunction(a)?this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))}):"object"!=typeof a&&a!==b?this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a)):f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return f.isFunction(a)?this.each(function(b){f(this).wrapInner(a.call(this,b))}):this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){1===this.nodeType&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){1===this.nodeType&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f(arguments[0]);return a.push.apply(a,this.toArray()),this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);return a.push.apply(a,f(arguments[0]).toArray()),a}},remove:function(a,b){for(var d,c=0;null!=(d=this[c]);c++)a&&!f.filter(a,[d]).length||(!b&&1===d.nodeType&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d));return this},empty:function(){for(var b,a=0;null!=(b=this[a]);a++)for(1===b.nodeType&&f.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(Y,""):null;if("string"!=typeof a||bc.test(a)||!f.support.leadingWhitespace&&Z.test(a)||bg[(_.exec(a)||["",""])[1].toLowerCase()])f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);else{a=a.replace($,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)1===this[c].nodeType&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}return this},replaceWith:function(a){return this[0]&&this[0].parentNode?f.isFunction(a)?this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=f(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})):this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&3===arguments.length&&"string"==typeof j&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){if(i=j&&j.parentNode,e=f.support.parentNode&&i&&11===i.nodeType&&i.childNodes.length===this.length?{fragment:i}:f.buildFragment(a,this,k),h=e.fragment,g=1===h.childNodes.length?h=h.firstChild:h.firstChild,g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bh(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bn)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i=b&&b[0]?b[0].ownerDocument||b[0]:c;return 1===a.length&&"string"==typeof a[0]&&a[0].length<512&&i===c&&"<"===a[0].charAt(0)&&!bc.test(a[0])&&(f.support.checkClone||!bd.test(a[0]))&&(g=!0,(h=f.fragments[a[0]])&&1!==h&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[a[0]]=h?e:1),{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=1===this.length&&this[0].parentNode;if(g&&11===g.nodeType&&1===g.childNodes.length&&1===e.length)return e[b](this[0]),this;for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var e,g,h,d=a.cloneNode(!0);if(!(f.support.noCloneEvent&&f.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||f.isXMLDoc(a)))for(bj(a,d),e=bk(a),g=bk(d),h=0;e[h];++h)bj(e[h],g[h]);if(b&&(bi(a,d),c))for(e=bk(a),g=bk(d),h=0;e[h];++h)bi(e[h],g[h]);return d},clean:function(a,b,d,e){var g;b=b||c,void 0===b.createElement&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var i,k,h=[],j=0;null!=(k=a[j]);j++)if("number"==typeof k&&(k+=""),k){if("string"==typeof k)if(bb.test(k)){k=k.replace($,"<$1></$2>");var l=(_.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");for(o.innerHTML=m[1]+k+m[2];n--;)o=o.lastChild;if(!f.support.tbody){var p=ba.test(k),q="table"!==l||p?"<table>"!==m[1]||p?[]:o.childNodes:o.firstChild&&o.firstChild.childNodes;for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&Z.test(k)&&o.insertBefore(b.createTextNode(Z.exec(k)[0]),o.firstChild),k=o.childNodes}else k=b.createTextNode(k);var r;if(!f.support.appendChecked)if(k[0]&&"number"==typeof(r=k.length))for(i=0;i<r;i++)bm(k[i]);else bm(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d)for(g=function(a){return!a.type||be.test(a.type)},j=0;h[j];j++)if(!e||!f.nodeName(h[j],"script")||h[j].type&&"text/javascript"!==h[j].type.toLowerCase()){if(1===h[j].nodeType){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}else e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);return h},cleanData:function(a){for(var b,c,j,d=f.cache,e=f.expando,g=f.event.special,h=f.support.deleteExpando,i=0;null!=(j=a[i]);i++)if((!j.nodeName||!f.noData[j.nodeName.toLowerCase()])&&(c=j[f.expando])){if((b=d[c]&&d[c][e])&&b.events){for(var k in b.events)g[k]?f.event.remove(j,k):f.removeEvent(j,k,b.handle);b.handle&&(b.handle.elem=null)}h?delete j[f.expando]:j.removeAttribute&&j.removeAttribute(f.expando),delete d[c]}}});var bz,bA,bB,bo=/alpha\([^)]*\)/i,bp=/opacity=([^)]*)/,bq=/-([a-z])/gi,br=/([A-Z]|^ms)/g,bs=/^-?\d+(?:px)?$/i,bt=/^-?\d/,bu=/^[+\-]=/,bv=/[^+\-\.\de]+/g,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bC=function(a,b){return b.toUpperCase()};f.fn.css=function(a,c){return 2===arguments.length&&c===b?this:f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return""===c?"1":c}return a.style.opacity}}},cssNumber:{zIndex:!0,fontWeight:!0,opacity:!0,zoom:!0,lineHeight:!0,widows:!0,orphans:!0},cssProps:{float:f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];if(c=f.cssProps[i]||i,d===b)return k&&"get"in k&&(g=k.get(a,!1,e))!==b?g:j[c];if("number"===(h=typeof d)&&isNaN(d)||null==d)return;if("string"===h&&bu.test(d)&&(d=+d.replace(bv,"")+parseFloat(f.css(a,c))),"number"===h&&!f.cssNumber[i]&&(d+="px"),!(k&&"set"in k&&(d=k.set(a,d))===b))try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;return c=f.camelCase(c),g=f.cssHooks[c],"cssFloat"===(c=f.cssProps[c]||c)&&(c="float"),g&&"get"in g&&(e=g.get(a,!0,d))!==b?e:bz?bz(a,c):void 0},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]},camelCase:function(a){return a.replace(bq,bC)}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c)return 0!==a.offsetWidth?e=bD(a,b,d):f.swap(a,bw,function(){e=bD(a,b,d)}),e<=0&&("0px"===(e=bz(a,b,b))&&bB&&(e=bB(a,b,b)),null!=e)?""===e||"auto"===e?"0px":e:e<0||null==e?(e=a.style[b],""===e||"auto"===e?"0px":e):"string"==typeof e?e:e+"px"},set:function(a,b){return bs.test(b)?(b=parseFloat(b),b>=0?b+"px":void 0):b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bp.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle;c.zoom=1;var e=f.isNaN(b)?"":"alpha(opacity="+100*b+")",g=d&&d.filter||c.filter||"";c.filter=bo.test(g)?g.replace(bo,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;return f.swap(a,{display:"inline-block"},function(){c=b?bz(a,"margin-right","marginRight"):a.style.marginRight}),c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,c){var d,e,g;return c=c.replace(br,"-$1").toLowerCase(),(e=a.ownerDocument.defaultView)?((g=e.getComputedStyle(a,null))&&""===(d=g.getPropertyValue(c))&&!f.contains(a.ownerDocument.documentElement,a)&&(d=f.style(a,c)),d):b}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;return!bs.test(d)&&bt.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":d||0,d=f.pixelLeft+"px",f.left=c,e&&(a.runtimeStyle.left=e)),""===d?"auto":d}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return 0===b&&0===c||!f.support.reliableHiddenOffsets&&"none"===(a.style.display||f.css(a,"display"))},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bW,bX,bE=/%20/g,bF=/\[\]$/,bG=/\r?\n/g,bH=/#.*$/,bI=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,bJ=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bK=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,bL=/^(?:GET|HEAD)$/,bM=/^\/\//,bN=/\?/,bO=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bP=/^(?:select|textarea)/i,bQ=/\s+/,bR=/([?&])_=[^&]*/,bS=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bT=f.fn.load,bU={},bV={};try{bW=e.href}catch(bY){bW=c.createElement("a"),bW.href="",bW=bW.href}bX=bS.exec(bW.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if("string"!=typeof a&&bT)return bT.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):"object"==typeof c&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;return f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bO,"")).find(g):c)),d&&i.each(d,[c,b,a])}}),this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bP.test(this.nodeName)||bJ.test(this.type))}).map(function(a,b){var c=f(this).val();return null==c?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bG,"\r\n")}}):{name:b.name,value:c.replace(bG,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.bind(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){return f.isFunction(d)&&(g=g||e,e=d,d=b),f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?f.extend(!0,a,f.ajaxSettings,b):(b=a,a=f.extend(!0,f.ajaxSettings,b));for(var c in{context:1,url:1})c in b?a[c]=b[c]:c in f.ajaxSettings&&(a[c]=f.ajaxSettings[c]);return a},ajaxSettings:{url:bW,isLocal:bK.test(bX[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML}},ajaxPrefilter:bZ(bU),ajaxTransport:bZ(bV),ajax:function(a,c){function w(a,c,l,m){if(2!==s){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a?4:0;var o,r,u,x,y,w=l?ca(d,v,l):b;if(a>=200&&a<300||304===a)if(d.ifModified&&((x=v.getResponseHeader("Last-Modified"))&&(f.lastModified[k]=x),(y=v.getResponseHeader("Etag"))&&(f.etag[k]=y)),304===a)c="notmodified",o=!0;else try{r=cb(d,w),c="success",o=!0}catch(z){c="parsererror",u=z}else u=c,c&&!a||(c="error",a<0&&(a=0));v.status=a,v.statusText=c,o?h.resolveWith(e,[r,c,v]):h.rejectWith(e,[v,c,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.resolveWith(e,[v,c]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b),c=c||{};var k,n,o,p,q,r,t,u,d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f._Deferred(),j=d.statusCode||{},l={},m={},s=0,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return 2===s?n:null},getResponseHeader:function(a){var c;if(2===s){if(!o)for(o={};c=bI.exec(n);)o[c[1].toLowerCase()]=c[2];c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return s||(d.mimeType=a),this},abort:function(a){return a=a||"abort",p&&p.abort(a),w(0,a),this}};if(h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.done,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bH,"").replace(bM,bX[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bQ),null==d.crossDomain&&(r=bS.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bX[1]&&r[2]==bX[2]&&(r[3]||("http:"===r[1]?80:443))==(bX[3]||("http:"===bX[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=f.param(d.data,d.traditional)),b$(bU,d,c,v),2===s)return!1;if(t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bL.test(d.type),t&&0==f.active++&&f.event.trigger("ajaxStart"),!d.hasContent&&(d.data&&(d.url+=(bN.test(d.url)?"&":"?")+d.data),k=d.url,!1===d.cache)){var x=f.now(),y=d.url.replace(bR,"$1_="+x);d.url=y+(y===d.url?(bN.test(d.url)?"&":"?")+"_="+x:"")}(d.data&&d.hasContent&&!1!==d.contentType||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", */*; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(!1===d.beforeSend.call(e,v,d)||2===s))return v.abort(),!1;for(u in{success:1,error:1,complete:1})v[u](d[u]);if(p=b$(bV,d,c,v)){v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){status<2?w(-1,z):f.error(z)}}else w(-1,"No Transport");return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=f.ajaxSettings.traditional),f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)b_(g,a[g],c,e);return d.join("&").replace(bE,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e="application/x-www-form-urlencoded"===b.contentType&&"string"==typeof b.data;if("jsonp"===b.dataTypes[0]||!1!==b.jsonp&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";return!1!==b.jsonp&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){return g||f.error(h+" was not called"),g[0]},b.dataTypes[0]="json","script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return f.globalEval(a),a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){(c||!d.readyState||/loaded|complete/.test(d.readyState))&&(d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success"))},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cg,ce=!!a.ActiveXObject&&function(){for(var a in cg)cg[a](0,1)},cf=0;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var i,j,h=c.xhr();if(c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async),c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||4===h.readyState))if(d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]),e)4!==h.readyState&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}j||!c.isLocal||c.crossDomain?1223===j&&(j=204):j=m.text?200:404}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},c.async&&4!==h.readyState?(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var ck,cl,co,cq,cj={},cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr=a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame;f.fn.extend({show:function(a,b,c){var d,e;if(a||0===a)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&"none"===e&&(e=d.style.display=""),""===e&&"none"===f.css(d,"display")&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++)d=this[g],d.style&&(""!==(e=d.style.display)&&"none"!==e||(d.style.display=f._data(d,"olddisplay")||""));return this},hide:function(a,b,c){if(a||0===a)return this.animate(cu("hide",3),a,b,c);for(var d=0,e=this.length;d<e;d++)if(this[d].style){var g=f.css(this[d],"display");"none"!==g&&!f._data(this[d],"olddisplay")&&f._data(this[d],"olddisplay",g)}for(d=0;d<e;d++)this[d].style&&(this[d].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d="boolean"==typeof a;return f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):null==a||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c),this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=f.speed(b,c,d);return f.isEmptyObject(a)?this.each(e.complete,[!1]):(a=f.extend({},a),this[!1===e.queue?"each":"queue"](function(){!1===e.queue&&f._mark(this);var g,h,i,j,k,l,m,n,o,b=f.extend({},e),c=1===this.nodeType,d=c&&f(this).is(":hidden");b.animatedProperties={};for(i in a){if(g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing","hide"===h&&d||"show"===h&&!d)return b.complete.call(this);c&&("height"===g||"width"===g)&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===f.css(this,"display")&&"none"===f.css(this,"float")&&(f.support.inlineBlockNeedsLayout?(j=cv(this.nodeName),"inline"===j?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)):this.style.display="inline-block"))}null!=b.overflow&&(this.style.overflow="hidden");for(i in a)k=new f.fx(this,b,i),h=a[i],cm.test(h)?k["toggle"===h?d?"show":"hide":h]():(l=cn.exec(h),m=k.cur(),l?(n=parseFloat(l[2]),o=l[3]||(f.cssNumber[i]?"":"px"),"px"!==o&&(f.style(this,i,(n||1)+o),m=(n||1)/k.cur()*m,f.style(this,i,m+o)),l[1]&&(n=("-="===l[1]?-1:1)*n+m),k.custom(m,n,o)):k.custom(m,h,""));return!0}))},stop:function(a,b){return a&&this.queue([]),this.each(function(){var a=f.timers,c=a.length;for(b||f._unmark(!0,this);c--;)a[c].elem===this&&(b&&a[c](!0),a.splice(c,1))}),b||this.dequeue(),this}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&"object"==typeof a?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};return d.duration=f.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default,d.old=d.complete,d.complete=function(a){!1!==d.queue?f.dequeue(this):!1!==a&&f._unmark(this),f.isFunction(d.old)&&d.old.call(this)},d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?b&&"auto"!==b?b:0:a},custom:function(a,b,c){function h(a){return d.step(a)}var g,d=this,e=f.fx;this.startTime=cq||cs(),this.start=a,this.end=b,this.unit=c||this.unit||(f.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,h.elem=this.elem,h()&&f.timers.push(h)&&!co&&(cr?(co=1,g=function(){co&&(cr(g),e.tick())},cr(g)):co=setInterval(e.tick,e.interval))},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.show=!0,this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var g,h,b=cq||cs(),c=!0,d=this.elem,e=this.options;if(a||b>=e.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),e.animatedProperties[this.prop]=!0;for(g in e.animatedProperties)!0!==e.animatedProperties[g]&&(c=!1);if(c){if(null!=e.overflow&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){d.style["overflow"+b]=e.overflow[a]}),e.hide&&f(d).hide(),e.hide||e.show)for(var i in e.animatedProperties)f.style(d,i,e.orig[i]);e.complete.call(d)}return!1}return e.duration==1/0?this.now=b:(h=b-this.startTime,this.state=h/e.duration,this.pos=f.easing[e.animatedProperties[this.prop]](this.state,h,0,1,e.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},f.extend(f.fx,{tick:function(){for(var a=f.timers,b=0;b<a.length;++b)a[b]()||a.splice(b--,1);a.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&null!=a.elem.style[a.prop]?a.elem.style[a.prop]=("width"===a.prop||"height"===a.prop?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var c,b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft;return{top:c.top+l-j,left:c.left+m-k}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);f.offset.initialize();for(var c,d=b.offsetParent,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;(b=b.parentNode)&&b!==i&&b!==h&&(!f.offset.supportsFixedPosition||"fixed"!==k.position);)c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.offset.doesNotAddBorder&&(!f.offset.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),d,d=b.offsetParent),f.offset.subtractsBorderForOverflowNotVisible&&"visible"!==c.overflow&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c;return"relative"!==k.position&&"static"!==k.position||(l+=i.offsetTop,m+=i.offsetLeft),f.offset.supportsFixedPosition&&"fixed"===k.position&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft)),{top:l,left:m}},f.offset={initialize:function(){var d,e,h,a=c.body,b=c.createElement("div"),i=parseFloat(f.css(a,"marginTop"))||0;f.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",a.insertBefore(b,a.firstChild),d=b.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===h.offsetTop,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=20===e.offsetTop||15===e.offsetTop,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),f.offset.initialize=f.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return f.offset.initialize(),f.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");"static"===d&&(a.style.position="relative");var m,n,e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=("absolute"===d||"fixed"===d)&&f.inArray("auto",[h,i])>-1,k={},l={};j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),null!=b.top&&(k.top=b.top-g.top+m),null!=b.left&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||c.body;a&&!cx.test(a.nodeName)&&"static"===f.css(a,"position");)a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;return c===b?(e=this[0])?(g=cy(e),g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]):null:this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){return this[0]?parseFloat(f.css(this[0],d,"padding")):null},f.fn["outer"+c]=function(a){return this[0]?parseFloat(f.css(this[0],d,a?"margin":"border")):null},f.fn[d]=function(a){var e=this[0];if(!e)return null==a?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c];return"CSS1Compat"===e.document.compatMode&&g||e.document.body["client"+c]||g}if(9===e.nodeType)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var h=f.css(e,d),i=parseFloat(h);return f.isNaN(i)?h:i}return this.css(d,"string"==typeof a?a:a+"px")}}),a.jQuery=a.$=f}(window),function($){function toIntegersAtLease(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(date){return this.getUTCFullYear()+"-"+toIntegersAtLease(this.getUTCMonth())+"-"+toIntegersAtLease(this.getUTCDate())};var escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};$.quoteString=function(string){return escapeable.test(string)?'"'+string.replace(escapeable,function(a){var c=meta[a];return"string"==typeof c?c:(c=a.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+string+'"'},$.toJSON=function(o,compact){var type=typeof o;if("undefined"==type)return"undefined";if("number"==type||"boolean"==type)return o+"";if(null===o)return"null";if("string"==type)return $.quoteString(o);if("object"==type&&"function"==typeof o.toJSON)return o.toJSON(compact);if("function"!=type&&"number"==typeof o.length){for(var ret=[],i=0;i<o.length;i++)ret.push($.toJSON(o[i],compact));return compact?"["+ret.join(",")+"]":"["+ret.join(", ")+"]"}if("function"==type)throw new TypeError("Unable to convert object of type 'function' to json.");var ret=[];for(var k in o){var name;if("number"==(type=typeof k))name='"'+k+'"';else{if("string"!=type)continue;name=$.quoteString(k)}var val=$.toJSON(o[k],compact);"string"==typeof val&&(compact?ret.push(name+":"+val):ret.push(name+": "+val))}return"{"+ret.join(", ")+"}"},$.compactJSON=function(o){return $.toJSON(o,!0)},$.evalJSON=function(src){return eval("("+src+")")},$.secureEvalJSON=function(src){var filtered=src;if(filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")}}(jQuery),function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(g){function c(){!a&&this.init&&this.init.apply(this,arguments)}var f=this.prototype;a=!0;var e=new this;a=!1;for(var d in g)e[d]="function"==typeof g[d]&&"function"==typeof f[d]&&b.test(g[d])?function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);return this._super=k,j}}(d,g[d]):g[d];return c.prototype=e,c.constructor=c,c.extend=arguments.callee,c}}(),function(a){this.jStoreDelegate=Class.extend({init:function(b){this.parent=b,this.callbacks={}},bind:function(b,c){return a.isFunction(c)?(this.callbacks[b]||(this.callbacks[b]=[]),this.callbacks[b].push(c),this):this},trigger:function(){var d=this.parent,c=[].slice.call(arguments),e=c.shift(),b=this.callbacks[e];return!!b&&(a.each(b,function(){this.apply(d,c)}),this)}})}(jQuery),function(b){var a;try{a=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(c){a=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}b.jStore={},b.extend(b.jStore,{EngineOrder:[],Availability:{},Engines:{},Instances:{},CurrentEngine:null,defaults:{project:null,engine:null,autoload:!0,flash:"jStore.Flash.html"},isReady:!1,isFlashReady:!1,delegate:new jStoreDelegate(b.jStore).bind("jStore-ready",function(d){b.jStore.isReady=!0,b.jStore.defaults.autoload&&d.connect()}).bind("flash-ready",function(){b.jStore.isFlashReady=!0}),ready:function(d){b.jStore.isReady?d.apply(b.jStore,[b.jStore.CurrentEngine]):b.jStore.delegate.bind("jStore-ready",d)},fail:function(d){b.jStore.delegate.bind("jStore-failure",d)},flashReady:function(d){b.jStore.isFlashReady?d.apply(b.jStore,[b.jStore.CurrentEngine]):b.jStore.delegate.bind("flash-ready",d)},use:function(g,i,f){i=i||b.jStore.defaults.project||location.hostname.replace(/\./g,"-")||"unknown";var h=b.jStore.Engines[g.toLowerCase()]||null,d=(f?f+".":"")+i+"."+g;if(!h)throw"JSTORE_ENGINE_UNDEFINED";if(h=new h(i,d),b.jStore.Instances[d])throw"JSTORE_JRI_CONFLICT";if(h.isAvailable())b.jStore.Instances[d]=h,b.jStore.CurrentEngine||(b.jStore.CurrentEngine=h),b.jStore.delegate.trigger("jStore-ready",h);else{if(!h.autoload)throw"JSTORE_ENGINE_UNAVILABLE";h.included(function(){this.isAvailable()?(b.jStore.Instances[d]=this,b.jStore.CurrentEngine||(b.jStore.CurrentEngine=this),b.jStore.delegate.trigger("jStore-ready",this)):b.jStore.delegate.trigger("jStore-failure",this)}).include()}},setCurrentEngine:function(d){if(!b.jStore.Instances.length)return b.jStore.FindEngine();if(!d&&b.jStore.Instances.length>=1)return b.jStore.delegate.trigger("jStore-ready",b.jStore.Instances[0]),b.jStore.CurrentEngine=b.jStore.Instances[0];if(d&&b.jStore.Instances[d])return b.jStore.delegate.trigger("jStore-ready",b.jStore.Instances[d]),b.jStore.CurrentEngine=b.jStore.Instances[d];throw"JSTORE_JRI_NO_MATCH"},FindEngine:function(){b.each(b.jStore.EngineOrder,function(d){if(b.jStore.Availability[this]())return b.jStore.use(this,b.jStore.defaults.project,"default"),!1})},load:function(){if(b.jStore.defaults.engine)return b.jStore.use(b.jStore.defaults.engine,b.jStore.defaults.project,"default");try{b.jStore.FindEngine()}catch(d){}},safeStore:function(d){switch(typeof d){case"object":case"function":return b.jStore.compactJSON(d);case"number":case"boolean":case"string":case"xml":return d;case"undefined":default:return""}},safeResurrect:function(d){return a.test(d)?b.evalJSON(d):d},store:function(d,e){return!!b.jStore.CurrentEngine&&(e?b.jStore.CurrentEngine.set(d,e):b.jStore.CurrentEngine.get(d))},remove:function(d){return!!b.jStore.CurrentEngine&&b.jStore.CurrentEngine.rem(d)},get:function(d){return b.jStore.store(d)},set:function(d,e){return b.jStore.store(d,e)}}),b.extend(b.fn,{store:function(e,f){if(!b.jStore.CurrentEngine)return this;var d=b.jStore.store(e,f);return f?this:d},removeStore:function(d){return b.jStore.remove(d),this},getStore:function(d){return b.jStore.store(d)},setStore:function(d,e){return b.jStore.store(d,e),this}})}(jQuery),function(a){this.StorageEngine=Class.extend({init:function(c,b){this.project=c,this.jri=b,this.data={},this.limit=-1,this.includes=[],this.delegate=new jStoreDelegate(this).bind("engine-ready",function(){this.isReady=!0}).bind("engine-included",function(){this.hasIncluded=!0}),this.autoload=!1,this.isReady=!1,this.hasIncluded=!1},include:function(){var b=this,d=this.includes.length,c=0;a.each(this.includes,function(){a.ajax({type:"get",url:this,dataType:"script",cache:!0,success:function(){++c==d&&b.delegate.trigger("engine-included")}})})},isAvailable:function(){return!1},interruptAccess:function(){if(!this.isReady)throw"JSTORE_ENGINE_NOT_READY"},ready:function(b){return this.isReady?b.apply(this):this.delegate.bind("engine-ready",b),this},included:function(b){return this.hasIncluded?b.apply(this):this.delegate.bind("engine-included",b),this},get:function(b){return this.interruptAccess(),this.data[b]||null},set:function(b,c){return this.interruptAccess(),this.data[b]=c,c},rem:function(b){this.interruptAccess();var c=this.data[b];return this.data[b]=null,c}})}(jQuery),function(c){var b=c.jStore.Availability.session=function(){return!!window.sessionStorage},a=c.jStore.Availability.local=function(){return!(!window.localStorage&&!window.globalStorage)};this.jStoreDom=StorageEngine.extend({init:function(e,d){this._super(e,d),this.type="DOM",this.limit=5242880},connect:function(){this.delegate.trigger("engine-ready")},get:function(e){this.interruptAccess();var d=this.db.getItem(e);return c.jStore.safeResurrect(d&&d.value?d.value:d)},set:function(d,e){return this.interruptAccess(),this.db.setItem(d,c.jStore.safeStore(e)),e},rem:function(e){this.interruptAccess();var d=this.get(e);return this.db.removeItem(e),d}}),this.jStoreLocal=jStoreDom.extend({connect:function(){this.db=window.globalStorage?window.globalStorage[location.hostname]:window.localStorage,this._super()},isAvailable:a}),this.jStoreSession=jStoreDom.extend({connect:function(){this.db=sessionStorage,this._super()},isAvailable:b}),c.jStore.Engines.local=jStoreLocal,c.jStore.Engines.session=jStoreSession,c.jStore.EngineOrder[1]="local"}(jQuery),function(b){var a=b.jStore.Availability.flash=function(){return!!b.jStore.hasFlash("8.0.0")};this.jStoreFlash=StorageEngine.extend({init:function(e,d){this._super(e,d),this.type="Flash";var c=this;b.jStore.flashReady(function(){c.flashReady()})},connect:function(){this.project;b(document.body).append('<iframe style="height:1px;width:1px;position:absolute;left:0;top:0;margin-left:-100px;" id="jStoreFlashFrame" src="'+b.jStore.defaults.flash+'"></iframe>')},flashReady:function(f){var c=b("#jStoreFlashFrame")[0];if(c.Document&&b.isFunction(c.Document.jStoreFlash.f_get_cookie))this.db=c.Document.jStoreFlash;else if(c.contentWindow&&c.contentWindow.document){var d=c.contentWindow.document;b.isFunction(b("object",b(d))[0].f_get_cookie)?this.db=b("object",b(d))[0]:b.isFunction(b("embed",b(d))[0].f_get_cookie)&&(this.db=b("embed",b(d))[0])}this.db&&this.delegate.trigger("engine-ready")},isAvailable:a,get:function(d){this.interruptAccess();var c=this.db.f_get_cookie(d);return"null"==c?null:b.jStore.safeResurrect(c)},set:function(c,d){return this.interruptAccess(),this.db.f_set_cookie(c,b.jStore.safeStore(d)),d},rem:function(c){this.interruptAccess();var d=this.get(c);return this.db.f_delete_cookie(c),d}}),b.jStore.Engines.flash=jStoreFlash,b.jStore.EngineOrder[2]="flash",b.jStore.hasFlash=function(c){for(var e=b.jStore.flashVersion().match(/\d+/g),f=c.match(/\d+/g),d=0;d<3;d++){if(e[d]=parseInt(e[d]||0),f[d]=parseInt(f[d]||0),e[d]<f[d])return!1;if(e[d]>f[d])return!0}return!0},b.jStore.flashVersion=function(){try{try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{c.AllowScriptAccess="always"}catch(d){return"6,0,0"}}catch(d){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(d){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(d){}}return"0,0,0"}}(jQuery),function(b){var a=b.jStore.Availability.gears=function(){return!(!window.google||!window.google.gears)};this.jStoreGears=StorageEngine.extend({init:function(d,c){this._super(d,c),this.type="Google Gears",this.includes.push("http://code.google.com/apis/gears/gears_init.js"),this.autoload=!0},connect:function(){var c=this.db=google.gears.factory.create("beta.database");c.open("jstore-"+this.project),c.execute("CREATE TABLE IF NOT EXISTS jstore (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)"),this.updateCache()},updateCache:function(){for(var c=this.db.execute("SELECT k,v FROM jstore");c.isValidRow();)this.data[c.field(0)]=b.jStore.safeResurrect(c.field(1)),c.next();c.close(),this.delegate.trigger("engine-ready")},isAvailable:a,set:function(d,e){this.interruptAccess();var c=this.db;return c.execute("BEGIN"),c.execute("INSERT OR REPLACE INTO jstore(k, v) VALUES (?, ?)",[d,b.jStore.safeStore(e)]),c.execute("COMMIT"),this._super(d,e)},rem:function(d){this.interruptAccess();var c=this.db;return c.execute("BEGIN"),c.execute("DELETE FROM jstore WHERE k = ?",[d]),c.execute("COMMIT"),this._super(d)}}),b.jStore.Engines.gears=jStoreGears,b.jStore.EngineOrder[3]="gears"}(jQuery),function(b){var a=b.jStore.Availability.html5=function(){return!!window.openDatabase};this.jStoreHtml5=StorageEngine.extend({init:function(d,c){this._super(d,c),this.type="HTML5",this.limit=204800},connect:function(){var c=this.db=openDatabase("jstore-"+this.project,"1.0",this.project,this.limit);if(!c)throw"JSTORE_ENGINE_HTML5_NODB";c.transaction(function(d){d.executeSql("CREATE TABLE IF NOT EXISTS jstore (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)")}),this.updateCache()},updateCache:function(){var c=this;this.db.transaction(function(d){d.executeSql("SELECT k,v FROM jstore",[],function(f,e){for(var j,h=e.rows,g=0;g<h.length;++g)j=h.item(g),c.data[j.k]=b.jStore.safeResurrect(j.v);c.delegate.trigger("engine-ready")})})},isAvailable:a,set:function(c,d){return this.interruptAccess(),this.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO jstore(k, v) VALUES (?, ?)",[c,b.jStore.safeStore(d)])}),this._super(c,d)},rem:function(c){return this.interruptAccess(),this.db.transaction(function(d){d.executeSql("DELETE FROM jstore WHERE k = ?",[c])}),this._super(c)}}),b.jStore.Engines.html5=jStoreHtml5,b.jStore.EngineOrder[0]="html5"}(jQuery),function(b){var a=b.jStore.Availability.ie=function(){return!!window.ActiveXObject};this.jStoreIE=StorageEngine.extend({init:function(d,c){this._super(d,c),this.type="IE",this.limit=65536},connect:function(){this.db=b('<div style="display:none;behavior:url(\'#default#userData\')" id="jstore-'+this.project+'"></div>').appendTo(document.body).get(0),this.delegate.trigger("engine-ready")},isAvailable:a,get:function(c){return this.interruptAccess(),this.db.load(this.project),b.jStore.safeResurrect(this.db.getAttribute(c))},set:function(c,d){return this.interruptAccess(),this.db.setAttribute(c,b.jStore.safeStore(d)),this.db.save(this.project),d},rem:function(c){this.interruptAccess();var d=this.get(c);return this.db.removeAttribute(c),this.db.save(this.project),d}}),b.jStore.Engines.ie=jStoreIE,b.jStore.EngineOrder[4]="ie"}(jQuery),function($){$.toJSON=function(o){if("object"==typeof JSON&&JSON.stringify)return JSON.stringify(o);var type=typeof o;if(null===o)return"null";if("undefined"!=type){if("number"==type||"boolean"==type)return o+"";if("string"==type)return $.quoteString(o);if("object"==type){if("function"==typeof o.toJSON)return $.toJSON(o.toJSON());if(o.constructor===Date){var month=o.getUTCMonth()+1;month<10&&(month="0"+month);var day=o.getUTCDate();day<10&&(day="0"+day);var year=o.getUTCFullYear(),hours=o.getUTCHours();hours<10&&(hours="0"+hours);var minutes=o.getUTCMinutes();minutes<10&&(minutes="0"+minutes);var seconds=o.getUTCSeconds();seconds<10&&(seconds="0"+seconds);var milli=o.getUTCMilliseconds();return milli<100&&(milli="0"+milli),milli<10&&(milli="0"+milli),'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){for(var ret=[],i=0;i<o.length;i++)ret.push($.toJSON(o[i])||"null");return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name,type=typeof k;if("number"==type)name='"'+k+'"';else{if("string"!=type)continue;name=$.quoteString(k)}if("function"!=typeof o[k]){var val=$.toJSON(o[k]);pairs.push(name+":"+val)}}return"{"+pairs.join(", ")+"}"}}},$.evalJSON=function(src){return"object"==typeof JSON&&JSON.parse?JSON.parse(src):eval("("+src+")")},$.secureEvalJSON=function(src){if("object"==typeof JSON&&JSON.parse)return JSON.parse(src);var filtered=src;if(filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");try{throw new SyntaxError("Error parsing JSON, source is not valid.")}catch(e){}},$.quoteString=function(string){return string.match(_escapeable)?'"'+string.replace(_escapeable,function(a){var c=_meta[a];return"string"==typeof c?c:(c=a.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,_meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}(jQuery),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.socketCluster=f()}}(function(){var define;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(_dereq_,module,exports){var SCClientSocket=_dereq_("./lib/scclientsocket"),factory=_dereq_("./lib/factory");module.exports.factory=factory,module.exports.SCClientSocket=SCClientSocket,module.exports.Emitter=_dereq_("component-emitter"),module.exports.create=function(options){return factory.create(options)},module.exports.connect=module.exports.create,module.exports.destroy=function(socket){return factory.destroy(socket)},module.exports.clients=factory.clients,module.exports.version="14.2.1"},{"./lib/factory":3,"./lib/scclientsocket":5,"component-emitter":12}],2:[function(_dereq_,module,exports){(function(global){var AuthEngine=function(){this._internalStorage={},this.isLocalStorageEnabled=this._checkLocalStorageEnabled()};AuthEngine.prototype._checkLocalStorageEnabled=function(){var err;try{global.localStorage,global.localStorage.setItem("__scLocalStorageTest",1),global.localStorage.removeItem("__scLocalStorageTest")}catch(e){err=e}return!err},AuthEngine.prototype.saveToken=function(name,token,options,callback){this.isLocalStorageEnabled&&global.localStorage?global.localStorage.setItem(name,token):this._internalStorage[name]=token,callback&&callback(null,token)},AuthEngine.prototype.removeToken=function(name,callback){var token;this.loadToken(name,function(err,authToken){token=authToken}),this.isLocalStorageEnabled&&global.localStorage?global.localStorage.removeItem(name):delete this._internalStorage[name],callback&&callback(null,token)},AuthEngine.prototype.loadToken=function(name,callback){var token;token=this.isLocalStorageEnabled&&global.localStorage?global.localStorage.getItem(name):this._internalStorage[name]||null,callback(null,token)},module.exports.AuthEngine=AuthEngine}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(_dereq_,module,exports){(function(global){function getMultiplexId(options){var protocolPrefix=options.secure?"https://":"http://",queryString="";if(options.query)if("string"==typeof options.query)queryString=options.query;else{var queryArray=[],queryMap=options.query;for(var key in queryMap)queryMap.hasOwnProperty(key)&&queryArray.push(key+"="+queryMap[key]);queryArray.length&&(queryString="?"+queryArray.join("&"))}var host;return host=options.host?options.host:options.hostname+":"+options.port,protocolPrefix+host+options.path+queryString}function isUrlSecure(){return global.location&&"https:"===location.protocol}function getPort(options,isSecureDefault){var isSecure=null==options.secure?isSecureDefault:options.secure;return options.port||(global.location&&location.port?location.port:isSecure?443:80)}function create(options){if(options=options||{},options.host&&!options.host.match(/[^:]+:\d{2,5}/))throw new InvalidArgumentsError('The host option should include both the hostname and the port number in the format "hostname:port"');if(options.host&&options.hostname)throw new InvalidArgumentsError('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and hostname options together');if(options.host&&options.port)throw new InvalidArgumentsError('The host option should already include the hostname and the port number in the format "hostname:port" - Because of this, you should never use host and port options together');var isSecureDefault=isUrlSecure(),opts={port:getPort(options,isSecureDefault),hostname:global.location&&location.hostname||"localhost",path:"/socketcluster/",secure:isSecureDefault,autoConnect:!0,autoReconnect:!0,autoSubscribeOnConnect:!0,connectTimeout:2e4,ackTimeout:1e4,timestampRequests:!1,timestampParam:"t",authEngine:null,authTokenName:"socketCluster.authToken",binaryType:"arraybuffer",multiplex:!0,pubSubBatchDuration:null,cloneData:!1};for(var i in options)options.hasOwnProperty(i)&&(opts[i]=options[i]);if(opts.clientMap=_clients,!1===opts.multiplex){opts.clientId=uuid.v4();var socket=new SCClientSocket(opts);return _clients[opts.clientId]=socket,socket}return opts.clientId=getMultiplexId(opts),_clients[opts.clientId]?opts.autoConnect&&_clients[opts.clientId].connect():_clients[opts.clientId]=new SCClientSocket(opts),_clients[opts.clientId]}function destroy(socket){socket.destroy()}var SCClientSocket=_dereq_("./scclientsocket"),scErrors=_dereq_("sc-errors"),uuid=_dereq_("uuid"),InvalidArgumentsError=scErrors.InvalidArgumentsError,_clients={};module.exports={create:create,destroy:destroy,clients:_clients}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./scclientsocket":5,"sc-errors":21,uuid:23}],4:[function(_dereq_,module,exports){var scErrors=_dereq_("sc-errors"),InvalidActionError=scErrors.InvalidActionError,Response=function(socket,id){this.socket=socket,this.id=id,this.sent=!1};Response.prototype._respond=function(responseData){if(this.sent)throw new InvalidActionError("Response "+this.id+" has already been sent");this.sent=!0,this.socket.send(this.socket.encode(responseData))},Response.prototype.end=function(data){if(this.id){var responseData={rid:this.id};void 0!==data&&(responseData.data=data),this._respond(responseData)}},Response.prototype.error=function(error,data){if(this.id){var err=scErrors.dehydrateError(error),responseData={rid:this.id,error:err};void 0!==data&&(responseData.data=data),this._respond(responseData)}},Response.prototype.callback=function(error,data){error?this.error(error,data):this.end(data)},module.exports.Response=Response},{"sc-errors":21}],5:[function(_dereq_,module,exports){(function(global,Buffer){var Emitter=_dereq_("component-emitter"),SCChannel=_dereq_("sc-channel").SCChannel,AuthEngine=(_dereq_("./response").Response,_dereq_("./auth").AuthEngine),formatter=_dereq_("sc-formatter"),SCTransport=_dereq_("./sctransport").SCTransport,querystring=_dereq_("querystring"),LinkedList=_dereq_("linked-list"),base64=_dereq_("base-64"),clone=_dereq_("clone"),scErrors=_dereq_("sc-errors"),InvalidArgumentsError=scErrors.InvalidArgumentsError,InvalidMessageError=scErrors.InvalidMessageError,InvalidActionError=scErrors.InvalidActionError,SocketProtocolError=scErrors.SocketProtocolError,TimeoutError=scErrors.TimeoutError,BadConnectionError=scErrors.BadConnectionError,isBrowser="undefined"!=typeof window,SCClientSocket=function(opts){var self=this;Emitter.call(this),this.id=null,this.state=this.CLOSED,this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null,this.pendingReconnect=!1,this.pendingReconnectTimeout=null,this.preparingPendingSubscriptions=!1,this.clientId=opts.clientId,this.connectTimeout=opts.connectTimeout,this.ackTimeout=opts.ackTimeout,this.channelPrefix=opts.channelPrefix||null,this.disconnectOnUnload=null==opts.disconnectOnUnload||opts.disconnectOnUnload,this.authTokenName=opts.authTokenName,this.pingTimeout=this.ackTimeout,this.pingTimeoutDisabled=!!opts.pingTimeoutDisabled,this.active=!0,this._clientMap=opts.clientMap||{};var maxTimeout=Math.pow(2,31)-1,verifyDuration=function(propertyName){if(self[propertyName]>maxTimeout)throw new InvalidArgumentsError("The "+propertyName+" value provided exceeded the maximum amount allowed")};if(verifyDuration("connectTimeout"),verifyDuration("ackTimeout"),this._localEvents={connect:1,connectAbort:1,close:1,disconnect:1,message:1,error:1,raw:1,kickOut:1,subscribe:1,unsubscribe:1,subscribeStateChange:1,authStateChange:1,authenticate:1,deauthenticate:1,removeAuthToken:1,subscribeRequest:1},this.connectAttempts=0,this._emitBuffer=new LinkedList,this.channels={},this.options=opts,this._cid=1,this.options.callIdGenerator=function(){return self._cid++},this.options.autoReconnect){null==this.options.autoReconnectOptions&&(this.options.autoReconnectOptions={});var reconnectOptions=this.options.autoReconnectOptions;null==reconnectOptions.initialDelay&&(reconnectOptions.initialDelay=1e4),null==reconnectOptions.randomness&&(reconnectOptions.randomness=1e4),null==reconnectOptions.multiplier&&(reconnectOptions.multiplier=1.5),null==reconnectOptions.maxDelay&&(reconnectOptions.maxDelay=6e4)}if(null==this.options.subscriptionRetryOptions&&(this.options.subscriptionRetryOptions={}),this.options.authEngine?this.auth=this.options.authEngine:this.auth=new AuthEngine,this.options.codecEngine?this.codec=this.options.codecEngine:this.codec=formatter,this.options.protocol){var protocolOptionError=new InvalidArgumentsError('The "protocol" option does not affect socketcluster-client. If you want to utilize SSL/TLS - use "secure" option instead');this._onSCError(protocolOptionError)}this.options.path=this.options.path.replace(/\/$/,"")+"/",this.options.query=opts.query||{},"string"==typeof this.options.query&&(this.options.query=querystring.parse(this.options.query)),this._channelEmitter=new Emitter,this._unloadHandler=function(){self.disconnect()},isBrowser&&this.disconnectOnUnload&&global.addEventListener&&global.addEventListener("beforeunload",this._unloadHandler,!1),this._clientMap[this.clientId]=this,this.options.autoConnect&&this.connect()};SCClientSocket.prototype=Object.create(Emitter.prototype),SCClientSocket.CONNECTING=SCClientSocket.prototype.CONNECTING=SCTransport.prototype.CONNECTING,SCClientSocket.OPEN=SCClientSocket.prototype.OPEN=SCTransport.prototype.OPEN,SCClientSocket.CLOSED=SCClientSocket.prototype.CLOSED=SCTransport.prototype.CLOSED,SCClientSocket.AUTHENTICATED=SCClientSocket.prototype.AUTHENTICATED="authenticated",SCClientSocket.UNAUTHENTICATED=SCClientSocket.prototype.UNAUTHENTICATED="unauthenticated",SCClientSocket.PENDING=SCClientSocket.prototype.PENDING="pending",SCClientSocket.ignoreStatuses=scErrors.socketProtocolIgnoreStatuses,SCClientSocket.errorStatuses=scErrors.socketProtocolErrorStatuses,SCClientSocket.prototype._privateEventHandlerMap={"#publish":function(data){var undecoratedChannelName=this._undecorateChannelName(data.channel);this.isSubscribed(undecoratedChannelName,!0)&&this._channelEmitter.emit(undecoratedChannelName,data.data)},"#kickOut":function(data){var undecoratedChannelName=this._undecorateChannelName(data.channel),channel=this.channels[undecoratedChannelName];channel&&(Emitter.prototype.emit.call(this,"kickOut",data.message,undecoratedChannelName),channel.emit("kickOut",data.message,undecoratedChannelName),this._triggerChannelUnsubscribe(channel))},"#setAuthToken":function(data,response){var self=this;if(data){var triggerAuthenticate=function(err){err?(response.error(err),self._onSCError(err)):(self._changeToAuthenticatedState(data.token),response.end())};this.auth.saveToken(this.authTokenName,data.token,{},triggerAuthenticate)}else response.error(new InvalidMessageError("No token data provided by #setAuthToken event"))},"#removeAuthToken":function(data,response){var self=this;this.auth.removeToken(this.authTokenName,function(err,oldToken){err?(response.error(err),self._onSCError(err)):(Emitter.prototype.emit.call(self,"removeAuthToken",oldToken),self._changeToUnauthenticatedStateAndClearTokens(),response.end())})},"#disconnect":function(data){this.transport.close(data.code,data.data)}},SCClientSocket.prototype.getState=function(){return this.state},SCClientSocket.prototype.getBytesReceived=function(){return this.transport.getBytesReceived()},SCClientSocket.prototype.deauthenticate=function(callback){var self=this;this.auth.removeToken(this.authTokenName,function(err,oldToken){err?self._onSCError(err):(Emitter.prototype.emit.call(self,"removeAuthToken",oldToken),self.state!==self.CLOSED&&self.emit("#removeAuthToken"),self._changeToUnauthenticatedStateAndClearTokens()),callback&&callback(err)})},SCClientSocket.prototype.connect=SCClientSocket.prototype.open=function(){var self=this;if(!this.active){var error=new InvalidActionError("Cannot connect a destroyed client");return void this._onSCError(error)}this.state===this.CLOSED&&(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this.state=this.CONNECTING,Emitter.prototype.emit.call(this,"connecting"),this.transport&&this.transport.off(),this.transport=new SCTransport(this.auth,this.codec,this.options),this.transport.on("open",function(status){self.state=self.OPEN,self._onSCOpen(status)}),this.transport.on("error",function(err){self._onSCError(err)}),this.transport.on("close",function(code,data){self.state=self.CLOSED,self._onSCClose(code,data)}),this.transport.on("openAbort",function(code,data){self.state=self.CLOSED,self._onSCClose(code,data,!0)}),this.transport.on("event",function(event,data,res){self._onSCEvent(event,data,res)}))},SCClientSocket.prototype.reconnect=function(code,data){this.disconnect(code,data),this.connect()},SCClientSocket.prototype.disconnect=function(code,data){if("number"!=typeof(code=code||1e3))throw new InvalidArgumentsError("If specified, the code argument must be a number");this.state===this.OPEN||this.state===this.CONNECTING?this.transport.close(code,data):(this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef))},SCClientSocket.prototype.destroy=function(code,data){isBrowser&&global.removeEventListener&&global.removeEventListener("beforeunload",this._unloadHandler,!1),this.active=!1,this.disconnect(code,data),delete this._clientMap[this.clientId]},SCClientSocket.prototype._changeToUnauthenticatedStateAndClearTokens=function(){if(this.authState!==this.UNAUTHENTICATED){var oldState=this.authState,oldSignedToken=this.signedAuthToken;this.authState=this.UNAUTHENTICATED,this.signedAuthToken=null,this.authToken=null;var stateChangeData={oldState:oldState,newState:this.authState};Emitter.prototype.emit.call(this,"authStateChange",stateChangeData),Emitter.prototype.emit.call(this,"deauthenticate",oldSignedToken)}},SCClientSocket.prototype._changeToAuthenticatedState=function(signedAuthToken){if(this.signedAuthToken=signedAuthToken,this.authToken=this._extractAuthTokenData(signedAuthToken),this.authState!==this.AUTHENTICATED){var oldState=this.authState;this.authState=this.AUTHENTICATED;var stateChangeData={oldState:oldState,newState:this.authState,signedAuthToken:signedAuthToken,authToken:this.authToken};this.preparingPendingSubscriptions||this.processPendingSubscriptions(),Emitter.prototype.emit.call(this,"authStateChange",stateChangeData)}Emitter.prototype.emit.call(this,"authenticate",signedAuthToken)},SCClientSocket.prototype.decodeBase64=function(encodedString){var decodedString;if(void 0===Buffer)decodedString=global.atob?global.atob(encodedString):base64.decode(encodedString);else{decodedString=Buffer.from(encodedString,"base64").toString("utf8")}return decodedString},SCClientSocket.prototype.encodeBase64=function(decodedString){var encodedString;if(void 0===Buffer)encodedString=global.btoa?global.btoa(decodedString):base64.encode(decodedString);else{encodedString=Buffer.from(decodedString,"utf8").toString("base64")}return encodedString},SCClientSocket.prototype._extractAuthTokenData=function(signedAuthToken){var tokenParts=(signedAuthToken||"").split("."),encodedTokenData=tokenParts[1];if(null!=encodedTokenData){var tokenData=encodedTokenData;try{return tokenData=this.decodeBase64(tokenData),JSON.parse(tokenData)}catch(e){return tokenData}}return null},SCClientSocket.prototype.getAuthToken=function(){return this.authToken},SCClientSocket.prototype.getSignedAuthToken=function(){return this.signedAuthToken},SCClientSocket.prototype.authenticate=function(signedAuthToken,callback){var self=this;this.emit("#authenticate",signedAuthToken,function(err,authStatus){authStatus&&null!=authStatus.isAuthenticated?authStatus.authError&&(authStatus.authError=scErrors.hydrateError(authStatus.authError)):authStatus={isAuthenticated:self.authState,authError:null},err?("BadConnectionError"!==err.name&&"TimeoutError"!==err.name&&self._changeToUnauthenticatedStateAndClearTokens(),callback&&callback(err,authStatus)):self.auth.saveToken(self.authTokenName,signedAuthToken,{},function(err){err&&self._onSCError(err),authStatus.isAuthenticated?self._changeToAuthenticatedState(signedAuthToken):self._changeToUnauthenticatedStateAndClearTokens(),callback&&callback(err,authStatus)})})},SCClientSocket.prototype._tryReconnect=function(initialDelay){var timeout,self=this,exponent=this.connectAttempts++,reconnectOptions=this.options.autoReconnectOptions;if(null==initialDelay||exponent>0){var initialTimeout=Math.round(reconnectOptions.initialDelay+(reconnectOptions.randomness||0)*Math.random());timeout=Math.round(initialTimeout*Math.pow(reconnectOptions.multiplier,exponent))}else timeout=initialDelay;timeout>reconnectOptions.maxDelay&&(timeout=reconnectOptions.maxDelay),clearTimeout(this._reconnectTimeoutRef),this.pendingReconnect=!0,this.pendingReconnectTimeout=timeout,this._reconnectTimeoutRef=setTimeout(function(){self.connect()},timeout)},SCClientSocket.prototype._onSCOpen=function(status){var self=this;this.preparingPendingSubscriptions=!0,status?(this.id=status.id,this.pingTimeout=status.pingTimeout,this.transport.pingTimeout=this.pingTimeout,status.isAuthenticated?this._changeToAuthenticatedState(status.authToken):this._changeToUnauthenticatedStateAndClearTokens()):this._changeToUnauthenticatedStateAndClearTokens(),this.connectAttempts=0,this.options.autoSubscribeOnConnect&&this.processPendingSubscriptions(),Emitter.prototype.emit.call(this,"connect",status,function(){self.processPendingSubscriptions()}),this.state===this.OPEN&&this._flushEmitBuffer()},SCClientSocket.prototype._onSCError=function(err){var self=this;setTimeout(function(){if(self.listeners("error").length<1)throw err;Emitter.prototype.emit.call(self,"error",err)},0)},SCClientSocket.prototype._suspendSubscriptions=function(){var channel,newState;for(var channelName in this.channels)this.channels.hasOwnProperty(channelName)&&(channel=this.channels[channelName],newState=channel.state===channel.SUBSCRIBED||channel.state===channel.PENDING?channel.PENDING:channel.UNSUBSCRIBED,this._triggerChannelUnsubscribe(channel,newState))},SCClientSocket.prototype._abortAllPendingEventsDueToBadConnection=function(failureType){for(var nextNode,currentNode=this._emitBuffer.head;currentNode;){nextNode=currentNode.next;var eventObject=currentNode.data;clearTimeout(eventObject.timeout),delete eventObject.timeout,currentNode.detach(),currentNode=nextNode;var callback=eventObject.callback;if(callback){delete eventObject.callback;var errorMessage="Event '"+eventObject.event+"' was aborted due to a bad connection",error=new BadConnectionError(errorMessage,failureType);callback.call(eventObject,error,eventObject)}eventObject.cid&&this.transport.cancelPendingResponse(eventObject.cid)}},SCClientSocket.prototype._onSCClose=function(code,data,openAbort){var self=this;if(this.id=null,this.transport&&this.transport.off(),this.pendingReconnect=!1,this.pendingReconnectTimeout=null,clearTimeout(this._reconnectTimeoutRef),this._suspendSubscriptions(),this._abortAllPendingEventsDueToBadConnection(openAbort?"connectAbort":"disconnect"),this.options.autoReconnect&&(4e3===code||4001===code||1005===code?this._tryReconnect(0):1e3!==code&&code<4500&&this._tryReconnect()),openAbort?Emitter.prototype.emit.call(self,"connectAbort",code,data):Emitter.prototype.emit.call(self,"disconnect",code,data),Emitter.prototype.emit.call(self,"close",code,data),!SCClientSocket.ignoreStatuses[code]){var closeMessage;closeMessage=data?"Socket connection closed with status code "+code+" and reason: "+data:"Socket connection closed with status code "+code;var err=new SocketProtocolError(SCClientSocket.errorStatuses[code]||closeMessage,code);this._onSCError(err)}},SCClientSocket.prototype._onSCEvent=function(event,data,res){var handler=this._privateEventHandlerMap[event];handler?handler.call(this,data,res):Emitter.prototype.emit.call(this,event,data,function(){res&&res.callback.apply(res,arguments)})},SCClientSocket.prototype.decode=function(message){return this.transport.decode(message)},SCClientSocket.prototype.encode=function(object){return this.transport.encode(object)},SCClientSocket.prototype._flushEmitBuffer=function(){for(var nextNode,currentNode=this._emitBuffer.head;currentNode;){nextNode=currentNode.next;var eventObject=currentNode.data;currentNode.detach(),this.transport.emitObject(eventObject),currentNode=nextNode}},SCClientSocket.prototype._handleEventAckTimeout=function(eventObject,eventNode){eventNode&&eventNode.detach(),delete eventObject.timeout;var callback=eventObject.callback;if(callback){delete eventObject.callback;var error=new TimeoutError("Event response for '"+eventObject.event+"' timed out");callback.call(eventObject,error,eventObject)}eventObject.cid&&this.transport.cancelPendingResponse(eventObject.cid)},SCClientSocket.prototype._emit=function(event,data,callback){var self=this;this.state===this.CLOSED&&this.connect();var eventObject={event:event,callback:callback},eventNode=new LinkedList.Item;this.options.cloneData?eventObject.data=clone(data):eventObject.data=data,eventNode.data=eventObject,eventObject.timeout=setTimeout(function(){self._handleEventAckTimeout(eventObject,eventNode)},this.ackTimeout),this._emitBuffer.append(eventNode),this.state===this.OPEN&&this._flushEmitBuffer()},SCClientSocket.prototype.send=function(data){this.transport.send(data)},SCClientSocket.prototype.emit=function(event,data,callback){if(null==this._localEvents[event])this._emit(event,data,callback);else if("error"===event)Emitter.prototype.emit.call(this,event,data);else{var error=new InvalidActionError('The "'+event+'" event is reserved and cannot be emitted on a client socket');this._onSCError(error)}},SCClientSocket.prototype.publish=function(channelName,data,callback){var pubData={channel:this._decorateChannelName(channelName),data:data};this.emit("#publish",pubData,callback)},SCClientSocket.prototype._triggerChannelSubscribe=function(channel,subscriptionOptions){var channelName=channel.name;if(channel.state!==channel.SUBSCRIBED){var oldState=channel.state;channel.state=channel.SUBSCRIBED;var stateChangeData={channel:channelName,oldState:oldState,newState:channel.state,subscriptionOptions:subscriptionOptions};channel.emit("subscribeStateChange",stateChangeData),channel.emit("subscribe",channelName,subscriptionOptions),Emitter.prototype.emit.call(this,"subscribeStateChange",stateChangeData),Emitter.prototype.emit.call(this,"subscribe",channelName,subscriptionOptions)}},SCClientSocket.prototype._triggerChannelSubscribeFail=function(err,channel,subscriptionOptions){var channelName=channel.name,meetsAuthRequirements=!channel.waitForAuth||this.authState===this.AUTHENTICATED;channel.state!==channel.UNSUBSCRIBED&&meetsAuthRequirements&&(channel.state=channel.UNSUBSCRIBED,channel.emit("subscribeFail",err,channelName,subscriptionOptions),Emitter.prototype.emit.call(this,"subscribeFail",err,channelName,subscriptionOptions))},SCClientSocket.prototype._cancelPendingSubscribeCallback=function(channel){null!=channel._pendingSubscriptionCid&&(this.transport.cancelPendingResponse(channel._pendingSubscriptionCid),delete channel._pendingSubscriptionCid)},SCClientSocket.prototype._decorateChannelName=function(channelName){return this.channelPrefix&&(channelName=this.channelPrefix+channelName),channelName},SCClientSocket.prototype._undecorateChannelName=function(decoratedChannelName){return this.channelPrefix&&0===decoratedChannelName.indexOf(this.channelPrefix)?decoratedChannelName.replace(this.channelPrefix,""):decoratedChannelName},SCClientSocket.prototype._trySubscribe=function(channel){var self=this,meetsAuthRequirements=!channel.waitForAuth||this.authState===this.AUTHENTICATED;if(this.state===this.OPEN&&!this.preparingPendingSubscriptions&&null==channel._pendingSubscriptionCid&&meetsAuthRequirements){var options={noTimeout:!0},subscriptionOptions={channel:this._decorateChannelName(channel.name)};channel.waitForAuth&&(options.waitForAuth=!0,subscriptionOptions.waitForAuth=options.waitForAuth),channel.data&&(subscriptionOptions.data=channel.data),channel.batch&&(options.batch=!0,subscriptionOptions.batch=!0),channel._pendingSubscriptionCid=this.transport.emit("#subscribe",subscriptionOptions,options,function(err){delete channel._pendingSubscriptionCid,err?self._triggerChannelSubscribeFail(err,channel,subscriptionOptions):self._triggerChannelSubscribe(channel,subscriptionOptions)}),Emitter.prototype.emit.call(this,"subscribeRequest",channel.name,subscriptionOptions)}},SCClientSocket.prototype.subscribe=function(channelName,options){var channel=this.channels[channelName];return channel?options&&channel.setOptions(options):(channel=new SCChannel(channelName,this,options),this.channels[channelName]=channel),channel.state===channel.UNSUBSCRIBED&&(channel.state=channel.PENDING,this._trySubscribe(channel)),channel},SCClientSocket.prototype._triggerChannelUnsubscribe=function(channel,newState){var channelName=channel.name,oldState=channel.state;if(channel.state=newState||channel.UNSUBSCRIBED,this._cancelPendingSubscribeCallback(channel),oldState===channel.SUBSCRIBED){var stateChangeData={channel:channelName,oldState:oldState,newState:channel.state};channel.emit("subscribeStateChange",stateChangeData),channel.emit("unsubscribe",channelName),Emitter.prototype.emit.call(this,"subscribeStateChange",stateChangeData),Emitter.prototype.emit.call(this,"unsubscribe",channelName)}},SCClientSocket.prototype._tryUnsubscribe=function(channel){if(this.state===this.OPEN){var options={noTimeout:!0};channel.batch&&(options.batch=!0),this._cancelPendingSubscribeCallback(channel);var decoratedChannelName=this._decorateChannelName(channel.name);this.transport.emit("#unsubscribe",decoratedChannelName,options)}},SCClientSocket.prototype.unsubscribe=function(channelName){var channel=this.channels[channelName];channel&&channel.state!==channel.UNSUBSCRIBED&&(this._triggerChannelUnsubscribe(channel),this._tryUnsubscribe(channel))},SCClientSocket.prototype.channel=function(channelName,options){var currentChannel=this.channels[channelName];return currentChannel||(currentChannel=new SCChannel(channelName,this,options),this.channels[channelName]=currentChannel),currentChannel},SCClientSocket.prototype.destroyChannel=function(channelName){var channel=this.channels[channelName];channel&&(channel.unwatch(),channel.unsubscribe(),delete this.channels[channelName])},SCClientSocket.prototype.subscriptions=function(includePending){var channel,subs=[];for(var channelName in this.channels)this.channels.hasOwnProperty(channelName)&&(channel=this.channels[channelName],(includePending?channel&&(channel.state===channel.SUBSCRIBED||channel.state===channel.PENDING):channel&&channel.state===channel.SUBSCRIBED)&&subs.push(channelName));return subs},SCClientSocket.prototype.isSubscribed=function(channelName,includePending){var channel=this.channels[channelName];return includePending?!!channel&&(channel.state===channel.SUBSCRIBED||channel.state===channel.PENDING):!!channel&&channel.state===channel.SUBSCRIBED},SCClientSocket.prototype.processPendingSubscriptions=function(){var self=this;this.preparingPendingSubscriptions=!1;var pendingChannels=[];for(var i in this.channels)if(this.channels.hasOwnProperty(i)){var channel=this.channels[i];channel.state===channel.PENDING&&pendingChannels.push(channel)}pendingChannels.sort(function(a,b){var ap=a.priority||0,bp=b.priority||0;return ap>bp?-1:ap<bp?1:0}),pendingChannels.forEach(function(channel){self._trySubscribe(channel)})},SCClientSocket.prototype.watch=function(channelName,handler){if("function"!=typeof handler)throw new InvalidArgumentsError("No handler function was provided");this._channelEmitter.on(channelName,handler)},SCClientSocket.prototype.unwatch=function(channelName,handler){handler?this._channelEmitter.removeListener(channelName,handler):this._channelEmitter.removeAllListeners(channelName)},SCClientSocket.prototype.watchers=function(channelName){return this._channelEmitter.listeners(channelName)},module.exports=SCClientSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer)},{"./auth":2,"./response":4,"./sctransport":6,"base-64":8,buffer:10,clone:11,"component-emitter":12,"linked-list":15,querystring:18,"sc-channel":19,"sc-errors":21,"sc-formatter":22}],6:[function(_dereq_,module,exports){(function(global){var WebSocket,createWebSocket,Emitter=_dereq_("component-emitter"),Response=_dereq_("./response").Response,querystring=_dereq_("querystring");global.WebSocket?(WebSocket=global.WebSocket,createWebSocket=function(uri,options){return new WebSocket(uri)}):(WebSocket=_dereq_("ws"),createWebSocket=function(uri,options){return new WebSocket(uri,null,options)});var scErrors=_dereq_("sc-errors"),TimeoutError=scErrors.TimeoutError,BadConnectionError=scErrors.BadConnectionError,SCTransport=function(authEngine,codecEngine,options){var self=this;this.state=this.CLOSED,this.auth=authEngine,this.codec=codecEngine,this.options=options,this.connectTimeout=options.connectTimeout,this.pingTimeout=options.ackTimeout,this.pingTimeoutDisabled=!!options.pingTimeoutDisabled,this.callIdGenerator=options.callIdGenerator,this.authTokenName=options.authTokenName,this._pingTimeoutTicker=null,this._callbackMap={},this._batchSendList=[],this.state=this.CONNECTING;var uri=this.uri(),wsSocket=createWebSocket(uri,this.options);wsSocket.binaryType=this.options.binaryType,this.socket=wsSocket,wsSocket.onopen=function(){self._onOpen()},wsSocket.onclose=function(event){var code;code=null==event.code?1005:event.code,self._onClose(code,event.reason)},wsSocket.onmessage=function(message,flags){self._onMessage(message.data)},wsSocket.onerror=function(error){self.state===self.CONNECTING&&self._onClose(1006)},this._connectTimeoutRef=setTimeout(function(){self._onClose(4007),self.socket.close(4007)},this.connectTimeout)};SCTransport.prototype=Object.create(Emitter.prototype),SCTransport.CONNECTING=SCTransport.prototype.CONNECTING="connecting",SCTransport.OPEN=SCTransport.prototype.OPEN="open",SCTransport.CLOSED=SCTransport.prototype.CLOSED="closed",SCTransport.prototype.uri=function(){var query=this.options.query||{},schema=this.options.secure?"wss":"ws";this.options.timestampRequests&&(query[this.options.timestampParam]=(new Date).getTime()),query=querystring.encode(query),query.length&&(query="?"+query);var host;if(this.options.host)host=this.options.host;else{var port="";this.options.port&&("wss"===schema&&443!==this.options.port||"ws"===schema&&80!==this.options.port)&&(port=":"+this.options.port),host=this.options.hostname+port}return schema+"://"+host+this.options.path+query},SCTransport.prototype._onOpen=function(){var self=this;clearTimeout(this._connectTimeoutRef),this._resetPingTimeout(),this._handshake(function(err,status){if(err){var statusCode;statusCode=status&&status.code?status.code:4003,self._onError(err),self._onClose(statusCode,err.toString()),self.socket.close(statusCode)}else self.state=self.OPEN,Emitter.prototype.emit.call(self,"open",status),self._resetPingTimeout()})},SCTransport.prototype._handshake=function(callback){var self=this;this.auth.loadToken(this.authTokenName,function(err,token){if(err)callback(err);else{var options={force:!0};self.emit("#handshake",{authToken:token},options,function(err,status){status&&(status.authToken=token,status.authError&&(status.authError=scErrors.hydrateError(status.authError))),callback(err,status)})}})},SCTransport.prototype._abortAllPendingEventsDueToBadConnection=function(failureType){for(var i in this._callbackMap)if(this._callbackMap.hasOwnProperty(i)){var eventObject=this._callbackMap[i];delete this._callbackMap[i],clearTimeout(eventObject.timeout),delete eventObject.timeout;var errorMessage="Event '"+eventObject.event+"' was aborted due to a bad connection",badConnectionError=new BadConnectionError(errorMessage,failureType),callback=eventObject.callback;delete eventObject.callback,callback.call(eventObject,badConnectionError,eventObject)}},SCTransport.prototype._onClose=function(code,data){delete this.socket.onopen,delete this.socket.onclose,delete this.socket.onmessage,delete this.socket.onerror,clearTimeout(this._connectTimeoutRef),clearTimeout(this._pingTimeoutTicker),clearTimeout(this._batchTimeout),this.state===this.OPEN?(this.state=this.CLOSED,Emitter.prototype.emit.call(this,"close",code,data),this._abortAllPendingEventsDueToBadConnection("disconnect")):this.state===this.CONNECTING&&(this.state=this.CLOSED,Emitter.prototype.emit.call(this,"openAbort",code,data),this._abortAllPendingEventsDueToBadConnection("connectAbort"))},SCTransport.prototype._handleEventObject=function(obj,message){if(obj&&null!=obj.event){var response=new Response(this,obj.cid);Emitter.prototype.emit.call(this,"event",obj.event,obj.data,response)}else if(obj&&null!=obj.rid){var eventObject=this._callbackMap[obj.rid];if(eventObject&&(clearTimeout(eventObject.timeout),delete eventObject.timeout,delete this._callbackMap[obj.rid],eventObject.callback)){var rehydratedError=scErrors.hydrateError(obj.error);eventObject.callback(rehydratedError,obj.data)}}else Emitter.prototype.emit.call(this,"event","raw",message)},SCTransport.prototype._onMessage=function(message){Emitter.prototype.emit.call(this,"event","message",message);var obj=this.decode(message);if("#1"===obj)this._resetPingTimeout(),this.socket.readyState===this.socket.OPEN&&this.sendObject("#2");else if(Array.isArray(obj))for(var len=obj.length,i=0;i<len;i++)this._handleEventObject(obj[i],message);else this._handleEventObject(obj,message)},SCTransport.prototype._onError=function(err){Emitter.prototype.emit.call(this,"error",err)},SCTransport.prototype._resetPingTimeout=function(){if(!this.pingTimeoutDisabled){var self=this;(new Date).getTime();clearTimeout(this._pingTimeoutTicker),this._pingTimeoutTicker=setTimeout(function(){self._onClose(4e3),self.socket.close(4e3)},this.pingTimeout)}},SCTransport.prototype.getBytesReceived=function(){return this.socket.bytesReceived},SCTransport.prototype.close=function(code,data){if(code=code||1e3,this.state===this.OPEN){var packet={code:code,data:data};this.emit("#disconnect",packet),this._onClose(code,data),this.socket.close(code)}else this.state===this.CONNECTING&&(this._onClose(code,data),this.socket.close(code))},SCTransport.prototype.emitObject=function(eventObject,options){var simpleEventObject={event:eventObject.event,data:eventObject.data};return eventObject.callback&&(simpleEventObject.cid=eventObject.cid=this.callIdGenerator(),this._callbackMap[eventObject.cid]=eventObject),this.sendObject(simpleEventObject,options),eventObject.cid||null},SCTransport.prototype._handleEventAckTimeout=function(eventObject){eventObject.cid&&delete this._callbackMap[eventObject.cid],delete eventObject.timeout;var callback=eventObject.callback;if(callback){delete eventObject.callback;var error=new TimeoutError("Event response for '"+eventObject.event+"' timed out");callback.call(eventObject,error,eventObject)}},SCTransport.prototype.emit=function(event,data,a,b){var callback,options,self=this;b?(options=a,callback=b):a instanceof Function?(options={},callback=a):options=a;var eventObject={event:event,data:data,callback:callback};callback&&!options.noTimeout&&(eventObject.timeout=setTimeout(function(){self._handleEventAckTimeout(eventObject)},this.options.ackTimeout));var cid=null;return(this.state===this.OPEN||options.force)&&(cid=this.emitObject(eventObject,options)),cid},SCTransport.prototype.cancelPendingResponse=function(cid){delete this._callbackMap[cid]},SCTransport.prototype.decode=function(message){return this.codec.decode(message)},SCTransport.prototype.encode=function(object){return this.codec.encode(object)},SCTransport.prototype.send=function(data){this.socket.readyState!==this.socket.OPEN?this._onClose(1005):this.socket.send(data)},SCTransport.prototype.serializeObject=function(object){var str,formatError;try{str=this.encode(object)}catch(err){formatError=err,this._onError(formatError)}return formatError?null:str},SCTransport.prototype.sendObjectBatch=function(object){var self=this;this._batchSendList.push(object),this._batchTimeout||(this._batchTimeout=setTimeout(function(){if(delete self._batchTimeout,self._batchSendList.length){var str=self.serializeObject(self._batchSendList);null!=str&&self.send(str),self._batchSendList=[]}},this.options.pubSubBatchDuration||0))},SCTransport.prototype.sendObjectSingle=function(object){var str=this.serializeObject(object);null!=str&&this.send(str)},SCTransport.prototype.sendObject=function(object,options){options&&options.batch?this.sendObjectBatch(object):this.sendObjectSingle(object)},module.exports.SCTransport=SCTransport}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./response":4,"component-emitter":12,querystring:18,"sc-errors":21,ws:7}],7:[function(_dereq_,module,exports){function ws(uri,protocols,opts){return protocols?new WebSocket(uri,protocols):new WebSocket(uri)}var global;global="undefined"!=typeof WorkerGlobalScope?self:"undefined"!=typeof window&&window||function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;WebSocket&&(ws.prototype=WebSocket.prototype),module.exports=WebSocket?ws:null},{}],8:[function(_dereq_,module,exports){(function(global){!function(root){var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var InvalidCharacterError=function(message){this.message=message};InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError";var error=function(message){throw new InvalidCharacterError(message)},TABLE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",REGEX_SPACE_CHARACTERS=/[\t\n\f\r ]/g,decode=function(input){input=String(input).replace(REGEX_SPACE_CHARACTERS,"");var length=input.length;length%4==0&&(input=input.replace(/==?$/,""),length=input.length),(length%4==1||/[^+a-zA-Z0-9/]/.test(input))&&error("Invalid character: the string to be decoded is not correctly encoded.");for(var bitStorage,buffer,bitCounter=0,output="",position=-1;++position<length;)buffer=TABLE.indexOf(input.charAt(position)),bitStorage=bitCounter%4?64*bitStorage+buffer:buffer,bitCounter++%4&&(output+=String.fromCharCode(255&bitStorage>>(-2*bitCounter&6)));return output},encode=function(input){input=String(input),/[^\0-\xFF]/.test(input)&&error("The string to be encoded contains characters outside of the Latin1 range.");for(var a,b,c,buffer,padding=input.length%3,output="",position=-1,length=input.length-padding;++position<length;)a=input.charCodeAt(position)<<16,b=input.charCodeAt(++position)<<8,c=input.charCodeAt(++position),buffer=a+b+c,output+=TABLE.charAt(buffer>>18&63)+TABLE.charAt(buffer>>12&63)+TABLE.charAt(buffer>>6&63)+TABLE.charAt(63&buffer);return 2==padding?(a=input.charCodeAt(position)<<8,b=input.charCodeAt(++position),buffer=a+b,output+=TABLE.charAt(buffer>>10)+TABLE.charAt(buffer>>4&63)+TABLE.charAt(buffer<<2&63)+"="):1==padding&&(buffer=input.charCodeAt(position),output+=TABLE.charAt(buffer>>2)+TABLE.charAt(buffer<<4&63)+"=="),output},base64={encode:encode,decode:decode,version:"0.1.0"};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return base64});else if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=base64;else for(var key in base64)base64.hasOwnProperty(key)&&(freeExports[key]=base64[key]);else root.base64=base64}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(_dereq_,module,exports){"use strict";function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function toByteArray(b64){for(var tmp,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(_byteLength(b64,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen,i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;return 2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp),1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));return 1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],10:[function(_dereq_,module,exports){"use strict";function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return fromString(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=fromObject(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromString(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),buf.__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}return void 0!==obj.length?"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj):"Buffer"===obj.type&&Array.isArray(obj.data)?fromArrayLike(obj.data):void 0}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,numberIsNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128==(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=str.split("=")[0],str=str.trim().replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!=0;)str+="=";return str}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g},{"base64-js":9,ieee754:13}],11:[function(_dereq_,module,exports){(function(Buffer){var clone=function(){"use strict";function _instanceof(obj,type){return null!=type&&obj instanceof type}function clone(parent,circular,depth,prototype,includeNonEnumerable){function _clone(parent,depth){if(null===parent)return null;if(0===depth)return parent;var child,proto;if("object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,nativePromise))child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})});else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=new Buffer(parent.length),parent.copy(child),child;_instanceof(parent,Error)?child=Object.create(parent):void 0===prototype?(proto=Object.getPrototypeOf(parent),child=Object.create(proto)):(child=Object.create(prototype),proto=prototype)}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent),allChildren.push(child)}_instanceof(parent,nativeMap)&&parent.forEach(function(value,key){var keyChild=_clone(key,depth-1),valueChild=_clone(value,depth-1);child.set(keyChild,valueChild)}),_instanceof(parent,nativeSet)&&parent.forEach(function(value){var entryChild=_clone(value,depth-1);child.add(entryChild)});for(var i in parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i)),attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols)for(var symbols=Object.getOwnPropertySymbols(parent),i=0;i<symbols.length;i++){var symbol=symbols[i],descriptor=Object.getOwnPropertyDescriptor(parent,symbol);(!descriptor||descriptor.enumerable||includeNonEnumerable)&&(child[symbol]=_clone(parent[symbol],depth-1),descriptor.enumerable||Object.defineProperty(child,symbol,{enumerable:!1}))}if(includeNonEnumerable)for(var allPropertyNames=Object.getOwnPropertyNames(parent),i=0;i<allPropertyNames.length;i++){var propertyName=allPropertyNames[i],descriptor=Object.getOwnPropertyDescriptor(parent,propertyName);descriptor&&descriptor.enumerable||(child[propertyName]=_clone(parent[propertyName],depth-1),Object.defineProperty(child,propertyName,{enumerable:!1}))}return child}"object"==typeof circular&&(depth=circular.depth,prototype=circular.prototype,includeNonEnumerable=circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer=void 0!==Buffer;return void 0===circular&&(circular=!0),void 0===depth&&(depth=1/0),_clone(parent,depth)}function __objToStr(o){return Object.prototype.toString.call(o)}function __isDate(o){return"object"==typeof o&&"[object Date]"===__objToStr(o)}function __isArray(o){return"object"==typeof o&&"[object Array]"===__objToStr(o)}function __isRegExp(o){return"object"==typeof o&&"[object RegExp]"===__objToStr(o)}function __getRegExpFlags(re){var flags="";return re.global&&(flags+="g"),re.ignoreCase&&(flags+="i"),re.multiline&&(flags+="m"),flags}var nativeMap;try{nativeMap=Map}catch(_){nativeMap=function(){}}var nativeSet;try{nativeSet=Set}catch(_){nativeSet=function(){}}var nativePromise;try{nativePromise=Promise}catch(_){nativePromise=function(){}}return clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};return c.prototype=parent,new c},clone.__objToStr=__objToStr,clone.__isDate=__isDate,clone.__isArray=__isArray,clone.__isRegExp=__isRegExp,clone.__getRegExpFlags=__getRegExpFlags,clone}();"object"==typeof module&&module.exports&&(module.exports=clone)}).call(this,_dereq_("buffer").Buffer)},{buffer:10}],12:[function(_dereq_,module,exports){function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}void 0!==module&&(module.exports=Emitter),Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var cb,i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],13:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],14:[function(_dereq_,module,exports){"use strict";function List(){if(arguments.length)return List.from(arguments)}function ListItem(){}var errorMessage;errorMessage="An argument without append, prepend, or detach methods was given to `List";var ListPrototype;ListPrototype=List.prototype,List.of=function(){return List.from.call(this,arguments)},List.from=function(items){var length,iterator,item,list=new this;if(items&&(length=items.length))for(iterator=-1;++iterator<length;)null!==(item=items[iterator])&&void 0!==item&&list.append(item);return list},ListPrototype.head=null,ListPrototype.tail=null,ListPrototype.toArray=function(){for(var item=this.head,result=[];item;)result.push(item),item=item.next;return result},ListPrototype.prepend=function(item){if(!item)return!1;if(!item.append||!item.prepend||!item.detach)throw new Error(errorMessage+"#prepend`.");var self,head;return self=this,(head=self.head)?head.prepend(item):(item.detach(),item.list=self,self.head=item,item)},ListPrototype.append=function(item){if(!item)return!1;if(!item.append||!item.prepend||!item.detach)throw new Error(errorMessage+"#append`.");var self,head,tail;return self=this,(tail=self.tail)?tail.append(item):(head=self.head)?head.append(item):(item.detach(),item.list=self,self.head=item,item)},List.Item=ListItem;var ListItemPrototype=ListItem.prototype;ListItemPrototype.next=null,ListItemPrototype.prev=null,ListItemPrototype.list=null,ListItemPrototype.detach=function(){var self=this,list=self.list,prev=self.prev,next=self.next;return list?(list.tail===self&&(list.tail=prev),list.head===self&&(list.head=next),list.tail===list.head&&(list.tail=null),prev&&(prev.next=next),next&&(next.prev=prev),self.prev=self.next=self.list=null,self):self},ListItemPrototype.prepend=function(item){if(!(item&&item.append&&item.prepend&&item.detach))throw new Error(errorMessage+"Item#prepend`.");var self=this,list=self.list,prev=self.prev;return!!list&&(item.detach(),prev&&(item.prev=prev,prev.next=item),item.next=self,item.list=list,self.prev=item,self===list.head&&(list.head=item),list.tail||(list.tail=self),item)},ListItemPrototype.append=function(item){if(!(item&&item.append&&item.prepend&&item.detach))throw new Error(errorMessage+"Item#append`.");var self=this,list=self.list,next=self.next;return!!list&&(item.detach(),next&&(item.next=next,next.prev=item),item.prev=self,item.list=list,self.next=item,self!==list.tail&&list.tail||(list.tail=item),item)},module.exports=List},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./_source/linked-list.js")},{"./_source/linked-list.js":14}],16:[function(_dereq_,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],17:[function(_dereq_,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],18:[function(_dereq_,module,exports){"use strict";exports.decode=exports.parse=_dereq_("./decode"),exports.encode=exports.stringify=_dereq_("./encode")},{"./decode":16,"./encode":17}],19:[function(_dereq_,module,exports){var Emitter=_dereq_("component-emitter"),SCChannel=function(name,client,options){Emitter.call(this),this.PENDING="pending",this.SUBSCRIBED="subscribed",this.UNSUBSCRIBED="unsubscribed",this.name=name,this.state=this.UNSUBSCRIBED,this.client=client,this.options=options||{},this.setOptions(this.options)};SCChannel.prototype=Object.create(Emitter.prototype),SCChannel.prototype.setOptions=function(options){options||(options={}),this.waitForAuth=options.waitForAuth||!1,this.batch=options.batch||!1,void 0!==options.data&&(this.data=options.data)},SCChannel.prototype.getState=function(){return this.state},SCChannel.prototype.subscribe=function(options){this.client.subscribe(this.name,options)},SCChannel.prototype.unsubscribe=function(){this.client.unsubscribe(this.name)},SCChannel.prototype.isSubscribed=function(includePending){return this.client.isSubscribed(this.name,includePending)},SCChannel.prototype.publish=function(data,callback){this.client.publish(this.name,data,callback)},SCChannel.prototype.watch=function(handler){this.client.watch(this.name,handler)},SCChannel.prototype.unwatch=function(handler){this.client.unwatch(this.name,handler)},SCChannel.prototype.watchers=function(){return this.client.watchers(this.name)},SCChannel.prototype.destroy=function(){this.client.destroyChannel(this.name)},module.exports.SCChannel=SCChannel},{"component-emitter":12}],20:[function(_dereq_,module,exports){module.exports=function(object){var objects=[],paths=[];return function derez(value,path){var i,name,nu;if(!("object"!=typeof value||null===value||value instanceof Boolean||value instanceof Date||value instanceof Number||value instanceof RegExp||value instanceof String)){for(i=0;i<objects.length;i+=1)if(objects[i]===value)return{$ref:paths[i]};if(objects.push(value),paths.push(path),"[object Array]"===Object.prototype.toString.apply(value))for(nu=[],i=0;i<value.length;i+=1)nu[i]=derez(value[i],path+"["+i+"]");else{nu={};for(name in value)Object.prototype.hasOwnProperty.call(value,name)&&(nu[name]=derez(value[name],path+"["+JSON.stringify(name)+"]"))}return nu}return value}(object,"$")}},{}],21:[function(_dereq_,module,exports){function AuthTokenExpiredError(message,expiry){this.name="AuthTokenExpiredError",this.message=message,this.expiry=expiry,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenInvalidError(message){this.name="AuthTokenInvalidError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenNotBeforeError(message,date){this.name="AuthTokenNotBeforeError",this.message=message,this.date=date,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function AuthTokenError(message){this.name="AuthTokenError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function SilentMiddlewareBlockedError(message,type){this.name="SilentMiddlewareBlockedError",this.message=message,this.type=type,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidActionError(message){this.name="InvalidActionError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidArgumentsError(message){this.name="InvalidArgumentsError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidOptionsError(message){this.name="InvalidOptionsError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function InvalidMessageError(message){this.name="InvalidMessageError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function SocketProtocolError(message,code){this.name="SocketProtocolError",this.message=message,this.code=code,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ServerProtocolError(message){this.name="ServerProtocolError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function HTTPServerError(message){this.name="HTTPServerError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ResourceLimitError(message){this.name="ResourceLimitError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function TimeoutError(message){this.name="TimeoutError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function BadConnectionError(message,type){this.name="BadConnectionError",this.message=message,this.type=type,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function BrokerError(message){this.name="BrokerError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function ProcessExitError(message,code){this.name="ProcessExitError",this.message=message,this.code=code,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}function UnknownError(message){this.name="UnknownError",this.message=message,Error.captureStackTrace&&!isStrict?Error.captureStackTrace(this,arguments.callee):this.stack=(new Error).stack}var decycle=_dereq_("./decycle"),isStrict=function(){return!this}();AuthTokenExpiredError.prototype=Object.create(Error.prototype),AuthTokenInvalidError.prototype=Object.create(Error.prototype),AuthTokenNotBeforeError.prototype=Object.create(Error.prototype),AuthTokenError.prototype=Object.create(Error.prototype),SilentMiddlewareBlockedError.prototype=Object.create(Error.prototype),InvalidActionError.prototype=Object.create(Error.prototype),InvalidArgumentsError.prototype=Object.create(Error.prototype),InvalidOptionsError.prototype=Object.create(Error.prototype),InvalidMessageError.prototype=Object.create(Error.prototype),SocketProtocolError.prototype=Object.create(Error.prototype),ServerProtocolError.prototype=Object.create(Error.prototype),HTTPServerError.prototype=Object.create(Error.prototype),ResourceLimitError.prototype=Object.create(Error.prototype),TimeoutError.prototype=Object.create(Error.prototype),BadConnectionError.prototype=Object.create(Error.prototype),BrokerError.prototype=Object.create(Error.prototype),ProcessExitError.prototype=Object.create(Error.prototype),UnknownError.prototype=Object.create(Error.prototype),module.exports={AuthTokenExpiredError:AuthTokenExpiredError,AuthTokenInvalidError:AuthTokenInvalidError,AuthTokenNotBeforeError:AuthTokenNotBeforeError,AuthTokenError:AuthTokenError,SilentMiddlewareBlockedError:SilentMiddlewareBlockedError,InvalidActionError:InvalidActionError,InvalidArgumentsError:InvalidArgumentsError,InvalidOptionsError:InvalidOptionsError,InvalidMessageError:InvalidMessageError,SocketProtocolError:SocketProtocolError,ServerProtocolError:ServerProtocolError,HTTPServerError:HTTPServerError,ResourceLimitError:ResourceLimitError,TimeoutError:TimeoutError,BadConnectionError:BadConnectionError,BrokerError:BrokerError,ProcessExitError:ProcessExitError,UnknownError:UnknownError},module.exports.socketProtocolErrorStatuses={1001:"Socket was disconnected",1002:"A WebSocket protocol error was encountered",1003:"Server terminated socket because it received invalid data",1005:"Socket closed without status code",1006:"Socket hung up",1007:"Message format was incorrect",1008:"Encountered a policy violation",1009:"Message was too big to process",1010:"Client ended the connection because the server did not comply with extension requirements",1011:"Server encountered an unexpected fatal condition",4e3:"Server ping timed out",4001:"Client pong timed out",4002:"Server failed to sign auth token",4003:"Failed to complete handshake",4004:"Client failed to save auth token",4005:"Did not receive #handshake from client before timeout",4006:"Failed to bind socket to message broker",4007:"Client connection establishment timed out",4008:"Server rejected handshake from client"},module.exports.socketProtocolIgnoreStatuses={1e3:"Socket closed normally",1001:"Socket hung up"};var unserializableErrorProperties={domain:1,domainEmitter:1,domainThrown:1};module.exports.dehydrateError=function(error,includeStackTrace){var dehydratedError;if(error&&"object"==typeof error){dehydratedError={message:error.message},includeStackTrace&&(dehydratedError.stack=error.stack);for(var i in error)unserializableErrorProperties[i]||(dehydratedError[i]=error[i])}else dehydratedError="function"==typeof error?"[function "+(error.name||"anonymous")+"]":error;return decycle(dehydratedError)},module.exports.hydrateError=function(error){var hydratedError=null;if(null!=error)if("object"==typeof error){hydratedError=new Error(error.message);for(var i in error)error.hasOwnProperty(i)&&(hydratedError[i]=error[i])}else hydratedError=error;return hydratedError},module.exports.decycle=decycle},{"./decycle":20}],22:[function(_dereq_,module,exports){(function(global){var base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",validJSONStartRegex=/^[ \n\r\t]*[{\[]/,arrayBufferToBase64=function(arraybuffer){for(var bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="",i=0;i<len;i+=3)base64+=base64Chars[bytes[i]>>2],base64+=base64Chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=base64Chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=base64Chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},binaryToBase64Replacer=function(key,value){if(global.ArrayBuffer&&value instanceof global.ArrayBuffer)return{base64:!0,data:arrayBufferToBase64(value)};if(global.Buffer){if(value instanceof global.Buffer)return{base64:!0,data:value.toString("base64")};if(value&&"Buffer"===value.type&&Array.isArray(value.data)){var rehydratedBuffer;return rehydratedBuffer=global.Buffer.from?global.Buffer.from(value.data):new global.Buffer(value.data),{base64:!0,data:rehydratedBuffer.toString("base64")}}}return value};module.exports.decode=function(input){if(null==input)return null;if("#1"===input||"#2"===input)return input;var message=input.toString();if(!validJSONStartRegex.test(message))return message;try{return JSON.parse(message)}catch(err){}return message},module.exports.encode=function(object){return"#1"===object||"#2"===object?object:JSON.stringify(object,binaryToBase64Replacer)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(_dereq_,module,exports){var v1=_dereq_("./v1"),v4=_dereq_("./v4"),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid},{"./v1":26,"./v4":27}],24:[function(_dereq_,module,exports){function bytesToUuid(buf,offset){var i=offset||0,bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=bytesToUuid},{}],25:[function(_dereq_,module,exports){var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);module.exports=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>((3&i)<<3)&255;return rnds}}},{}],26:[function(_dereq_,module,exports){function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var node=options.node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=rng();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid(b)}var _nodeId,_clockseq,rng=_dereq_("./lib/rng"),bytesToUuid=_dereq_("./lib/bytesToUuid"),_lastMSecs=0,_lastNSecs=0;module.exports=v1},{"./lib/bytesToUuid":24,"./lib/rng":25}],27:[function(_dereq_,module,exports){function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid(rnds)}var rng=_dereq_("./lib/rng"),bytesToUuid=_dereq_("./lib/bytesToUuid");module.exports=v4},{"./lib/bytesToUuid":24,"./lib/rng":25}]},{},[1])(1)});var CloudIM={version:"2.0.20",host:"cloudim.ru",mobile_jid:"m.cloudim.chat",host_ws:"cloudim.chat",host_jid:"client.cloudim.chat",uid:null,group:{id:0,label:"general"},init_time:null,visit_timeout:864e5,triggers:null,offline_mode:!1,is_ready:!1,domain:null,url:null,ip:null,geo:{city:null,country:null,country_code:null,lat:null,lon:null},referer:null,page:null,search:{engine:null,query:null},user_stat:{viewed_pages:0,last_page:null,total_time:0,last_visit:0},returned_visitor:!1,user:null,user_data:null,managers:[],manager:null,connection:null,reconnect_count:0,max_reconnect_count:3,showed:!1,status:{code:null,text:null},first_message:!1,options:{needName:null,needEmail:null,accept_chats:null},storage:null,storage_engines:["local","session","ie","html5","flash"],storage_active:!1,addon_user_params:null,last_time:null,history:null,now_message_counter:0,has_rate:1,last_message:null,socket:null,channel:null,socket_connect_timeout:null,updateTimeInterval:null,offlineManager:null,socketExpireTimeout:null,socketExpireTime:9e5,socketSessionExpired:!1,init:function(){CloudIM.init_time=CloudIM.last_time=(new Date).getTime(),CloudIM.sendWindowMessage("callPreInitEvent");var hidden,state,visibilityChange;void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange",state="visibilityState"):void 0!==document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange",state="mozVisibilityState"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange",state="msVisibilityState"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange",state="webkitVisibilityState"),document.addEventListener(visibilityChange,function(){document[state]===hidden?CloudIM.pause():CloudIM.resume()},!1)},initFinish:function(){CloudIM.init_time-CloudIM.user_stat.last_visit>CloudIM.visit_timeout&&CloudIM.user_stat.last_visit>0&&(CloudIM.returned_visitor=!0),CloudIM.url!=CloudIM.user_stat.last_page&&(CloudIM.user_stat.viewed_pages=1*CloudIM.user_stat.viewed_pages+1),CloudIM.setStorage(),CloudIM.onlineManagers(CloudIM.connect);var chatParams={tabColor:$(".im_title").css("background-image")&&"none"!=$(".im_title").css("background-image")?$(".im_title").css("background-image"):$(".im_title").css("background-color"),tabText:$(".im_head_title").text().replace(/^\s+/,"").replace(/\s+$/,""),tabOfflineText:$(".im_head_offline_title").text().replace(/^\s+/,"").replace(/\s+$/,"")};if(CloudIM.sendWindowMessage("callInitEvent",chatParams),!$.jStore.get(CloudIM.getStorageNameSpace()+"_ver")){$.jStore.remove(CloudIM.getStorageNameSpace()+"_jrid"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_jsid");var cloudim_user;(cloudim_user=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user"))&&$.jStore.remove(cloudim_user)}$.jStore.set(CloudIM.getStorageNameSpace()+"_ver",CloudIM.version)},saveVisitorStat:function(){var session_cookie="",visit_cookie="";CloudIM.user_stat.last_page=CloudIM.url;var session={v:CloudIM.user_stat.viewed_pages,p:CloudIM.user_stat.last_page,t:CloudIM.user_stat.total_time},visit={l:CloudIM.user_stat.last_visit};for(var k in session)session_cookie+=k+"="+encodeURIComponent(session[k])+"|";session_cookie=session_cookie.substr(0,session_cookie.length-1);for(var k in visit)visit_cookie+=k+"="+encodeURIComponent(visit[k])+"|";visit_cookie=visit_cookie.substr(0,visit_cookie.length-1),CloudIM.sendWindowMessage("saveChatSession",{session:session_cookie,visit:visit_cookie})},unloadChat:function(){null!==CloudIM.updateTimeInterval&&(clearInterval(CloudIM.updateTimeInterval),CloudIM.updateTimeInterval=null),CloudIM.calcTotalTime();var unload_time=(new Date).getTime();CloudIM.user_stat.last_visit=unload_time,CloudIM.saveVisitorStat(),CloudIM.socket&&CloudIM.channel&&CloudIM.socket.emit("client.logout",null,function(err){err&&CloudIM.log("client.logout err",err)}),null!==CloudIM.status.code&&CloudIM.removeTab(CloudIM.status.code.id)},removeTab:function(tab_id){var tabs=$.jStore.get(CloudIM.getStorageNameSpace()+"_tabs");if($.isArray(tabs)&&tabs.length>0){var remove_tab=tabs.indexOf(tab_id);if(-1!==remove_tab)return tabs.splice(remove_tab,1),$.jStore.set(CloudIM.getStorageNameSpace()+"_tabs",$.toJSON(tabs)),tabs}return[]},connect:function(){if(CloudIM.log("Call: connect"),CloudIM.storage_active){CloudIM.log("CloudIM.storage_active"),CloudIM.user=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user"),CloudIM.log("CloudIM.user from storage "+CloudIM.user);var now=(new Date).getTime(),session_time=Math.round((now-CloudIM.user_stat.last_visit)/1e3);CloudIM.log("last_visit: "+CloudIM.user_stat.last_visit),CloudIM.log("session_time: "+session_time),session_time>3600&&(CloudIM.log("Visit session is expired"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_manager"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_showed")),session_time>259200&&(CloudIM.log("Invite session is expired"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_call_triggers"))}if(CloudIM.user){var server_index=CloudIM.getServerIndex(CloudIM.user);CloudIM.host_jid!==server_index&&(CloudIM.log("Invalid SERVER index: "+server_index),CloudIM.log("CloudIM.user generate"),CloudIM.user=CloudIM.unicJID(),$.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_user",CloudIM.user))}else CloudIM.log("CloudIM.user generate"),CloudIM.log("Clear sid and rid"),CloudIM.user=CloudIM.unicJID(),$.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_user",CloudIM.user);CloudIM.socketSessionExpired=!1,CloudIM.socket=socketCluster.create({hostname:CloudIM.host_ws,secure:!0,port:443,autoConnect:!1,authTokenName:CloudIM.getStorageNameSpace()+"_token"}),CloudIM.socket.off("connect").on("connect",function(status){!0===status.isAuthenticated?(CloudIM.log("ON CONNECT SOCKET"),CloudIM.onConnect(status)):(CloudIM.log("client.login",CloudIM.managers,CloudIM.manager),CloudIM.socket.emit("client.login",{login:CloudIM.user,operators:CloudIM.managers},function(err){err?CloudIM.log("client.login err",err):(status.isAuthenticated=!0,CloudIM.onConnect(status))}))}),CloudIM.socket.off("error").on("error",function(err){CloudIM.log("socket error",err),null!==CloudIM.socket_connect_timeout&&(clearTimeout(CloudIM.socket_connect_timeout),CloudIM.socket_connect_timeout=null),CloudIM.channel&&(CloudIM.channel.destroy(),CloudIM.channel=null),CloudIM.socket&&(CloudIM.socket.destroy(),CloudIM.socket=null),CloudIM.socket_connect_timeout=setTimeout(CloudIM.connect,5e3+Math.round(7e3*Math.random())),null!==CloudIM.status.code&&CloudIM.removeTab(CloudIM.status.code.id)}),CloudIM.socket.off("deauthenticate").on("deauthenticate",function(err){CloudIM.socket&&(CloudIM.socket.disconnect(),CloudIM.socket.connect())}),CloudIM.socket.off("disconnect").on("disconnect",function(err){}),CloudIM.socket.connect()},pause:function(){CloudIM.log("PAUSE"),null!==CloudIM.socketExpireTimeout&&(clearTimeout(CloudIM.socketExpireTimeout),CloudIM.socketExpireTimeout=null),CloudIM.socketExpireTimeout=setTimeout(function(){CloudIM.socket&&CloudIM.socket.disconnect(),CloudIM.socketExpireTimeout=null,CloudIM.socketSessionExpired=!0},CloudIM.socketExpireTime)},resume:function(){CloudIM.log("RESUME"),null!==CloudIM.socketExpireTimeout&&(clearTimeout(CloudIM.socketExpireTimeout),CloudIM.socketExpireTimeout=null),CloudIM.socketSessionExpired&&CloudIM.connect()},attach_connection:function(data){CloudIM.log("attach_connection")},normal_connect:function(){CloudIM.log("User normal connect: "+CloudIM.user)},supportCors:function(){var cors=!1;return $.browser.webkit&&parseInt($.browser.version)>400&&(cors=!0),$.browser.opera&&parseInt($.browser.version)>=12&&(cors=!0),$.browser.mozilla&&parseInt($.browser.version)>=4&&(cors=!0),cors},sendMessage:function(message,silent){if(CloudIM.log("sendMessage",message,silent),null===CloudIM.channel)return!1;if(silent&&(message="*** cloudim-bot ***\r\n"+message),CloudIM.manager&&CloudIM.manager.jid){var message_id=CloudIM.user.split("@")[0]+"-"+Math.round(1e6*Math.random()),message_data={event:"xmpp.client.message",to:CloudIM.manager.jid+(CloudIM.manager.resource?"/"+CloudIM.manager.resource:""),id:message_id,message:message};CloudIM.channel.publish(message_data,function(err,data){err&&CloudIM.log("ERROR",err)}),CloudIM.last_message={id:message_id,time:(new Date).getTime(),message:message},CloudIM.log(CloudIM.last_message)}else CloudIM.log("before sendInvitesToChat: "+message),CloudIM.sendInvitesToChat(message);return silent||(sendToActionScript("outgoing"),CloudIM.messageInChat(message,"out")),!0},setStorage:function(){$.extend(jQuery.jStore.defaults,{flash:"/js/jstore/jStore.Flash.html"});for(var i=0;i<CloudIM.storage_engines.length;i++)try{$.jStore.use(CloudIM.storage_engines[i]),CloudIM.storage=CloudIM.storage_engines[i];break}catch(e){}return $.jStore.ready(function(engine){"flash"==CloudIM.storage?$.jStore.flashReady(function(){engine.ready(function(){CloudIM.log(engine.jri+" is ready for get/set/rem calls!"),CloudIM.storage_active=!0})}):(CloudIM.log(engine.jri+" is ready for get/set/rem calls!"),CloudIM.storage_active=!0,CloudIM.loadHistory())}),!0},reConnect:function(){CloudIM.connection&&CloudIM.connection.reset(),$.jStore.remove(CloudIM.getStorageNameSpace()+"_jrid"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_jsid"),setTimeout(function(){CloudIM.reconnect_count<CloudIM.max_reconnect_count?(CloudIM.log("reConnect status "+CloudIM.status.text),CloudIM.log("reConnect count "+CloudIM.reconnect_count),CloudIM.reconnect_count++,CloudIM.connect()):CloudIM.log("reConnect refused")},1500)},onConnect:function(status){CloudIM.log("onConnect",status);var last_status=CloudIM.status.code;CloudIM.status.code=status,CloudIM.status.text="Онлайн",CloudIM.log("STATUS: "+CloudIM.status.text),CloudIM.log("MANAGER: "+CloudIM.manager),CloudIM.channel=CloudIM.socket.subscribe(CloudIM.user,{waitForAuth:!0}),CloudIM.channel.off("subscribeFail").on("subscribeFail",function(err,channelName){CloudIM.log("subscribeFail",err,channelName)}),CloudIM.channel.off("subscribe").on("subscribe",function(channelName){CloudIM.log("subscribe",channelName)}),CloudIM.channel.unwatch(CloudIM.onMessage),CloudIM.channel.watch(CloudIM.onMessage),CloudIM.manager&&CloudIM.manager.jid?CloudIM.addToRoster([CloudIM.manager]):CloudIM.managers.length>0&&CloudIM.addToRoster(CloudIM.managers),CloudIM.setStatus(""),$("#im_offline_form").is(":visible")&&CloudIM.is_ready&&$("#im_panel").show(),$("#im_client").slideDown(200,CloudIM.historyScrollDown),$("#im_connect_status").hide(),$("#im_offline_form").hide(),$("#goingOffline").hide(),(CloudIM.options.needName&&!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")||CloudIM.options.needEmail&&!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email"))&&(CloudIM.options.needName||$("#im_user_profile_form .im_user_name").hide(),CloudIM.options.needEmail||$("#im_user_profile_form .im_user_email").hide(),$("#im_user_profile_save").bind("submit",CloudIM.saveUserProfile),$("#im_user_profile_form").show()),CloudIM.sendWindowMessage("callOnlineEvent"),"1"!=$.jStore.get(CloudIM.getStorageNameSpace()+"_showed")&&CloudIM.triggers.length>0&&CloudIM.checkTriggerTimer(),CloudIM.manager&&CloudIM.manager.jid&&$.post("/api/rate.php",{action:"get",jid:CloudIM.manager.jid,visitor:CloudIM.user},function(resp){CloudIM.has_rate=resp.has_rate,CloudIM.checkRateBlock()},"json"),$("#im_connect_status").text(CloudIM.status.text);var tabs=$.jStore.get(CloudIM.getStorageNameSpace()+"_tabs");if(tabs){null!==last_status&&(tabs=CloudIM.removeTab(last_status.id));var tab_limit=10;tabs.length>tab_limit&&tabs.splice(0,tabs.length-tab_limit)}else tabs=[];tabs.push(status.id),$.jStore.set(CloudIM.getStorageNameSpace()+"_tabs",$.toJSON(tabs)),null===CloudIM.updateTimeInterval&&(CloudIM.updateTimeInterval=setInterval(function(){CloudIM.updateTotalTime()},6e4))},preMessageInformer:function(message){CloudIM.log("preMessageInformer: "+message),null!==CloudIM.channel&&CloudIM.manager&&CloudIM.isCloudimClient()&&CloudIM.channel.publish({event:"xmpp.client.premessage",message:message,to:CloudIM.manager.jid+(CloudIM.manager.resource?"/"+CloudIM.manager.resource:"")},function(err,data){err&&CloudIM.log("xmpp.client.premessage ERROR",err)})},sendInvitesToChat:function(message){null!==CloudIM.channel&&CloudIM.channel.publish({event:"xmpp.client.invite",message:message},function(err,data){err&&CloudIM.log("xmpp.client.invite ERROR",err)})},sendDialogAcceptedEvent:function(acceptManager){if(null!==CloudIM.channel){for(var i=0,toi=CloudIM.managers.length;i<toi;i++){var accepted_data={event:"xmpp.client.chat.accept.info",to:CloudIM.managers[i].jid+"/"+CloudIM.managers[i].resource,jid:acceptManager.jid,name:acceptManager.name};CloudIM.channel.publish(accepted_data,function(err,data){err&&CloudIM.log("xmpp.client.chat.accept.info ERROR",err)})}CloudIM.setStatus("")}},getActiveTrigger:function(){if(!CloudIM.triggers||0==CloudIM.triggers.length)return!1;var trigger=condition=null,active_trigger=!1,called=[],count_conditions=0;CloudIM.storage_active&&(called=$.jStore.get(CloudIM.getStorageNameSpace()+"_call_triggers"));for(var i=0,toi=CloudIM.triggers.length;i<toi;i++){trigger=CloudIM.triggers[i],count_conditions=0;for(var k=0,tok=trigger.trigger.length;k<tok;k++){switch(condition=trigger.trigger[k],active_trigger=!1,condition.param){case"url":active_trigger=CloudIM.checkCondition(CloudIM.url,condition);break;case"referer":active_trigger=CloudIM.checkCondition(CloudIM.referer,condition);break;case"total_time":var current_time=(new Date).getTime(),total_time=1*CloudIM.user_stat.total_time+Math.round((current_time-CloudIM.init_time)/1e3);active_trigger=CloudIM.checkCondition(total_time,condition);break;case"page_time":var cur_time=(new Date).getTime(),page_time=Math.round((cur_time-CloudIM.init_time)/1e3);active_trigger=CloudIM.checkCondition(page_time,condition);break;case"vivewed_pages":active_trigger=CloudIM.checkCondition(CloudIM.user_stat.viewed_pages,condition);break;case"returned_visitor":CloudIM.returned_visitor&&(active_trigger=!0);break;case"geo":var geo_location=(CloudIM.geo.city?CloudIM.geo.city:"")+(CloudIM.geo.country?" "+CloudIM.geo.country:"");active_trigger=CloudIM.checkCondition(geo_location,condition);break;case"search_query":CloudIM.search.query&&(active_trigger=CloudIM.checkCondition(CloudIM.search.query,condition))}if(active_trigger&&(!(called instanceof Array)||-1==called.indexOf(trigger.id_trigger+""))&&"or"==trigger.condition_type)return trigger;active_trigger&&count_conditions++}if(!("and"!=trigger.condition_type||count_conditions!=trigger.trigger.length||called instanceof Array&&-1!=called.indexOf(trigger.id_trigger+"")))return trigger}return!1},checkTriggerTimer:function(){var trigger=CloudIM.getActiveTrigger();trigger?CloudIM.callTrigger(trigger):setTimeout(CloudIM.checkTriggerTimer,1e3)},callTrigger:function(trigger){var message=trigger.invite_text;if(CloudIM.storage_active){var called=$.jStore.get(CloudIM.getStorageNameSpace()+"_call_triggers");called instanceof Array||(called=[]),called.push(trigger.id_trigger),$.jStore.set(CloudIM.getStorageNameSpace()+"_call_triggers",$.toJSON(called))}CloudIM.messageInChat(message,"in");var manager_name=CloudIM.manager&&CloudIM.manager.name?CloudIM.manager.name:"Оператор";CloudIM.sendWindowMessage("callMessageEvent",{from:manager_name,message:message}),CloudIM.manager&&CloudIM.isCloudimClient()},checkCondition:function(param,condition){switch(condition.condition){case"%":return param.toLowerCase().indexOf(condition.value.toLowerCase())>=0;case"!%":return!(param.toLowerCase().indexOf(condition.value.toLowerCase())>=0);case">=":return param>=condition.value;case"==":return param==condition.value;case"==":return param!=condition.value}return!1},showOfflineTab:function(){CloudIM.initOfflineForm(),CloudIM.sendWindowMessage("showPanel")},initOfflineForm:function(){return!$("#im_offline_form").data("is_init")&&(CloudIM.connection&&(CloudIM.reconnect_count=CloudIM.max_reconnect_count,CloudIM.connection.disconnect(),CloudIM.manager=null),$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")&&$("#offline_name").val($.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")),$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email")&&$("#offline_email").val($.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email")),$('#im_offline_form *[id^="offline_"]').bind("keydown",function(){$(this).removeClass("error")}),$(".im_head_title").data("online-header")||$(".im_head_title").data("online-header",$(".im_head_title").text()),$(".im_head_title").text($(".im_head_offline_title").text()),$('#im_offline_form input[type="submit"]').bind("click",function(){for(var fields=["email","message"],request={},val="",has_error=!1,i=0,toi=fields.length;i<toi;i++)$("#offline_"+fields[i]).removeClass("error");for(var i=0,toi=fields.length;i<toi;i++)val=$.trim($("#offline_"+fields[i]).val()),""==val?($("#offline_"+fields[i]).addClass("error"),has_error=!0):request[fields[i]]=val;return has_error||(request.uid=CloudIM.uid,CloudIM.group.id>0&&(request.gid=CloudIM.group.id),request.url=CloudIM.url,request.ip=CloudIM.ip,request.referer=CloudIM.referer,$.post("/im/email.php",request,function(responce){"capcha"==responce.code||("email"==responce.code?$("#offline_email").addClass("error"):"empty"==responce.code?$('#im_offline_form *[id^="offline_"]').addClass("error"):($("#im_offline_form .im_offline").html('<div class="success"><b>Сообщение отправлено. Спасибо!</b></div>'),setTimeout(function(){CloudIM.removeChat()},3e3)))},"json")),!1}),$("#im_offline_form").data("is_init",1),!0)},addToRoster:function(operators){if(CloudIM.log("addToRoster"),CloudIM.socket&&CloudIM.channel){for(var operators_jid=[],i=0,toi=operators.length;i<toi;i++)operators_jid[i]=operators[i].jid;CloudIM.socket.emit("client.set.data",{type:"operators",data:operators_jid},function(err){err&&CloudIM.log("client.set.data err",err)})}},authorizeContact:function(jid){CloudIM.channel.publish({event:"xmpp.client.subscribe",to:jid},function(err,data){err&&CloudIM.log("xmpp.client.subscribe ERROR",err)})},setStatus:function(status){CloudIM.log("setStatus: "+status);var status_data={event:"xmpp.client.presence",show:status,text:CloudIM.getUserStatusText(),data:CloudIM.getUserStatusData()};CloudIM.channel.publish(status_data,function(err,data){err&&CloudIM.log("xmpp.client.presence ERROR",err)})},getUserStatusText:function(){CloudIM.log("getUserStatusText");var status_text="";if(CloudIM.manager&&CloudIM.manager.resource&&CloudIM.manager.resource,CloudIM.isOldCloudimClient())status_text="json:"+$.toJSON(CloudIM.getUserStatusData());else if(status_text="Сейчас на странице: "+CloudIM.page+" ("+CloudIM.url+")",status_text+="\r\n | Время на сайте: "+CloudIM.user_stat.total_time+"cек.",status_text+="\r\n | Просмотрено страниц: "+CloudIM.user_stat.viewed_pages,CloudIM.geo.country&&(status_text+="\r\n | Местоположение: "+(CloudIM.geo.city?CloudIM.geo.city:"")+(CloudIM.geo.country?", "+CloudIM.geo.country:"")),status_text+=(CloudIM.search.query?"\r\n | Поисковой запрос "+CloudIM.search.engine+': "'+CloudIM.search.query+'"':"")+(CloudIM.referer?"\r\n | Referer: "+CloudIM.referer:"")+"\r\n | IP: "+CloudIM.ip,status_text+=($.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email")?"\r\n | Email: "+$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email"):"")+($.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")?"\r\n | Имя: "+$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name"):""),CloudIM.user_data)for(var i in CloudIM.user_data)status_text+="\r\n | "+CloudIM.user_data[i].name+": "+CloudIM.user_data[i].value;return status_text},getUserStatusData:function(){var uaParser=new UAParser,status_obj={url:CloudIM.url,referer:CloudIM.referer,page:CloudIM.page,ip:CloudIM.ip,total_time:CloudIM.user_stat.total_time,viewed_pages:CloudIM.user_stat.viewed_pages,browser:uaParser.getBrowser(),os:uaParser.getOS(),geo:{city:CloudIM.geo.city?CloudIM.geo.city:null,region:null,country_code:CloudIM.geo.country_code?CloudIM.geo.country_code:null,country:CloudIM.geo.country?CloudIM.geo.country:null,lat:CloudIM.geo.lat?CloudIM.geo.lat:null,lon:CloudIM.geo.lon?CloudIM.geo.lon:null},search:{query:CloudIM.search.query,engine:CloudIM.search.engine},user:{name:$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name"),email:$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email"),user_data:CloudIM.user_data}};return(CloudIM.manager||!0===CloudIM.options.accept_chats)&&(status_obj.accepted=!!CloudIM.manager&&CloudIM.manager),{type:"user",data:status_obj}},setUserVCard:function(fname,nick,email){if(fname=fname||"",nick=nick||"",email=email||"",CloudIM.channel){var vcard_data={event:"xmpp.client.vcard",name:fname,email:email,nickname:nick};CloudIM.channel.publish(vcard_data,function(err,data){err&&CloudIM.log("xmpp.client.vcard ERROR",err)})}},sendUserVCard:function(){var name=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name"),email=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email");if(name||email){var message="Посетитесь ввел данные: \r\n";name&&(message+="Имя: "+name+" \r\n"),email&&(message+="Email: "+email+" \r\n"),CloudIM.sendMessage(message,!0)}},saveUserProfile:function(){var name=nick=$("#user_name").val(),email=$("#user_email").val();return name&&"test"!=name&&$.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_user_name",name),email&&"test"!=email&&$.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_user_email",email),CloudIM.setUserVCard(name,nick,email),CloudIM.setStatus(""),CloudIM.sendUserVCard(),$("#im_user_profile_form").hide(),!1},messageInChat:function(message,type,param,silent){var from=null;"out"==type?from="Я":"in"==type?(from=CloudIM.manager&&CloudIM.manager.name?CloudIM.manager.name:"Оператор",CloudIM.showed||($(".im_welcome .im_vcard_fullname").text(from),$(".im_welcome .im_welcome_text").text(message),CloudIM.sendWindowMessage("showWelcome"),$(".im_welcome").slideDown("fast",function(){$(".im_welcome").fadeOut("fast",function(){$(".im_welcome").fadeIn("fast")})})),silent||sendToActionScript("incoming")):"error"==type?from="Ошибка":"sys"==type?from="Системное сообщение":"info"==type&&(from="Информация");var time=new Date;time=time.getTime(),CloudIM.appendMessageInChat(from,message,type,time,param),"info"!=type&&CloudIM.saveHistory(from,message,type,time),CloudIM.historyScrollDown()},appendMessageInChat:function(from,message,type,time,param){var cur_date=new Date,set_date=new Date(time),is_last="";cur_date-set_date>36e5?is_last=" im_last":CloudIM.now_message_counter++,$("#im_chat").append('<div class="im_'+type+is_last+'"><div class="im_author">'+from+'</div><div class="im_time">'+CloudIM.dateFormat(time)+'</div><div class="im_message">'+CloudIM.insertLinks(CloudIM.htmlescape(message))+"</div>"+("info"==type&&param?'<a href="http://'+CloudIM.domain+"/"+param+'" target="_blank">Открыть страницу в новом окне</a>':"")+"</div>"),CloudIM.checkRateBlock()},insertLinks:function(text){var regExp=/((ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+=&;%\$#_]*)?)/gi;return text.replace(regExp,'<a href="$&" target="_blank">$&</a>')},dateFormat:function(time){if(time){var d,m,h,cur_date=new Date,set_date=new Date(time),i="";return d=set_date.getDate().toString(),m=set_date.getMonth().toString(),h=set_date.getHours().toString(),i=set_date.getMinutes().toString(),d=d.length<2?"0"+d:d,m=m.length<2?"0"+m:m,h=h.length<2?"0"+h:h,i=i.length<2?"0"+i:i,cur_date.getDate().toString()+cur_date.getMonth().toString()+cur_date.getFullYear().toString()!=set_date.getDate().toString()+set_date.getMonth().toString()+set_date.getFullYear().toString()?d+"."+m+" в "+h+":"+i:h+":"+i}return""},htmlescape:function(text){return"string"==typeof text?text.replace(new RegExp("['\"<>&]","g"),function(s){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#039;"}[s]}):""},historyScrollDown:function(){$("#im_chat").scrollTop(400*$("#im_chat > div").size())},loadHistory:function(){try{CloudIM.history=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_history")}catch(e){CloudIM.history=[],$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_history")}if(null!=CloudIM.history&&CloudIM.history instanceof Object){for(var i=0,toi=CloudIM.history.length;i<toi;i++)CloudIM.appendMessageInChat(CloudIM.history[i].from,CloudIM.history[i].message,CloudIM.history[i].type,CloudIM.history[i].time);$("#im_chat").append('<div class="im_last_delimer"></div>')}else CloudIM.history=[],$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_history")},saveHistory:function(from,message,type,time){CloudIM.log("saveHistory");var history_limit=50;CloudIM.history[CloudIM.history.length]={from:from,message:message,type:type,time:time},CloudIM.history.length>history_limit&&CloudIM.history.splice(0,CloudIM.history.length-history_limit),$.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_history",$.toJSON(CloudIM.history))},refreshOnlineManagers:function(callback,skip_jid,skip_resource){CloudIM.log("refreshOnlineManagers");var request={uid:CloudIM.uid,group:CloudIM.group.id,rnd:Math.random()};"undefined"!=skip_jid&&(request.skip_jid=skip_jid,"undefined"!=skip_resource&&(request.skip_jid+="/"+skip_resource)),$.get("/api/online.php",request,function(resp){if(resp.error||0==resp.length)CloudIM.managers=[],"function"==typeof callback&&callback(!1);else if($.isArray(resp)&&resp.length>0){CloudIM.managers=[],$(".operators-list > :not(.operator:first)").remove();var operatorIndex=0,current_jid=CloudIM.manager.jid,current_jid_login=current_jid.substr(0,current_jid.indexOf("@")+1),set_manager_data=null,set_mobile_manager_data=null;for(var i in resp)"object"==typeof resp[i]&&(operatorIndex=CloudIM.managers.length,CloudIM.managers[operatorIndex]=resp[i],$op_block=$(".operators-list .operator:first").clone().appendTo(".operators-list").show(),$op_block.find(".im_vcard_fullname").text(resp[i].name),$op_block.find(".operator-avatar img").attr("src","//"+CloudIM.host+"/img/avatars/"+(resp[i].avatar?resp[i].avatar:"default.png")),$op_block.data("operatorIndex",operatorIndex),$op_block.unbind("click").bind("click",CloudIM.toggleManagerSelector),current_jid==resp[i].jid&&(set_manager_data=resp[i]),0===resp[i].jid.indexOf(current_jid_login)&&(set_mobile_manager_data=resp[i]));if(null===set_manager_data&&CloudIM.managers.length)if(null!==set_mobile_manager_data)set_manager_data=set_mobile_manager_data;else{var rand_index=null;if(!0!==CloudIM.options.accept_chats)var rand_index=Math.floor(Math.random()*CloudIM.managers.length);else 1==CloudIM.managers.length?rand_index=0:(CloudIM.manager=null,CloudIM.setStatus(""));null!==rand_index&&(set_manager_data=CloudIM.managers[rand_index])}set_manager_data&&($("#operatorStatus").text("Онлайн"),$("#goingOffline").is(":visible")&&$("#goingOffline").hide(),CloudIM.setManager(set_manager_data)),"function"==typeof callback&&callback(!0)}CloudIM.managers.length>1?$("#im_manager_selector_link").show():$("#im_manager_selector_link").hide()},"json")},onlineManagers:function(callback){CloudIM.log("onlineManagers"),$.get("/api/online.php",{uid:CloudIM.uid,group:CloudIM.group.id,rnd:Math.random()},function(resp){if(resp.error||0==resp.length)CloudIM.manager=!1,CloudIM.offline_mode&&!$("#im_offline_form").is(":visible")&&CloudIM.showOfflineTab(),setTimeout(function(){CloudIM.onlineManagers(CloudIM.connect)},3e5);else if($.isArray(resp)&&resp.length>0){var cur_manager=$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_manager"),set_manager_index=null,$op_block=null;for(var i in resp)"object"==typeof resp[i]&&(cur_manager&&cur_manager==resp[i].jid&&(set_manager_index=i),CloudIM.managers[i]=resp[i],$op_block=$(".operators-list .operator:first").clone().appendTo(".operators-list").show(),$op_block.find(".im_vcard_fullname").text(resp[i].name),$op_block.find(".operator-avatar img").attr("src","//"+CloudIM.host+"/img/avatars/"+(resp[i].avatar?resp[i].avatar:"default.png")),$op_block.data("operatorIndex",i),$op_block.unbind("click").bind("click",CloudIM.toggleManagerSelector));null===set_manager_index&&(!0!==CloudIM.options.accept_chats?set_manager_index=Math.floor(Math.random()*CloudIM.managers.length):1==CloudIM.managers.length&&(set_manager_index=0)),null!==set_manager_index&&CloudIM.setManager(CloudIM.managers[set_manager_index]),CloudIM.is_ready||CloudIM.sendWindowMessage("showPanel"),"function"==typeof callback&&callback(),CloudIM.is_ready||"1"!=$.jStore.get(CloudIM.getStorageNameSpace()+"_showed")||CloudIM.toggleChat(!0),CloudIM.managers.length>1&&$("#im_manager_selector_link").show(),$(".im_head_title").data("online-header")&&$(".im_head_title").text($(".im_head_title").data("online-header"))}CloudIM.is_ready||(CloudIM.is_ready=!0,CloudIM.sendWindowMessage("callReadyEvent"))},"json")},toggleManagerSelector:function(){CloudIM.log("toggleManagerSelector");var manager_index=$(this).data("operatorIndex");if(void 0!==CloudIM.managers[manager_index]&&CloudIM.managers[manager_index].jid!=CloudIM.manager.jid){var last_manager=CloudIM.manager;CloudIM.sendMessage("Посетитель сам переключился на оператора "+CloudIM.managers[manager_index].name,!0),CloudIM.setManager(CloudIM.managers[manager_index]),CloudIM.sendMessage("Посетитель сам переключился к вам от оператора "+last_manager.name,!0),CloudIM.hashCommands("\\his 10");CloudIM.managers[manager_index];CloudIM.channel.publish({event:"sync.client",action:"setManager",payload:CloudIM.managers[manager_index]},function(err,data){err&&CloudIM.log("sync.client ERROR",err)})}return $(".operators-list").hide(),$("#operatorStatus").text("Онлайн"),$("#goingOffline").hide(),!1},setManager:function(set,only_view){CloudIM.log("setManager"),CloudIM.manager&&CloudIM.manager.jid==set.jid||($.jStore.set(CloudIM.getStorageNameSpace()+"_cloudim_manager",set.jid),CloudIM.manager=set,$(".im_vcard").show(10,CloudIM.updateChatHeight),$(".im_avatar").attr("src","//"+CloudIM.host+"/img/avatars/"+(set.avatar?set.avatar:"default.png")),$("#im_manager_name").text(set.name),!0!==only_view&&(CloudIM.addToRoster([CloudIM.manager]),CloudIM.sendWindowMessage("callOperatorChangeEvent",{operator:CloudIM.manager})),CloudIM.channel&&CloudIM.setStatus("")),CloudIM.offlineManager=null},checkRateBlock:function(){return CloudIM.log("checkRateBlock"),0==CloudIM.has_rate&&CloudIM.now_message_counter>=5&&($(".im_rate_block").slideDown(),!0)},setRate:function(rate){CloudIM.log("setRate"),CloudIM.manager&&CloudIM.manager.jid&&(CloudIM.has_rate=1,$.post("/api/rate.php",{action:"set",rate:rate,jid:CloudIM.manager.jid,visitor:CloudIM.user}))},toggleChat:function(no_animate){CloudIM.log("toggleChat"),CloudIM.showed?CloudIM.closeChat(no_animate):CloudIM.openChat(no_animate)},openChat:function(no_animate){CloudIM.log("openChat"),CloudIM.showed||(CloudIM.showed=!0,CloudIM.managers.length>0&&!$("#im_offline_form").is(":visible")?($.jStore.set(CloudIM.getStorageNameSpace()+"_showed",1),$(".im_welcome").hide(),no_animate?$("#im_panel").show(10,CloudIM.afterOpenChatCallback):$("#im_panel").slideDown(200,CloudIM.afterOpenChatCallback),$(".im_toggle").toggleClass("im_toggle_close"),CloudIM.sendWindowMessage("showChat",{online:!0})):($("#im_offline_form").slideDown(200,CloudIM.afterOpenChatCallback),$(".im_toggle").toggleClass("im_toggle_close"),CloudIM.sendWindowMessage("showChat",{online:!1})))},afterOpenChatCallback:function(){CloudIM.historyScrollDown(),CloudIM.updateChatHeight()},updateChatHeight:function(){CloudIM.sendWindowMessage("chatHeight",{height:475}),setTimeout(function(){var chat_height=$(".im_client").outerHeight()+5;CloudIM.sendWindowMessage("chatHeight",{height:chat_height})},650)},closeChat:function(no_animate){CloudIM.log("closeChat"),CloudIM.showed&&(CloudIM.showed=!1,CloudIM.managers.length>0?($.jStore.remove(CloudIM.getStorageNameSpace()+"_showed"),$("#im_offline_form").is(":visible")&&$("#im_offline_form").slideUp(200,function(){CloudIM.sendWindowMessage("showPanel")}),$("#im_panel").is(":visible")&&$("#im_panel").slideUp(200,function(){CloudIM.sendWindowMessage("showPanel")}),$(".im_toggle").toggleClass("im_toggle_close")):($("#im_offline_form").slideUp(200,function(){CloudIM.sendWindowMessage("showPanel")}),$(".im_toggle").toggleClass("im_toggle_close")))},removeChat:function(){CloudIM.log("removeChat"),$(".im_client").slideUp(200,function(){CloudIM.sendWindowMessage("removeChat")})},showEula:function(link){CloudIM.sendWindowMessage("showEula",link)},sendWindowMessage:function(callback,data){var message={callback:callback,data:data};window.addEventListener?parent.window.postMessage("!im_"+$.toJSON(message),CloudIM.url):window.parent.postMessage("!im_"+$.toJSON(message),CloudIM.url)},scriptMessage:function(event){try{var message=$.evalJSON(event.originalEvent.data);void 0!==CloudIM.callbacks[message.callback]&&CloudIM.callbacks[message.callback](message.data)}catch(e){}},callbacks:{openChat:function(){CloudIM.openChat()},closeChat:function(){CloudIM.closeChat()},toggleChat:function(){CloudIM.toggleChat()},getCurrentOperator:function(return_index){var operator=!1;CloudIM.manager?operator=CloudIM.manager:CloudIM.managers.length>0&&(operator=CloudIM.managers),CloudIM.sendWindowMessage("returnCallback",{callback_index:return_index,result:operator})},getOnlineOperators:function(return_index){var online_operators=!1;CloudIM.managers.length>0&&(online_operators=CloudIM.managers),CloudIM.sendWindowMessage("returnCallback",{callback_index:return_index,result:online_operators})},getVisitor:function(return_index){var visitor={ip:CloudIM.ip,chatted:!!CloudIM.history.length,page:{url:CloudIM.url,referer:CloudIM.referer},history:CloudIM.history,jid:CloudIM.user};CloudIM.sendWindowMessage("returnCallback",{callback_index:return_index,result:visitor})},sendMessageToOperator:function(message){CloudIM.log("CloudIM.offlineManager",CloudIM.offlineManager,message),CloudIM.offlineManager?-1===message.message.indexOf("*** cloudim-bot ***")&&(CloudIM.log("Current manager is offline, refreshing managers",message),CloudIM.refreshOnlineManagers(function(){CloudIM.log("Callback",message),"object"==typeof message?CloudIM.sendMessage(message.message,message.silent):CloudIM.sendMessage(message,!0)},CloudIM.manager.jid,CloudIM.manager.resource)):"object"==typeof message?CloudIM.sendMessage(message.message,message.silent):CloudIM.sendMessage(message,!0)},sendMessageToVisitor:function(message){CloudIM.messageInChat(message,"in")},sendPreMessage:function(message){CloudIM.preMessageInformer(message)},sendInvitesToChat:function(data){CloudIM.sendInvitesToChat(data)},sendUserData:function(data){CloudIM.user_data=data,CloudIM.channel&&CloudIM.setStatus("")},sendChatUser:function(data){var session_keys={v:"viewed_pages",p:"last_page",t:"total_time"},visit_keys={l:"last_visit"};if(data.session){var session=data.session.split("|");if(session.length>0)for(var i=0,toi=session.length;i<toi;i++)session[i]=session[i].split("="),CloudIM.user_stat[session_keys[session[i][0]]]=decodeURIComponent(session[i][1])}if(data.visit){var visit=data.visit.split("|");if(visit.length>0)for(var i=0,toi=visit.length;i<toi;i++)visit[i]=visit[i].split("="),CloudIM.user_stat[visit_keys[visit[i][0]]]=decodeURIComponent(visit[i][1])}CloudIM.user_stat.last_visit=CloudIM.user_stat.last_visit?new Date(1*CloudIM.user_stat.last_visit).getTime():0,CloudIM.user_stat.total_time=isNaN(CloudIM.user_stat.total_time)?0:1*CloudIM.user_stat.total_time,CloudIM.user_stat.viewed_pages=CloudIM.user_stat.viewed_pages?1*CloudIM.user_stat.viewed_pages:0,CloudIM.initFinish()},changePageInfo:function(data){CloudIM.calcTotalTime();var unload_time=(new Date).getTime();CloudIM.user_stat.last_visit=unload_time,CloudIM.saveVisitorStat(),CloudIM.referer=CloudIM.url,CloudIM.url=data.url,CloudIM.page=data.page,CloudIM.init_time-CloudIM.user_stat.last_visit>CloudIM.visit_timeout&&CloudIM.user_stat.last_visit>0&&(CloudIM.returned_visitor=!0),CloudIM.url!=CloudIM.user_stat.last_page&&(CloudIM.user_stat.viewed_pages=1*CloudIM.user_stat.viewed_pages+1),CloudIM.setStatus("")},clearCache:function(data){CloudIM.clearCache(),document.location=document.location},pauseConnection:function(){CloudIM.pause()},resumeConnection:function(){CloudIM.resume()}},hashCommands:function(message,from){CloudIM.log("hashCommands");var commands={clear:function(){CloudIM.clearCache(),document.location=document.location},history:function(param){var limit=1*param<=0?20:1*param,start=CloudIM.history.length-limit,result="",item=null;if(start=start<0?0:start,CloudIM.manager&&CloudIM.isCloudimClient()){for(var result_array=[],i=start;i<CloudIM.history.length;i++)result_array[result_array.length]=CloudIM.history[i];result="json:"+$.toJSON({type:"history",data:result_array})}else for(var i=start;i<CloudIM.history.length;i++)item=CloudIM.history[i],result+=("out"==item.type?CloudIM.user.substr(0,CloudIM.user.indexOf("@")):item.from)+" @ "+CloudIM.dateFormat(item.time)+"\r\n"+item.message+"\r\n---\r\n";CloudIM.sendMessage(result,!0)},to:function(param){if(""==param)this.who();else{var manager_index=param-1;if(void 0!==CloudIM.managers[manager_index]){var last_manager=CloudIM.manager;CloudIM.sendMessage("Посетитель перенаправлен к "+CloudIM.managers[manager_index].name,!0),CloudIM.setManager(CloudIM.managers[manager_index]),CloudIM.sendMessage("Вам перенаправлен посетитель от "+last_manager.name,!0),this.history(5)}else CloudIM.sendMessage("Оператор не найден или не онлайн.",!0)}},transfer:function(param){var id_operator=Number(param);return id_operator>0&&$.get("/api/online.php",{uid:CloudIM.uid,rnd:Math.random()},function(operators){if($.isArray(operators)&&operators.length>0){for(var i in operators)if(operators[i].id_operator==id_operator){var last_manager=CloudIM.manager;return CloudIM.sendMessage("Посетитель перенаправлен к "+operators[i].name,!0),CloudIM.setManager(operators[i]),CloudIM.sendMessage("Вам перенаправлен посетитель от "+last_manager.name,!0),commands.history(5),!0}CloudIM.sendMessage("Оператор не найден или не онлайн.",!0)}else CloudIM.sendMessage("Нет операторов онлайн.",!0)},"json"),!1},who:function(){var result="";for(var i in CloudIM.managers)result+=1*i+1+" - "+CloudIM.managers[i].name+" "+CloudIM.managers[i].jid+"\r\n---\r\n";CloudIM.sendMessage(result,!0)},url:function(param){CloudIM.messageInChat("Оператор хочет перенаправить Вас на страницу","info",param)},help:function(param){switch(param){case"history":var help="\\history N - выводит оператору указанное в N кол-во последних сообщений, если N не указывать, то выведет последние 20 сообщений. Команда будет полезна оператору, на которого был переведен клиент, чтобы быть в курсе диалога с предыдущим оператором.\r\n";help+="\\history\r\n",help+="выведет последние 20 сообщений\r\n\r\n",help+="\\history 10\r\n",help+="выведет последние 10 сообщений";break;case"who":var help="\\who - выведет список операторов, которые на данный момент находятся онлайн. Рекомендуется выполнять перед перенаправлением на другого оператора.\r\n";break;case"to":var help="\\to N - перенаправление пользователя на оператор с порядковым номером N, который можно получить командой \\who.\r\n";break;case"url":var help="\\url [url] - открывает у пользователя страницу, ссылку на которую передали в качестве параметра [url].\r\n";break;default:var help="\\help или \\h - список всех доступных команд;\r\n";help+="\\history - история переписки с пользователем;\r\n",help+="\\who - список онлайн-консультантов;\r\n",help+="\\to N - перевод пользователя на другого консультанта с номером из \\who;\r\n",help+="\\url [page] - перенаправление пользователя на указанную страницу сайта;\r\n"}CloudIM.sendMessage(help,!0)},info:function(){var info=CloudIM.getUserStatusText();CloudIM.sendMessage(info,!0)},his:function(param){commands.history(param)},h:function(param){commands.help(param)},form:function(param){"name"==param&&!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")||"email"==param&&!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email")||""==param&&(!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_name")||!$.jStore.get(CloudIM.getStorageNameSpace()+"_cloudim_user_email"))?($("#im_user_profile_form .im_user_name").show(),$("#im_user_profile_form .im_user_email").show(),param&&"name"!=param&&$("#im_user_profile_form .im_user_name").hide(),param&&"email"!=param&&$("#im_user_profile_form .im_user_email").hide(),$("#im_user_profile_save").unbind("submit").bind("submit",CloudIM.saveUserProfile),$("#im_user_profile_form").show()):CloudIM.sendUserVCard()},accept:function(){var who_accept=CloudIM.acceptedFromOperator(from);who_accept&&CloudIM.sendDialogAcceptedEvent(who_accept)}};message=message.replace(/^\s+/,"").replace(/\s+$/,"");for(var cmd in commands){var hash_cmd="\\"+cmd,params=message.substr(hash_cmd.length).replace(/(^\s+)|(\s+$)/g,"");if(0===message.indexOf(hash_cmd))return commands[cmd](params),!0}return 0===message.indexOf("\\")&&(CloudIM.sendMessage("Неверная команда. Отправьте \\h для помощи.",!0),!0)},acceptedFromOperator:function(from){if(CloudIM.managers.length>0){if(CloudIM.manager)return CloudIM.manager;for(var i in CloudIM.managers)if(from==CloudIM.managers[i].jid+"/"+CloudIM.managers[i].resource||from==CloudIM.managers[i].jid)return CloudIM.setManager(CloudIM.managers[i]),CloudIM.managers[i]}return null},onMessage:function(data){switch(CloudIM.log("onMessage"),data.event){case"xmpp.client.message":var message=data.message;CloudIM.status.code.id!=data.socket_id&&""!=message&&-1==message.indexOf("*** cloudim-bot ***")&&(CloudIM.messageInChat(message,"out"),CloudIM.sendWindowMessage("callClientMessageEvent",{message:message}));break;case"xmpp.operator.message":var message=data.message,from=data.from,id=data.id,message_data="object"==typeof data.data?data.data:{};if(""!=message){var silent=null,tabs=$.jStore.get(CloudIM.getStorageNameSpace()+"_tabs"),main_id=CloudIM.status.code.id;if($.isArray(tabs)&&tabs.length>0&&(main_id=tabs[tabs.length-1]),main_id!=CloudIM.status.code.id&&(silent=!0),CloudIM.channel.publish({event:"xmpp.client.received.message",to:from,id:id},function(err,data){err&&CloudIM.log("xmpp.client.received.message ERROR",err)}),!CloudIM.hashCommands(message,from)){if(!CloudIM.manager){var who_accept=CloudIM.acceptedFromOperator(from);who_accept&&CloudIM.sendDialogAcceptedEvent(who_accept)}CloudIM.manager&&(CloudIM.messageInChat(message,"in",null,silent),CloudIM.sendWindowMessage("callMessageEvent",{from:CloudIM.manager.name,message:message,data:message_data,silent:silent}))}}$("#typing").text("");break;case"xmpp.operator.chat.accept":var from=data.from,who_accept=CloudIM.acceptedFromOperator(from);who_accept&&CloudIM.sendDialogAcceptedEvent(who_accept);break;case"xmpp.operator.composing":$("#typing").text("печатает..."),CloudIM.manager&&CloudIM.sendWindowMessage("callTypingEvent",{from:CloudIM.manager.name,typing:!0});break;case"xmpp.operator.composing.stop":$("#typing").text(""),CloudIM.manager&&CloudIM.sendWindowMessage("callTypingEvent",{from:CloudIM.manager.name,typing:!1});break;case"xmpp.operator.presence":CloudIM.onPresence(data);break;case"sync.client":data.action&&CloudIM.onClientSync(data.action,data.payload);break;case"xmpp.client.vcard":$("#im_user_profile_form").hide();break;case"xmpp.operator.cobrowse.internal.page":CloudIM.sendWindowMessage("callExternalEvent",{event:data.event})}},onPresence:function(data){CloudIM.log("onPresence");var state=data.state,from=data.from+"/"+data.resource;if(CloudIM.manager){var fullJid=CloudIM.manager.jid+(CloudIM.manager.resource?"/"+CloudIM.manager.resource:"");if(from.indexOf("@"+CloudIM.mobile_jid)>-1)return!0;switch(state){case"chat":case"":case"online":CloudIM.offlineManager&&CloudIM.offlineManager===from&&(CloudIM.offlineManager=null),$("#operatorStatus").text("Онлайн"),$("#goingOffline").is(":visible")&&$("#goingOffline").hide();break;case"offline":fullJid===from&&($("#operatorStatus").text("Не в сети"),$("#goingOffline").is(":visible")||CloudIM.showGoingOffline());break;case"away":fullJid===from&&($("#operatorStatus").text("Отошёл"),$("#goingOffline").is(":visible")||(CloudIM.offlineManager=from,CloudIM.showGoingOffline()))}}return!0},onClientSync:function(action,payload){"setManager"===action&&CloudIM.setManager(payload,!0)},showGoingOffline:function(){CloudIM.log("showGoingOffline"),0==CloudIM.managers.length?($(".going_offline .online-label").hide(),$(".going_offline .offline-label").show(),$(".going_offline .online-buttons").hide()):($(".going_offline .online-label").show(),$(".going_offline .offline-label").hide(),$(".going_offline .online-buttons").show()),$("#goingOffline").show()},onIq:function(msg){var to=msg.getAttribute("to"),from=msg.getAttribute("from"),id=msg.getAttribute("id"),type=msg.getAttribute("type"),elems=msg.getElementsByTagName("query");return"get"==type&&elems.length>0&&"http://jabber.org/protocol/disco#info"==elems[0].getAttribute("xmlns")&&CloudIM.connection.send($iq({from:to,id:id,to:from,"xml:lang":"ru",type:"result"}).c("query",{xmlns:"http://jabber.org/protocol/disco#info"}).c("feature",{var:"urn:xmpp:receipts"}).up().c("feature",{var:"http://jabber.org/protocol/chatstates"}).tree()),!0},unicJID:function(min,max){var chars="0123456789abcdefghiklmnopqrstuvwxyz";min||(min=4),max||(max=6);for(var string_length=Math.floor(Math.random()*(max-min+1)+min),randomJID="",i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);randomJID+=chars.substring(rnum,rnum+1)}return CloudIM.domain+"_"+randomJID+"@"+CloudIM.host_jid},getServerIndex:function(server){return server.split("@")[1]},getStorageNameSpace:function(){return CloudIM.domain.replace(".","_")+"_"+CloudIM.group.id+"_"+CloudIM.uid},popup:function(url,screen_width,width,height){width||(width=450),height||(height=500);var left=screen_width/2-width/2,popup=window.open(url,"CloudimPopup","left="+left+",width="+width+",height="+height+",location=1,toolbar=0,menubar=0,status=0,scrollbars=0,resizable=1");null==popup?alert("Please unlock popup window!"):popup.focus()},clearCache:function(){CloudIM.log("clearCache"),CloudIM.storage_active&&($.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_history"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_user"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_user_name"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_user_email"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_user"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_jrid"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_jsid"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_cloudim_manager"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_showed"),$.jStore.remove(CloudIM.getStorageNameSpace()+"_call_triggers"))},updateTotalTime:function(){CloudIM.calcTotalTime(),CloudIM.saveVisitorStat()},calcTotalTime:function(){var last_time=(new Date).getTime();return CloudIM.user_stat.total_time=1*CloudIM.user_stat.total_time+Math.round((last_time-CloudIM.last_time)/1e3),CloudIM.last_time=last_time,CloudIM.log("calcTotalTime: "+CloudIM.user_stat.total_time+" sec"),!0},isOldCloudimClient:function(){return!(!CloudIM.manager||"CloudimAirClient"!=CloudIM.manager.resource)},isCloudimClient:function(version){if(CloudIM.manager)if(void 0!==version){if(0===CloudIM.manager.resource.indexOf("CloudimClient"))return!0}else if("CloudimAirClient"==CloudIM.manager.resource||0===CloudIM.manager.resource.indexOf("CloudimClient"))return!0;return!1},log:function(message){}};